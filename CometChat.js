!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(function(){try{return require("react-native")}catch(t){}}(),require("react"),require("react-native-cometchat-calling-component"));else if("function"==typeof define&&define.amd)define(["react-native","react","react-native-cometchat-calling-component"],e);else{var n="object"==typeof exports?e(function(){try{return require("react-native")}catch(t){}}(),require("react"),require("react-native-cometchat-calling-component")):e(t["react-native"],t.react,t["react-native-cometchat-calling-component"]);for(var s in n)("object"==typeof exports?exports:t)[s]=n[s]}}(window,function(s,n,o){return function(n){var s={};function o(t){if(s[t])return s[t].exports;var e=s[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}return o.m=n,o.c=s,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=38)}([function(t,e,n){"use strict";e.__esModule=!0;var s,o,r,i=n(2);e.constants={DEFAULT_STORE:"cometchat",MSG_VER_PRE:"store-ver-pre",MSG_VER_POST:"store-ver-post"},e.DEFAULT_VALUES={ZERO:0,MSGS_LIMIT:30,MSGS_MAX_LIMIT:100,USERS_LIMIT:30,USERS_MAX_LIMIT:100,GROUPS_LIMIT:30,GROUPS_MAX_LIMIT:100,CONVERSATION_MAX_LIMIT:50,CALL_TIMEOUT:45,DEFAULT_MSG_ID:0,DEFAULT_MAX_TYPING_INDICATOR_LIMIT:5,REGION_DEFAULT:"eu",REGION_DEFAULT_EU:"eu",REGION_DEFAULT_US:"us",REGION_DEFAULT_IN:"in",REGION_DEFAULT_PRIVATE:"private"},(s=e.GroupType||(e.GroupType={})).Public="public",s.Private="private",s.Protected="protected",s.Password="password",e.GROUP_TYPE={PUBLIC:"public",PRIVATE:"private",PROTECTED:"password",PASSWORD:"password"},(o=e.GroupMemberScope||(e.GroupMemberScope={})).Admin="admin",o.Moderator="moderator",o.Member="member",e.GROUP_MEMBER_SCOPE={ADMIN:"admin",MODERATOR:"moderator",PARTICIPANT:"participant"},e.APPINFO={platform:"REACT_NATIVE",sdkVersion:"v2.0.8",apiVersion:"v2.0"},e.XMPP={host:"encke.cometchat.com",port:7443,ws_url:"/ws/",bind_url:"/http-bind/",deafult_password:"CometChat",PUBSUB_CHANNEL:"pubsub",jid_string:"[%s]%s@%s/%s",bare_jid_string:"[%s]%s@%s",username_string:"[%s]%s",muc_jid_string:"[%s]%s@%s.%s",pubsub_global_string:"[%s]global_presence",pubsub_default_string:"[%s]default",pubsub_role_string:"[%s]%s",xmpp_resource:"javascripts_"+(new Date).getTime(),CONVERSATION:{TYPE:{CHAT:"chat",GROUP_CHAT:"groupchat"}}},e.LOCAL_STORE={COMMON_STORE:"common_store",MESSAGE_LISTENERS_LIST:"message_listeners_list",USERS_STORE:"users_store",MESSAGES_STORE:"messages_store",KEYS_STORE:"keys_store",STORE_STRING:"%s:%s"},e.ResponseConstants={RESPONSE_KEYS:{KEY_DATA:"data",KEY_META:"meta",KEY_CURSOR:"cursor",KEY_ACTION:"action",KEY_MESSAGE:"message",KEY_ERROR:"error",KEY_ERROR_DETAILS:"details",KEY_ERROR_CODE:"code",KEY_ERROR_MESSAGE:"message",KEY_AUTH_TOKEN:"authToken",KEY_WS_CHANNEL:"wsChannel",KEY_IDENTITY:"identity",KEY_SERVICE:"identity",KEY_ENTITIES:"entities",KEY_ENTITITY:"entity",KEY_ENTITYTYPE:"entityType",KEY_ATTACHMENTS:"attachments",CODE_REQUEST_OK:200,CODE_BAD_REQUEST:401,UNREAD_UNDELIVERED_KEYS:{ENTITY:"entity",ENTITY_TYPE:"entityType",ENTITY_Id:"entityId",COUNT:"count"},GROUP_MEMBERS_RESPONSE:{SUCCESS:"success",ERROR:"error",MESSAGE:"message"},KEY_ENTITY_TYPE:{USER:"user",GROUP:"group"}}},e.DELIVERY_RECEIPTS={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"type",RECIPIENT:"recipient",MESSAGE_ID:"messageId",RECEIVED:"delivered",DELIVERED_AT:"deliveredAt",ID:"id",TIME:"time",DELIVERED_TO_ME_AT:"deliveredToMeAt"},e.READ_RECEIPTS={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"type",RECIPIENT:"recipient",MESSAGE_ID:"messageId",READ:"read",READ_AT:"readAt",ID:"id",TIME:"time",READ_BY_ME_AT:"readByMeAt"},e.MessageConstatnts={XMPP_KEYS:{FROM:"from",TO:"to",TYPE:"type",TYPE_USER:"chat",TYPE_GROUP:"groupchat"},TYPE:{TEXT:"text",MEDIA:"media",IMAGE:"image",VIDEO:"video",AUDIO:"audio",FILE:"file",CUSTOM:"custom"},CATEGORY:{MESSAGE:"message",ACTION:"action",CALL:"call",CUSTOM:"custom"},RECEIVER_TYPE:{USER:"user",GROUP:"group"},KEYS:{ATTATCHMENT:"attatchment",ATTATCHMENTS:"attachments",ACTION:"action",TYPE:"type",DATA:"data",ID:"id",MUID:"muid",SENDER:"sender",RECEIVER:"receiver",RECEIVER_ID:"receiverId",CATEGORY:"category",RECEIVER_TYPE:"receiverType",SENT_AT:"sentAt",STATUS:"status",TEXT:"text",URL:"url",METADATA:"metadata",RECEIPTS:"receipts",MY_RECEIPTS:"myReceipt",CUSTOM_DATA:"customData",CUSTOM_SUB_TYPE:"subType"},KNOWN_MEDIA_TYPE:{IMAGE:[],VIDEO:[],AUDIO:[],FILE:[]},PAGINATION:{AFFIX:{APPEND:"append",PREPEND:"prepend"},CURSOR_FILEDS:{ID:"id",SENT_AT:"sentAt"},CURSOR_AFFIX_DEFAULT:"prepend",CURSOR_FIELD_DEFAULT:"sentAt",KEYS:{PER_PAGE:"per_page",CURSOR_AFFIX:"cursorAffix",AFFIX:"affix",CURSOR_FIELD:"cursorField",CURSOR_VALUE:"cursorValue",UID:"uid",SENT_AT:"sentAt",ID:"id",CURRENT_PAGE:"page",UNREAD:"unread",HIDE_MESSAGES_FROM_BLOCKED_USER:"hideMessagesFromBlockedUsers",SEARCH_KEY:"searchKey",ONLY_UPDATES:"onlyUpdates",UPDATED_AT:"updatedAt",CATEGORY:"category",TYPE:"type"}}},e.ATTACHMENTS_CONSTANTS={KEYS:{EXTENSION:"extension",MIME_TYPE:"mimeType",NAME:"name",SIZE:"size",URL:"url"}},(r=e.MessageCategory||(e.MessageCategory={})).ACTION="action",r.MESSAGE="message",r.CALL="call",r.CUSTOM="custom",e.TYPING_NOTIFICATION={RECEIVER_ID:"receiverId",RECEIVER_TYPE:"receiverType",META:"metadata",KEYS:{TYPING_NOTIFICATION:"typingNotification",TIMESTAMP:"timestamp"},ACTIONS:{STARTED:"started",ENDED:"ended"}},e.ActionConstatnts={ACTION_SUBJECTS:{ACTION_ON:"on",ACTION_BY:"by",ACTION_FOR:"for"},ACTION_ENTITY_TYPE:{GROUP_USER:"groupuser",USER:"user",GROUP:"group",MESSAGE:"message"},ACTION_KEYS:{ACTION_CREATED:"created",ACTION_UPDATED:"updated",ACTION_DELETED:"deleted",ENTITIES:"entities",ENTITY:"entity",ENTITY_TYPE:"entityType",TYPE_MEMBER_JOINED:"joined",TYPE_MEMBER_LEFT:"left",TYPE_MEMBER_KICKED:"kicked",TYPE_MEMBER_BANNED:"banned",TYPE_MEMBER_UNBANNED:"unbanned",TYPE_MEMBER_INVITED:"invited",TYPE_MEMBER_ADDED:"added",ACTION_SCOPE_CHANGED:"scopeChanged",ACTION_TYPE_USER:"user",ACTION_TYPE_GROUP:"group",ACTION_TYPE_GROUP_MEMBER:"groupMember",TYPE_MESSAGE_EDITED:"edited",TYPE_MESSAGE_DELETED:"deleted",ACTION_TYPE_CALL:"call",EXTRAS:"extras",SCOPE:"scope",NEW:"new",OLD:"old"},ActionMessages:{ACTION_GROUP_JOINED_MESSAGE:"%s joined",ACTION_GROUP_LEFT_MESSAGE:"%s left",ACTION_MEMBER_KICKED_MESSAGE:"%s kicked %s",ACTION_MEMBER_BANNED_MESSAGE:"%s banned %s",ACTION_MEMBER_UNBANNED_MESSAGE:"%s unbanned %s",ACTION_MEMBER_INVITED_MESSAGE:"%s banned %s",ACTION_MESSAGE_EDITED_MESSAGE:" Message Edited",ACTION_MESSAGE_DELETED_MESSAGE:"Message Deleted",ACTION_MEMBER_SCOPE_CHANGED:"%s made %s %s",ACTION_MEMBER_ADDED_TO_GROUP:"%s added %s"},ACTION_TYPE:{TYPE_MEMBER_JOINED:"joined",TYPE_MEMBER_LEFT:"left",TYPE_MEMBER_KICKED:"kicked",TYPE_MEMBER_BANNED:"banned",TYPE_MEMBER_UNBANNED:"unbanned",TYPE_MEMBER_INVITED:"invited",TYPE_MEMBER_SCOPE_CHANGED:"scopeChanged",TYPE_MESSAGE:"message",TYPE_MESSAGE_EDITED:"edited",TYPE_MESSAGE_DELETED:"deleted",TYPE_MEMBER_ADDED:"added"},ACTIONS:{MEMBER_JOINED:"joined",MEMBER_LEFT:"left",MEMBER_KICKED:"kicked",MEMBER_BANNED:"banned",MEMBER_UNBANNED:"unbanned",MEMBER_INVITED:"invited",MEMBER_SCOPE_CHANGED:"scopeChanged"}},e.BlockedUsersConstants={REQUEST_KEYS:{DIRECTIONS:{BOTH:"both",HAS_BLOCKED_ME:"hasBlockedMe",BLOCKED_BY_ME:"blockedByMe"}}},e.CallConstants={AUDIO_MODE_SPEAKER:"speaker",AUDIO_MODE_EARPIECE:"earpiece",CALL_TYPE_AUDIO:"audio",CALL_TYPE_VIDEO:"video",CALL_TYPE:{AUDIO:"audio",VIDEO:"video"},RECEIVER_TYPE_GROUP:"group",RECEIVER_TYPE_USER:"user",CALL_KEYS:{CALL_DATA:"data",CALL_ID:"id",CALL_SESSION_ID:"sessionid",CALL_RECEIVER:"receiver",CALL_SENDER:"sender",CALL_RECEIVER_TYPE:"receiverType",CALL_STATUS:"status",CALL_TYPE:"type",CALL_INITIATED_AT:"initiatedAt",CALL_JOINED_AT:"joinedAt",CALL_LEFT_AT:"leftAt",CALL_METADATA:"metadata",CALL_ENTITIES:"entities",CALL_ENTITY_TYPE:"entityType",CALL_ENTITY:"entity",CALL_ENTITY_USER:"user",CALL_ENTITY_GROUP:"group"},CALL_STATUS:{INITIATED:"initiated",ONGOING:"ongoing",UNANSWERED:"unanswered",REJECTED:"rejected",BUSY:"busy",CANCELLED:"cancelled",ENDED:"ended"}},e.GroupConstants={KEYS:{NAME:"name",GUID:"guid",TYPE:"type",PASSWORD:"password",ICON:"icon",DESCRIPTION:"description",OWNER:"owner",METADATA:"metadata",CREATED_AT:"createdAt",UPDATED_AT:"updatedAt",HAS_JOINED:"hasJoined",WS_CHANNEL:"wsChannel"}},e.GroupMemersConstans={KEYS:{SCOPE:"scope",UID:"uid",GUID:"guid",USER:"user",NAME:"name"}},e.UserConstants={UID:"uid",NAME:"name",AUTH_TOKEN:"authToken",AVATAR:"avatar",LAST_ACTIVE_AT:"lastActiveAt",LINK:"link",META_DATA:"metadata",ROLE:"role",STATUS:"status",STATUS_MESSAGE:"statusMessage",USER_NAME:"user_name"},e.Errors={ERROR_IO_EXCEPTION:"ERROR_IO_EXCEPTION",ERROR_JSON_EXCEPTION:"ERROR_JSON_EXCEPTION",ERROR_PASSWORD_MISSING:"ERROR_PASSWORD_MISSING",ERROR_LIMIT_EXCEEDED:"ERROR_LIMIT_EXCEEDED",ERROR_USER_NOT_LOGGED_IN:"ERROR_USER_NOT_LOGGED_IN",ERROR_INVALID_GUID:"ERROR_INVALID_GUID",ERROR_PASSWORD_MISSING_MESSAGE:"Password is mandatory for a password group",ERROR_LIMIT_EXCEEDED_MESSAGE:"Limit Exceeded Max limit of %s",ERROR_USER_NOT_LOGGED_IN_MESSAGE:"Please log in to CometChat before calling this method",ERROR_INVALID_GUID_MESSAGE:"Please provide a valid GUID",ERROR_DEFAULT_MESSAGE:"Something went wrong"},e.CALL_ERROR={CALL_ALREADY_INITIATED:{code:"CALL_ALREADY_INITIATED",name:"CALL_ALREADY_INITIATED",message:"There is already call in progress",details:{}},ERROR_IN_CALLING:{code:"CALL_IN_PROGRESS",name:"CALL_ALREADY_INITIATED",message:"There is already call in progress",details:{}},CANNOT_ACCEPT_CALL:{code:"OTHER_CALL_ONGOING",name:"OTHER_CALL_ONGOING",message:"There is already call in progress",details:{}}},e.PARAMETER_ERROR={PARAMETER_REQUIRED:{code:"%s_NOT_PROVIDED",name:"%s_NOT_PROVIDED",message:"please provide the %s",details:{}}},e.GENERAL_ERROR={MUST_BE_A_STRING:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a string",details:{}},MUST_BE_A_NUMBER:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a number",details:{}},MUST_BE_A_OBJECT:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a object",details:{}},MUST_BE_AN_ARRAY:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be an array",details:{}},MUST_BE_A_BOOLEAN:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a boolean",details:{}},MUST_BE_A_BLOB:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a blob",details:{}},INVALID:{code:"INVALID_%s",name:"INVALID_%s",message:"%s is invalid",details:{}},COMPULSORY:{code:"%s_IS_COMPULSORY",name:"%s_IS_COMPULSORY",message:"%s is required",details:{}},LIMIT_EXCEEDED:{code:"ERROR_%s_EXCEEDED",name:"ERROR_%s_EXCEEDED",message:"%s exceeded max limit of %s",details:{}},MUST_BE_A_POSITIVE_NUMBER:{code:"INVALID_%s",name:"INVALID_%s",message:"%s should be a postive integer greater than 0",details:{}},INVALID_MEDIA_FILE:{code:"INVALID_%s",name:"INVALID_%s",message:"The message type does not match the file's mime type.",details:{}},EMPTY_STRING:{code:"INVALID_%s",name:"INVALID_%s",message:"The parameter %s is required and it cannot be empty",details:{}}},e.UserErrors={INVALID_STATUS:new i.CometChatException({code:"INVALID_STATUS_VALUE",name:"INVALID_STATUS_VALUE",message:"status accepts only two values: online and offline",details:""}),INVALID_DIRECTION:new i.CometChatException({code:"INVALID_DIRECTION_VALUE",name:"INVALID_DIRECTION_VALUE",message:"direction accepts only three values: both, blockedByMe and hasBlockedMe",details:""}),USER_NOT_LOGGED_IN:new i.CometChatException({code:"USER_NOT_LOGGED_IN",name:"USER_NOT_LOGGED_IN",message:"please login before using any other method of cometchat",details:""})},e.GroupErrors={NOT_A_GROUP:new i.CometChatException({code:"NOT_A_GROUP",message:"Please use group class to construct a new group"}),INVALID_SCOPE:new i.CometChatException({code:"INVALID_SCOPE_VALUE",name:"INVALID_SCOPE_VALUE",message:"Scope can be admin, moderator or participant",details:""}),INVALID_GROUP_TYPE:new i.CometChatException({code:"INVALID_GROUP_TYPE",name:"INVALID_GROUP_TYPE",message:"Group Type can be public, private, protected or password",details:""})},e.PresenceConstatnts={XMPP_KEYS:{FROM:"from",STATUS:"status",LAST_ACTIVE_AT:"lastActiveAt",TYPE:"type"},STATUS:{ONLINE:"online",AVAILABLE:"available",OFFLINE:"offline",JOINED:"JOINED",LEFT:"LEFT"}},e.APP_SETTINGS={APP_SETTINGS:"app_settings",KEYS:{CHAT_HOST:"CHAT_HOST",CHAT_USE_SSL:"CHAT_USE_SSL",GROUP_SERVICE:"GROUP_SERVICE",CALL_SERVICE:"CALL_SERVICE",CHAT_WS_PORT:"CHAT_WS_PORT",CHAT_WSS_PORT:"CHAT_WSS_PORT",CHAT_HTTP_BIND_PORT:"CHAT_HTTP_BIND_PORT",CHAT_HTTPS_BIND_PORT:"CHAT_HTTPS_BIND_PORT",ADMIN_API_HOST:"ADMIN_API_HOST",CLIENT_API_HOST:"CLIENT_API_HOST",WEBRTC_HOST:"WEBRTC_HOST",WEBRTC_USE_SSL:"WEBRTC_USE_SSL",WEBRTC_WS_PORT:"WEBRTC_WS_PORT",WEBRTC_WSS_PORT:"WEBRTC_WSS_PORT",WEBRTC_HTTP_BIND_PORT:"WEBRTC_HTTP_BIND_PORT",WEBRTC_HTTPS_BIND_PORT:"WEBRTC_HTTPS_BIND_PORT",EXTENSION_LIST:"extensions",EXTENSION_KEYS:{ID:"id",NAME:"name"}}},e.COMMON_UTILITY_CONSTANTS={TYPE_CONSTANTS:{BOOLEAN:"boolean",STRING:"string",OBJECT:"object",NUMBER:"number"}},e.CONNECTION_STATUS={CONNECTED:"connected",CONNECTING:"connecting",DISCONNECTED:"disconnected"}},function(t,s,e){"use strict";s.__esModule=!0;var o=e(9),r=e(0),i=e(4),a=e(2),c=e(17),u=e(18),l=e(19),E=e(3),n=e(15);function h(t){return null!=t&&("string"==typeof t&&(t=t.trim()),"object"==typeof t&&0===Object.keys(t).length&&(t=void 0)),["",0,"0",!1,null,"null",void 0,"undefined"].includes(t)}function p(t){for(var s=[],e=1;e<arguments.length;e++)s[e-1]=arguments[e];return t.split("%s").reduce(function(t,e,n){return t+e+(s[n]||"")},"")}s.isObject=function(t){return t instanceof Object&&t.constructor===Object},s.isTruthy=function(t){return[!0,1,"1","true","TRUE"].includes(t)},s.isFalsy=h,s.getOrdinalSuffix=function(t){var e=t%10,n=t%100;return 1==e&&11!=n?t+"st":2==e&&12!=n?t+"nd":3==e&&13!=n?t+"rd":t+"th"},s.format=p,s.createUidFromJid=function(t){return t.substring(t.lastIndexOf("]")+1,t.lastIndexOf("@"))};var d=function(){function t(){}return t.log=function(t,e){},t.error=function(t,e){},t.info=function(t,e){},t}();function C(){return new Promise(function(e,n){i.makeApiCall("appSettings").then(function(t){o.LocalStorage.getInstance().set("app_settings",t.data),e(t.data)},function(t){n(new a.CometChatException(t.error))})})}function S(t,e){return t<<e|t>>>32-e}function f(t){var e,n="";for(e=7;0<=e;e--)n+=(t>>>4*e&15).toString(16);return n}s.Logger=d,s.getCurrentTime=function(){return(new Date).getTime()},s.getAppSettings=function(){return new Promise(function(e,n){o.LocalStorage.getInstance().get(r.APP_SETTINGS.APP_SETTINGS).then(function(t){h(t)?C().then(function(t){e(t)},function(t){n(t)}):e(t)},function(t){n(t)})})},s.getUpdatedSettings=C,s.isImage=function(t){var e;return t.type&&t.type.toLowerCase().includes("image")&&(e=!0),e},s.isVideo=function(t){var e;return t.type&&t.type.toLowerCase().includes("video")&&(e=!0),e},s.isAudio=function(t){var e;return t.type&&t.type.toLowerCase().includes("audio")&&(e=!0),e},s.validateScope=function(t){return typeof t!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"SCOPE","SCOPE","scope"))):h(t)?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"SCOPE","SCOPE","scope"))):t!=E.CometChat.GROUP_MEMBER_SCOPE.ADMIN&&t!=E.CometChat.GROUP_MEMBER_SCOPE.MODERATOR&&t!=E.CometChat.GROUP_MEMBER_SCOPE.PARTICIPANT?new a.CometChatException(r.GroupErrors.INVALID_SCOPE):void 0},s.validateUpdateGroup=function(t){return t.hasOwnProperty(r.GroupConstants.KEYS.GUID)?typeof t[r.GroupConstants.KEYS.GUID]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","guid"))):h(t[r.GroupConstants.KEYS.GUID])?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"GUID","GUID","guid"))):t.hasOwnProperty(r.GroupConstants.KEYS.NAME)&&""===t[r.GroupConstants.KEYS.NAME]?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.EMPTY_STRING),"GROUP_NAME","GROUP_NAME","group name"))):void 0:new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"GUID","GUID","guid")))},s.validateJoinGroup=function(t,e,n){if(typeof t==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.OBJECT){if(!t.hasOwnProperty(r.GroupConstants.KEYS.GUID))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"GUID","GUID","guid")));if(typeof t[r.GroupConstants.KEYS.GUID]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","guid")));if(h(t[r.GroupConstants.KEYS.GUID]))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"GUID","GUID","guid")));if(!t.hasOwnProperty(r.GroupConstants.KEYS.TYPE))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"GROUP_TYPE","GROUP_TYPE","group type")));if(typeof t[r.GroupConstants.KEYS.TYPE]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"GROUP_TYPE","GROUP_TYPE","group type")));if(h(t[r.GroupConstants.KEYS.TYPE]))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"GROUP_TYPE","GROUP_TYPE","group type")));if(t[r.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PUBLIC&&t[r.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PASSWORD&&t[r.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PROTECTED&&t[r.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PRIVATE)return new a.CometChatException(r.GroupErrors.INVALID_GROUP_TYPE);if(t[r.GroupConstants.KEYS.TYPE].toLowerCase()==E.CometChat.GROUP_TYPE.PASSWORD){if(!t.hasOwnProperty(r.GroupConstants.KEYS.PASSWORD))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"PASSWORD","PASSWORD","password")));if(typeof t[r.GroupConstants.KEYS.PASSWORD]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"PASSWORD","PASSWORD","password")));if(h(t[r.GroupConstants.KEYS.PASSWORD]))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"PASSWORD","PASSWORD","password")))}}else{if(void 0!==t){if(typeof t!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","guid")));if(h(t))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"GUID","GUID","guid")))}if(void 0!==e){if(typeof e!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"GROUP_TYPE","GROUP_TYPE","group type")));if(h(e))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"GROUP_TYPE","GROUP_TYPE","group type")));if(e.toLowerCase()!=E.CometChat.GROUP_TYPE.PUBLIC&&e.toLowerCase()!=E.CometChat.GROUP_TYPE.PASSWORD&&e.toLowerCase()!=E.CometChat.GROUP_TYPE.PROTECTED&&e.toLowerCase()!=E.CometChat.GROUP_TYPE.PRIVATE)return new a.CometChatException(r.GroupErrors.INVALID_GROUP_TYPE);if(e.toLowerCase()==E.CometChat.GROUP_TYPE.PASSWORD){if(typeof n!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"PASSWORD","PASSWORD","password")));if(h(n))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"PASSWORD","PASSWORD","password")))}}}},s.validateCreateGroup=function(t){if(!t.hasOwnProperty(r.GroupConstants.KEYS.GUID))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"GUID","GUID","guid")));if(typeof t[r.GroupConstants.KEYS.GUID]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","guid")));if(h(t[r.GroupConstants.KEYS.GUID]))return new a.CometChatException({code:"Empty GUID"});if(!t.hasOwnProperty(r.GroupConstants.KEYS.NAME))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"GROUP_NAME","GROUP_NAME","group name")));if(typeof t[r.GroupConstants.KEYS.NAME]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"GROUP_NAME","GROUP_NAME","group name")));if(h(t[r.GroupConstants.KEYS.NAME]))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"GROUP_NAME","GROUP_NAME","group name")));if(!t.hasOwnProperty(r.GroupConstants.KEYS.TYPE))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"GROUP_TYPE","GROUP_TYPE","group type")));if(typeof t[r.GroupConstants.KEYS.TYPE]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"GROUP_TYPE","GROUP_TYPE","group type")));if(h(t[r.GroupConstants.KEYS.TYPE]))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"GROUP_TYPE","GROUP_TYPE","group type")));if(t[r.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PUBLIC&&t[r.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PASSWORD&&t[r.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PROTECTED&&t[r.GroupConstants.KEYS.TYPE].toLowerCase()!=E.CometChat.GROUP_TYPE.PRIVATE)return new a.CometChatException(r.GroupErrors.INVALID_GROUP_TYPE);if(t[r.GroupConstants.KEYS.TYPE].toLowerCase()==E.CometChat.GROUP_TYPE.PASSWORD){if(!t.hasOwnProperty(r.GroupConstants.KEYS.PASSWORD))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"PASSWORD","PASSWORD","password")));if(typeof t[r.GroupConstants.KEYS.PASSWORD]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"PASSWORD","PASSWORD","password")));if(h(t[r.GroupConstants.KEYS.PASSWORD]))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"PASSWORD","PASSWORD","password")))}},s.validateId=function(t){return typeof t!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"UID/GUID","UID/GUID","uid/guid"))):h(t)?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"UID/GUID","UID/GUID","uid/guid"))):void 0},s.validateHideMessagesFromBlockedUsers=function(t){if(typeof t!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_BOOLEAN),"HIDE_MESSAGES_FROM_BLOCKED_USERS","HIDE_MESSAGES_FROM_BLOCKED_USERS","hideMessagesFromBlockedUsers")))},s.validateArray=function(t){return typeof t!=r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.OBJECT?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_OBJECT),"LIST","LIST","list"))):Array.isArray(t)?void 0:new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_AN_ARRAY),"LIST","LIST","list")))},s.validateMsgId=function(t){return isNaN(t)?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_NUMBER),"MESSAGE_ID","MESSAGE_ID","Message Id"))):h(t)?new a.CometChatException(n.ERRORS.PARAMETER_MISSING):void 0},s.validateChatType=function(t){return typeof t!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"RECEIVER_TYPE","RECEIVER_TYPE","receiver type"))):h(t)?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"RECEIVER_TYPE","RECEIVER_TYPE","receiver type"))):t!=r.MessageConstatnts.RECEIVER_TYPE.GROUP&&t!=r.MessageConstatnts.RECEIVER_TYPE.USER?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"RECEIVER_TYPE","RECEIVER_TYPE","Receiver Type"))):void 0},s.validateMessage=function(t){var e=t;if(typeof e.getReceiverId()!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"RECEIVER_ID","RECEIVER_ID","Receiver Id")));if(h(e.getReceiverId()))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"RECEIVER_ID","RECEIVER_ID","Receiver Id")));if(typeof e.getReceiverType()!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"RECEIVER_TYPE","RECEIVER_TYPE","Receiver Type")));if(h(e.getReceiverType()))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"RECEIVER_TYPE","RECEIVER_TYPE","Receiver Type")));if(e.getReceiverType()!=r.MessageConstatnts.RECEIVER_TYPE.GROUP&&e.getReceiverType()!=r.MessageConstatnts.RECEIVER_TYPE.USER)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"RECEIVER_TYPE","RECEIVER_TYPE","Receiver Type")));if(t instanceof c.TextMessage&&h(t.getText()))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"MESSAGE_TEXT","MESSAGE_TEXT","Message Text")));if(t instanceof u.MediaMessage){var n=t;if(typeof n.getData()!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.OBJECT)return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_OBJECT),"MEDIA_OBJECT","MEDIA_OBJECT","Media Object")));if(h(n.getData()))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"MEDIA_OBJECT","MEDIA_OBJECT","Media Object")));if("image"==n.getType()){if(!s.isImage(n.file))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID_MEDIA_FILE),"IMAGE_FILE","IMAGE_FILE")))}else if("video"==n.getType()){if(!s.isVideo(n.file))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID_MEDIA_FILE),"VIDEO_FILE","VIDEO_FILE")))}else if("audio"==n.getType()&&!s.isAudio(n.file))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID_MEDIA_FILE),"AUDIO_FILE","AUDIO_FILE")))}if(t instanceof l.CustomMessage&&h(t.getCustomData()))return new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"CUSTOM_DATA","CUSTOM_DATA","Custom Data")))},s.validateCreateUser=function(t){return t.hasOwnProperty(r.UserConstants.UID)?typeof t[r.UserConstants.UID]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"UID","UID","uid"))):h(t[r.UserConstants.UID])?new a.CometChatException({code:"Empty UID"}):t.hasOwnProperty(r.UserConstants.NAME)?typeof t[r.UserConstants.NAME]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"USER_NAME","USER_NAME","user name"))):h(t[r.UserConstants.NAME])?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.INVALID),"USER_NAME","USER_NAME","user name"))):t.hasOwnProperty(r.UserConstants.AVATAR)&&""===t[r.UserConstants.AVATAR]?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.EMPTY_STRING),"USER_AVATAR","USER_AVATAR","user avatar"))):t.hasOwnProperty(r.UserConstants.META_DATA)&&""===t[r.UserConstants.META_DATA]?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.EMPTY_STRING),"USER_METADATA","USER_METADATA","user metadata"))):t.hasOwnProperty(r.UserConstants.LINK)&&""===t[r.UserConstants.LINK]?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.EMPTY_STRING),"USER_LINK","USER_LINK","user link"))):t.hasOwnProperty(r.UserConstants.STATUS_MESSAGE)&&""===t[r.UserConstants.STATUS_MESSAGE]?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.EMPTY_STRING),"USER_STATUS_MESSAGE","USER_STATUS_MESSAGE","user status message"))):t.hasOwnProperty(r.UserConstants.ROLE)&&""===t[r.UserConstants.ROLE]?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.EMPTY_STRING),"USER_ROLE","USER_ROLE","user role"))):void 0:new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"USER_NAME","USER_NAME","user name"))):new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"UID","UID","uid")))},s.validateUpdateUser=function(t){return t.hasOwnProperty(r.UserConstants.UID)?typeof t[r.UserConstants.UID]!==r.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.MUST_BE_A_STRING),"UID","UID","uid"))):h(t[r.UserConstants.UID])?new a.CometChatException({code:"Empty UID"}):t.hasOwnProperty(r.UserConstants.NAME)&&""===t[r.UserConstants.NAME]?new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.EMPTY_STRING),"USER_NAME","USER_NAME","user name"))):void 0:new a.CometChatException(JSON.parse(p(JSON.stringify(r.GENERAL_ERROR.COMPULSORY),"UID","UID","uid")))},s.SHA1=function(t){var e,n,s,o,r,i,a,c,u,l=new Array(80),E=1732584193,h=4023233417,p=2562383102,d=271733878,C=3285377520,g=(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var s=t.charCodeAt(n);s<128?e+=String.fromCharCode(s):(127<s&&s<2048?e+=String.fromCharCode(s>>6|192):(e+=String.fromCharCode(s>>12|224),e+=String.fromCharCode(s>>6&63|128)),e+=String.fromCharCode(63&s|128))}return e}(t)).length,_=new Array;for(n=0;n<g-3;n+=4)s=t.charCodeAt(n)<<24|t.charCodeAt(n+1)<<16|t.charCodeAt(n+2)<<8|t.charCodeAt(n+3),_.push(s);switch(g%4){case 0:n=2147483648;break;case 1:n=t.charCodeAt(g-1)<<24|8388608;break;case 2:n=t.charCodeAt(g-2)<<24|t.charCodeAt(g-1)<<16|32768;break;case 3:n=t.charCodeAt(g-3)<<24|t.charCodeAt(g-2)<<16|t.charCodeAt(g-1)<<8|128}for(_.push(n);_.length%16!=14;)_.push(0);for(_.push(g>>>29),_.push(g<<3&4294967295),e=0;e<_.length;e+=16){for(n=0;n<16;n++)l[n]=_[e+n];for(n=16;n<=79;n++)l[n]=S(l[n-3]^l[n-8]^l[n-14]^l[n-16],1);for(o=E,r=h,i=p,a=d,c=C,n=0;n<=19;n++)u=S(o,5)+(r&i|~r&a)+c+l[n]+1518500249&4294967295,c=a,a=i,i=S(r,30),r=o,o=u;for(n=20;n<=39;n++)u=S(o,5)+(r^i^a)+c+l[n]+1859775393&4294967295,c=a,a=i,i=S(r,30),r=o,o=u;for(n=40;n<=59;n++)u=S(o,5)+(r&i|r&a|i&a)+c+l[n]+2400959708&4294967295,c=a,a=i,i=S(r,30),r=o,o=u;for(n=60;n<=79;n++)u=S(o,5)+(r^i^a)+c+l[n]+3395469782&4294967295,c=a,a=i,i=S(r,30),r=o,o=u;E=E+o&4294967295,h=h+r&4294967295,p=p+i&4294967295,d=d+a&4294967295,C=C+c&4294967295}return(f(E)+f(h)+f(p)+f(d)+f(C)).toLowerCase()}},function(t,e,n){"use strict";e.__esModule=!0;var s=function(t){null!==t.code&&void 0!==t.code&&""!==t.code&&(this.code=t.code),null!==t.name&&void 0!==t.name&&""!==t.name&&(this.name=t.name),null!==t.message&&void 0!==t.message&&""!==t.message&&(this.message=t.message),null!==t.details&&void 0!==t.details&&""!==t.details&&(this.details=t.details)};e.CometChatException=s},function(t,W,$){"use strict";(function(e){var p=this&&this.__assign||function(){return(p=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},u=this&&this.__awaiter||function(r,i,a,c){return new(a||(a=Promise))(function(t,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,s)}o((c=c.apply(r,i||[])).next())})},l=this&&this.__generator||function(n,s){var o,r,i,t,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(i=2&e[0]?r.return:e[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,e[1])).done)return i;switch(r=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){a.label=e[1];break}if(6===e[0]&&a.label<i[1]){a.label=i[1],i=e;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(e);break}i[2]&&a.ops.pop(),a.trys.pop();continue}e=s.call(n,a)}catch(t){e=[6,t],r=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};W.__esModule=!0;var t=$(26),C=$(1),g=$(2),_=$(4),E=$(5),a=$(13),c=$(14),h=$(9),S=$(18),f=$(17),T=$(7),n=$(21),m=$(8),A=$(0),I=$(6),N=$(16),s=$(32),i=$(49),o=$(20),r=$(23),R=$(24),O=$(15),y=$(22),M=$(50),P=$(51),v=$(53),L=$(54),U=$(55),D=$(56),w=$(36),Y=$(28),b=$(29),G=$(19),x=$(33),B=$(57),F=$(30),K=$(25),H=$(58),k=$(31),J=$(59),V=$(35),X=$(60),j=a.XMPPConnectionHelper.getInstance(),q=$(63),d=function(){function d(t){try{C.Logger.info("This is react-native","we do not have dom"),e.DOMParser=$(68).DOMParser,e.document=(new e.DOMParser).parseFromString("<?xml version='1.0'?>","text/xml"),d.isNative=!0,d.typingTimer(),d.appId=t,d.messagesStore=n.MessagesStore.getInstance(),d.localStorage=h.LocalStorage.getInstance(),d.userStore=s.UserStore.getInstance(),d.keyStore=i.KeyStore.getInstance(),d.messageListnerMaping=w.MessageListnerMaping.getInstance()}catch(t){C.Logger.error("CometChat: constructor",t)}}return d.setAuthToken=function(t){try{d.authToken=t}catch(t){C.Logger.error("CometChat: setAuthToken",t)}},d.prototype.getAuthToken=function(){try{return d.authToken}catch(t){C.Logger.error("CometChat: getAuthToken",t)}},d.getAppId=function(){try{return d.appId}catch(t){C.Logger.error("CometChat: getAppId",t)}},d.prototype.getApiKey=function(){try{return d.apiKey}catch(t){C.Logger.error("CometChat: getApiKey",t)}},d.init=function(o,t){var r=this;return void 0===o&&(o=""),void 0===t&&(t={}),new Promise(function(n,s){try{"object"==typeof o&&(o.hasOwnProperty("appId")&&(o=o.appId),o.hasOwnProperty("appSettings")&&(t=o.appSettings)),C.isFalsy(t)?t=(new k.AppSettingsBuilder).setRegion(k.AppSettings.REGION_EU).build():t.getRegion()==k.AppSettings.REGION_PRIVATE&&(t.region=o),r.appSettings=t,C.isFalsy(o)?s(new g.CometChatException(O.INIT_ERROR.NO_APP_ID)):(r.initialzed=!0,h.LocalStorage.getInstance().get("appId").then(function(t){if(null==t||null==t)d.appId=o,h.LocalStorage.getInstance().set("appId",o),d.getInstance(o),n(!0);else{var e=t.toLocaleString();e===o?(d.appId=e,d.getInstance(e),n(!0),h.LocalStorage.getInstance().get("user").then(function(t){t?(d.user=new E.Me(t),d.setAuthToken(d.user.getAuthToken()),d.XMPPLogin(d.user,function(){n(!0)},function(){s("error in connecting to xmpp server")})):n(!0)})):r.clearCache().then(function(){d.apiKey=void 0,d.user=void 0,d.authToken=void 0,d.cometChat=void 0,a.XMPPConnectionHelper.getInstance().XMPPDisconnect(),d.appId=o,h.LocalStorage.getInstance().set("appId",o),d.getInstance(o),n(!0)})}}),i.KeyStore.getInstance().get("deviceId").then(function(t){if(null==t){var e=X(),n=(new Date).getTime(),s=o+"_"+e+"_"+n;i.KeyStore.getInstance().set("deviceId",s)}}))}catch(t){s(new g.CometChatException(t))}})},d.isInitialized=function(){try{return this.initialzed}catch(t){C.Logger.error("CometChat: isInitialized",t)}},d.getInstance=function(t){try{return this.cometChat||(this.cometChat=new d(t)),this.cometChat}catch(t){C.Logger.error("CometChat: getInstance",t)}},d.registerTokenForPushNotification=function(E,h){var p=this;return new Promise(function(u,l){try{d.keyStore.get("deviceId").then(function(t){var e="",n=t,s=A.APPINFO.platform,o=A.APPINFO.sdkVersion,r=A.APPINFO.apiVersion;if(navigator&&(e=navigator.userAgent),null==n){var i=X(),a=(new Date).getTime();n=p.appId+"_"+i+"_"+a,d.keyStore.set("deviceId",n)}var c={platform:s,userAgent:e,deviceId:n,appInfo:{version:o,apiVersion:r,pushNotification:{fcmDeviceToken:E,settings:h}}};_.makeApiCall("updateMyDetails",{},c,!1).then(function(t){u("Token Registration successful")},function(t){l(new g.CometChatException(t.error))}).catch(function(t){l(new g.CometChatException(t))})})}catch(t){l(new g.CometChatException(t))}})},d.login=function(){for(var r=this,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];return new Promise(function(s,o){try{d.localStorage.get("appId").then(function(t){if(null==t||null==t)return o(new g.CometChatException(O.LOGIN_ERROR.NOT_INITIALIZED));var e=t.toLocaleString();if(r.getInstance(e),d.appId=e,h.LocalStorage.getInstance().set("appId",e),"object"==typeof i[0]){var n=i[0];i[0].hasOwnProperty("authToken")?i[0]=n.authToken:i[0].hasOwnProperty("username")&&i[0].hasOwnProperty("apiKey")&&(i[0]=n.username,i[1]=n.apiKey)}if(2==i.length?(C.isFalsy(i[0])||C.isFalsy(i[1]))&&o(new g.CometChatException(O.ERRORS.PARAMETER_MISSING)):1==i.length?C.isFalsy(i[0])&&o(new g.CometChatException(O.ERRORS.PARAMETER_MISSING)):o(new g.CometChatException(O.ERRORS.PARAMETER_MISSING)),!C.isFalsy(r.getAppId()))return d.localStorage.get("user").then(function(n){if(2==i.length){d.isSecure=!1,d.apiKey=i[1];var t=i[0];null!=n&&n.uid!==i[0]?r.messagesStore.clearStore().then(function(){d.userStore.clearStore().then(function(){d.localStorage.clearStore().then(function(){a.XMPPConnectionHelper.getInstance().XMPPDisconnect(),d.generateAuthToken(t).then(function(t){d.user=new E.Me(t),d.setAuthToken(d.user.getAuthToken()),d.getLoggedInUser().then(function(t){(d.user=new E.Me(t)).setAuthToken(d.authToken),d.setAuthToken(d.user.getAuthToken()),K.ExtensionController.hookOnLogin(d.user),d.XMPPLogin(d.user,s,o)},function(t){o(new g.CometChatException(t.error))})},function(t){o(new g.CometChatException(t))})})})}):C.isFalsy(d.authToken)?C.isFalsy(t)||(C.isFalsy(d.apiKey)?o(new g.CometChatException(O.LOGIN_ERROR.UNAUTHORISED)):r.generateAuthToken(t).then(function(t){r.user=new E.Me(t),r.setAuthToken(d.user.getAuthToken()),r.getLoggedInUser().then(function(t){r.user=new E.Me(t),r.user.setAuthToken(d.authToken),r.setAuthToken(r.user.getAuthToken()),K.ExtensionController.hookOnLogin(d.user),a.XMPPConnectionHelper.getInstance().XMPPDisconnect(),r.XMPPLogin(r.user,s,o)},function(t){o(new g.CometChatException(t.error))})},function(t){o(new g.CometChatException(t))})):(K.ExtensionController.hookOnLogin(d.user),s(new E.User(r.user)))}else d.authToken=i[0],d.isSecure=!0,r.getLoggedInUser().then(function(t){if(t.authToken!=i[0]){var e=r;e.messagesStore.clearStore().then(function(){e.userStore.clearStore().then(function(){e.localStorage.clearStore().then(function(){a.XMPPConnectionHelper.getInstance().XMPPDisconnect(),e.getLoggedInUser().then(function(t){d.XMPPLogin(new E.Me(t),s,o)},function(t){o(new g.CometChatException(t))})})})})}else n?s(new E.User(t)):d.XMPPLogin(new E.Me(t),s,o)},function(t){o(new g.CometChatException(t))})});o(new g.CometChatException(O.LOGIN_ERROR.NOT_INITIALIZED))})}catch(t){o(new g.CometChatException(t))}})},d.sendMessage=function(c){var t=this;return new Promise(function(i,a){return u(t,void 0,void 0,function(){var e,n,s,o,r=this;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),c instanceof f.TextMessage||c instanceof S.MediaMessage||c instanceof G.CustomMessage||(c=c[A.MessageConstatnts.KEYS.ATTATCHMENT]?(e=A.MessageConstatnts.TYPE.FILE,C.isImage(c[A.MessageConstatnts.KEYS.ATTATCHMENT])?e=A.MessageConstatnts.TYPE.IMAGE:C.isAudio(c[A.MessageConstatnts.KEYS.ATTATCHMENT])?e=A.MessageConstatnts.TYPE.AUDIO:C.isVideo(c[A.MessageConstatnts.KEYS.ATTATCHMENT])&&(e=A.MessageConstatnts.TYPE.VIDEO),new S.MediaMessage(c[A.MessageConstatnts.KEYS.RECEIVER_ID],c[A.MessageConstatnts.KEYS.ATTATCHMENT],e,c[A.MessageConstatnts.KEYS.RECEIVER_TYPE])):new f.TextMessage(c[A.MessageConstatnts.KEYS.RECEIVER_ID],c[A.MessageConstatnts.KEYS.TEXT],c[A.MessageConstatnts.KEYS.RECEIVER_TYPE])),[4,K.ExtensionController.hookBeforeMessageSent(c)];case 1:return n=t.sent(),c=n,(s=C.validateMessage(c))instanceof g.CometChatException?(a(s),[2]):(c.receiver=c.receiverId,delete c.receiverId,[2,_.makeApiCall("sendMessage",{},c,c instanceof S.MediaMessage).then(function(s){return u(r,void 0,void 0,function(){var e,n;return l(this,function(t){switch(t.label){case 0:return e=T.MessageController.trasformJSONMessge(s.data),[4,K.ExtensionController.hookAfterMessageSent(e)];case 1:return n=t.sent(),i(e=n),[2]}})})},function(t){a(new g.CometChatException(t.error))})]);case 2:return o=t.sent(),a(new g.CometChatException(o)),[3,3];case 3:return[2]}})})})},d.sendDirectMessage=function(t){try{return Object.assign(t,{receiverType:A.MessageConstatnts.RECEIVER_TYPE.USER}),this.sendMessage(t)}catch(t){C.Logger.error("CometChat: sendDirectMessage",t)}},d.sendGroupMessage=function(t){try{return Object.assign(t,{receiverType:A.MessageConstatnts.RECEIVER_TYPE.GROUP}),this.sendMessage(t)}catch(t){C.Logger.error("CometChat: sendGroupMessage",t)}},d.sendMediaMessage=function(t){try{return this.sendMessage(t)}catch(t){C.Logger.error("CometChat: sendMediaMessage",t)}},d.sendCustomMessage=function(t){try{return this.sendMessage(t)}catch(t){C.Logger.error("CometChat: sendCustomMessage",t)}},d.getLastDeliveredMessageId=function(){return u(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,w.MessageListnerMaping.getInstance().get("all")];case 1:return[2,t.sent()];case 2:return e=t.sent(),C.Logger.error("CometChat: getLastDeliveredMessageId",e),[3,3];case 3:return[2]}})})},d.startTyping=function(t){try{if(C.isFalsy(t))return;var e,n=this.RECEIVER_TYPE.USER,s={};if(t instanceof Y.TypingIndicator)e=t.getReceiverId(),n=t.getReceiverType(),s=t.getMetadata();else{if(!t.hasOwnProperty(A.TYPING_NOTIFICATION.RECEIVER_ID))return;e=t[A.TYPING_NOTIFICATION.RECEIVER_ID],t.hasOwnProperty(A.TYPING_NOTIFICATION.RECEIVER_TYPE)&&(n=t[A.TYPING_NOTIFICATION.RECEIVER_TYPE]),t.hasOwnProperty(A.TYPING_NOTIFICATION.META)&&(s=t[A.TYPING_NOTIFICATION.META])}if(C.isFalsy(e))return;n=n==this.RECEIVER_TYPE.USER?A.XMPP.CONVERSATION.TYPE.CHAT:A.XMPP.CONVERSATION.TYPE.GROUP_CHAT,(b.TypingNotificationController.getTypingStartedMap(e)&&C.getCurrentTime()-b.TypingNotificationController.getTypingStartedMap(e)>=1e3*A.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT||null==b.TypingNotificationController.getTypingStartedMap(e))&&C.getAppSettings().then(function(t){switch(n){case A.XMPP.CONVERSATION.TYPE.CHAT:j.sendTypingStarted(C.format(A.XMPP.bare_jid_string,d.getAppId(),e,t[A.APP_SETTINGS.KEYS.CHAT_HOST]),n,s);break;case A.XMPP.CONVERSATION.TYPE.GROUP_CHAT:j.sendTypingStarted(C.format(A.XMPP.muc_jid_string,d.getAppId(),e,t[A.APP_SETTINGS.KEYS.GROUP_SERVICE],t[A.APP_SETTINGS.KEYS.CHAT_HOST]),n,s)}b.TypingNotificationController.addTypingStarted(e)},function(t){})}catch(t){C.Logger.error("CometChat: startTyping",t)}},d.endTyping=function(t){try{if(!C.isFalsy(t)){var e,n=this.RECEIVER_TYPE.USER,s={};if(t instanceof Y.TypingIndicator)e=t.getReceiverId(),n=t.getReceiverType(),s=t.getMetadata();else{if(!t.hasOwnProperty(A.TYPING_NOTIFICATION.RECEIVER_ID))return;e=t[A.TYPING_NOTIFICATION.RECEIVER_ID],t.hasOwnProperty(A.TYPING_NOTIFICATION.RECEIVER_TYPE)&&(n=t[A.TYPING_NOTIFICATION.RECEIVER_TYPE]),n=n==this.RECEIVER_TYPE.USER?A.XMPP.CONVERSATION.TYPE.CHAT:A.XMPP.CONVERSATION.TYPE.GROUP_CHAT,t.hasOwnProperty(A.TYPING_NOTIFICATION.META)&&(s=t[A.TYPING_NOTIFICATION.META])}if(C.isFalsy(e))return;n=n==this.RECEIVER_TYPE.USER?A.XMPP.CONVERSATION.TYPE.CHAT:A.XMPP.CONVERSATION.TYPE.GROUP_CHAT,b.TypingNotificationController.getTypingStartedMap(e)&&C.getCurrentTime()-b.TypingNotificationController.getTypingStartedMap(e)<1e3*A.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&(b.TypingNotificationController.getTypingEndedMap(e)&&C.getCurrentTime()-b.TypingNotificationController.getTypingEndedMap(e)>=1e3*A.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT||null==b.TypingNotificationController.getTypingEndedMap(e))&&C.getAppSettings().then(function(t){switch(n){case A.XMPP.CONVERSATION.TYPE.CHAT:j.sendTypingPaused(C.format(A.XMPP.bare_jid_string,d.getAppId(),e,t[A.APP_SETTINGS.KEYS.CHAT_HOST]),n,s);break;case A.XMPP.CONVERSATION.TYPE.GROUP_CHAT:j.sendTypingPaused(C.format(A.XMPP.muc_jid_string,d.getAppId(),e,t[A.APP_SETTINGS.KEYS.GROUP_SERVICE],t[A.APP_SETTINGS.KEYS.CHAT_HOST]),n,s)}b.TypingNotificationController.addTypingEnded(e)},function(t){})}}catch(t){C.Logger.error("CometChat: endTyping",t)}},d.markAsRead=function(t,e,n){try{a.XMPPConnectionHelper.getInstance().markAsRead(e,n,t)}catch(t){C.Logger.error("CometChat: markAsRead",t)}},d.markAsDelivered=function(t,e,n){try{a.XMPPConnectionHelper.getInstance().markAsDelivered(e,n,t)}catch(t){C.Logger.error("CometChat: markAsDelivered",t)}},d.getMessageDetails=function(t){return new Promise(function(e,n){try{C.isFalsy(t)?n(new g.CometChatException(O.ERRORS.PARAMETER_MISSING)):_.makeApiCall("getMessageDetails",{messageId:t}).then(function(t){e(T.MessageController.trasformJSONMessge(t.data))},function(t){C.Logger.error("CometChat:GetMessageDetails:",t),n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.getMessageReceipts=function(s){return new Promise(function(e,n){try{var t=C.validateMsgId(s);if(t instanceof g.CometChatException)return void n(t);C.isFalsy(s)?n(new g.CometChatException(O.ERRORS.PARAMETER_MISSING)):_.makeApiCall("getMessageDetails",{messageId:s}).then(function(t){T.MessageController.getReceiptsFromJSON(t.data).then(function(t){e(t)},function(t){n(new g.CometChatException(t))})},function(t){C.Logger.error("CometChat:GetMessageDetails:",t),n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.getUnreadMessageCount=function(n){void 0===n&&(n=!1);var o=0;return new Promise(function(s,e){try{var t=C.validateHideMessagesFromBlockedUsers(n);if(t instanceof g.CometChatException)return void e(t);n&&(o=1),_.makeApiCall("getMessages",{},{unread:1,count:1,hideMessagesFromBlockedUsers:o}).then(function(t){var e={},n={};t.data.map(function(t){t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_TYPE]==A.MessageConstatnts.RECEIVER_TYPE.GROUP?n[t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT]:e[t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT]}),s({users:e,groups:n})},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.getUnreadMessageCountForAllUsers=function(s){void 0===s&&(s=!1);var o=0;return new Promise(function(n,e){try{var t=C.validateHideMessagesFromBlockedUsers(s);if(t instanceof g.CometChatException)return void e(t);s&&(o=1),_.makeApiCall("getMessages",{},{hideMessagesFromBlockedUsers:o,receiverType:A.MessageConstatnts.RECEIVER_TYPE.USER,unread:1,count:1}).then(function(t){var e={};t.data.map(function(t){e[t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT]}),n(p({},e))},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.getUnreadMessageCountForAllGroups=function(s){void 0===s&&(s=!1);var o=0;return new Promise(function(n,e){try{var t=C.validateHideMessagesFromBlockedUsers(s);if(t instanceof g.CometChatException)return void e(t);s&&(o=1),_.makeApiCall("getMessages",{},{hideMessagesFromBlockedUsers:o,receiverType:A.MessageConstatnts.RECEIVER_TYPE.GROUP,unread:1,count:1}).then(function(t){var e={};t.data.map(function(t){t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_TYPE]==A.MessageConstatnts.RECEIVER_TYPE.GROUP&&(e[t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT])}),n(p({},e))},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.getUnreadMessageCountForUser=function(o,r){void 0===r&&(r=!1);var i=0;return new Promise(function(n,e){try{var t=C.validateId(o);if(t instanceof g.CometChatException)return void e(t);var s=C.validateHideMessagesFromBlockedUsers(r);if(s instanceof g.CometChatException)return void e(s);r&&(i=1),_.makeApiCall("getUserMessages",{listId:o},{hideMessagesFromBlockedUsers:i,unread:1,count:1,uid:o}).then(function(t){var e={};t.data.map(function(t){e[t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT]}),n(p({},e))},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.getUnreadMessageCountForGroup=function(o,r){void 0===r&&(r=!1);var i=0;return new Promise(function(n,e){try{var t=C.validateId(o);if(t instanceof g.CometChatException)return void e(t);var s=C.validateHideMessagesFromBlockedUsers(r);if(s instanceof g.CometChatException)return void e(s);r&&(i=1),_.makeApiCall("getGroupMessages",{listId:o},{hideMessagesFromBlockedUsers:i,unread:1,count:1,guid:o}).then(function(t){var e={};t.data.map(function(t){t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_TYPE]==A.MessageConstatnts.RECEIVER_TYPE.GROUP&&(e[t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.ENTITY_Id]]=t[A.ResponseConstants.RESPONSE_KEYS.UNREAD_UNDELIVERED_KEYS.COUNT])}),n(p({},e))},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.editMessage=function(s){return new Promise(function(e,n){try{var t=C.validateMsgId(s.getId());if(t instanceof g.CometChatException)return void n(t);_.makeApiCall("updateMessage",{messageId:s.getId()},s).then(function(t){e(T.MessageController.trasformJSONMessge(t.data).getActionOn())},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.deleteMessage=function(s){return new Promise(function(e,n){try{var t=C.validateMsgId(s);if(t instanceof g.CometChatException)return void n(t);_.makeApiCall("deleteMessage",{messageId:s},{id:s}).then(function(t){e(T.MessageController.trasformJSONMessge(t.data).getActionOn())},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.getPreviousMessagesByTimestamp=function(t,s){return new Promise(function(e,n){try{C.isFalsy(s)?n(new g.CometChatException(JSON.parse(C.format(JSON.stringify(A.PARAMETER_ERROR.PARAMETER_REQUIRED),"TIMESTAMP","TIMESTAMP","timestamp")))):T.MessageController.getAllMessage(t,s,A.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,A.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(t){return e(t)},function(t){return n(new g.CometChatException(t))})}catch(t){n(new g.CometChatException(t))}})},d.getPreviousMessagesById=function(t,s){return new Promise(function(e,n){try{C.isFalsy(s)?n(new g.CometChatException(JSON.parse(C.format(JSON.stringify(A.PARAMETER_ERROR.PARAMETER_REQUIRED),"ID","ID","id")))):T.MessageController.getAllMessage(t,s,A.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,A.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(t){return e(t)},function(t){return n(new g.CometChatException(t))})}catch(t){n(new g.CometChatException(t))}})},d.getNextMessagesByTimestamp=function(t,s){return new Promise(function(e,n){try{C.isFalsy(s)?n(new g.CometChatException(JSON.parse(C.format(JSON.stringify(A.PARAMETER_ERROR.PARAMETER_REQUIRED),"TIMESTAMP","TIMESTAMP","timestamp")))):T.MessageController.getAllMessage(t,s,A.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,A.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(t){return e(t)},function(t){return n(new g.CometChatException(t))})}catch(t){n(new g.CometChatException(t))}})},d.getNextMessagesById=function(t,s){return new Promise(function(e,n){try{C.isFalsy(s)?n(new g.CometChatException(JSON.parse(C.format(JSON.stringify(A.PARAMETER_ERROR.PARAMETER_REQUIRED),"ID","ID","id")))):T.MessageController.getAllMessage(t,s,A.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,A.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(t){return e(t)},function(t){return n(new g.CometChatException(t))})}catch(t){n(new g.CometChatException(t))}})},d.createUser=function(o,r){return new Promise(function(n,e){try{if(C.isFalsy(r))return void e(new g.CometChatException(JSON.parse(C.format(JSON.stringify(A.GENERAL_ERROR.INVALID),"API_KEY","API_KEY","API_KEY"))));d.apiKey=r;var t=C.validateCreateUser(o);if(t instanceof g.CometChatException)return void e(t);if(!(o instanceof E.User)){var s=void 0;if(!o.hasOwnProperty(A.UserConstants.UID))return void e(new g.CometChatException(O.ERRORS.PARAMETER_MISSING));if(!o.hasOwnProperty(A.UserConstants.NAME))return void e(new g.CometChatException(O.ERRORS.PARAMETER_MISSING));s=new E.User(o[A.UserConstants.UID],o[A.UserConstants.NAME]),o.hasOwnProperty(A.UserConstants.AVATAR)&&s.setAvatar(o[A.UserConstants.AVATAR]),o.hasOwnProperty(A.UserConstants.ROLE)&&s.setRole(o[A.UserConstants.ROLE]),o.hasOwnProperty(A.UserConstants.META_DATA)&&s.setMetadata(o[A.UserConstants.META_DATA]),o.hasOwnProperty(A.UserConstants.LINK)&&s.setLink(o[A.UserConstants.LINK]),o.hasOwnProperty(A.UserConstants.STATUS_MESSAGE)&&s.setStatusMessage(o[A.UserConstants.STATUS_MESSAGE]),o=s}_.makeApiCall("createUser",{},o).then(function(t){var e=m.UsersController.trasformJSONUser(t.data);n(e)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.updateUser=function(r,i){return new Promise(function(n,e){try{if(C.isFalsy(i))return void e(new g.CometChatException(JSON.parse(C.format(JSON.stringify(A.GENERAL_ERROR.INVALID),"API_KEY","API_KEY","API_KEY"))));d.apiKey=i;var t=C.validateUpdateUser(r);if(t instanceof g.CometChatException)return void e(t);if(!(r instanceof E.User)){var s=void 0;if(!r.hasOwnProperty(A.UserConstants.UID))return void e(new g.CometChatException(O.ERRORS.PARAMETER_MISSING));s=new E.User(r[A.UserConstants.UID]),r.hasOwnProperty(A.UserConstants.NAME)&&s.setName(r[A.UserConstants.NAME]),r.hasOwnProperty(A.UserConstants.AVATAR)&&s.setAvatar(r[A.UserConstants.AVATAR]),r.hasOwnProperty(A.UserConstants.ROLE)&&s.setRole(r[A.UserConstants.ROLE]),r.hasOwnProperty(A.UserConstants.META_DATA)&&s.setMetadata(r[A.UserConstants.META_DATA]),r.hasOwnProperty(A.UserConstants.LINK)&&s.setLink(r[A.UserConstants.LINK]),r.hasOwnProperty(A.UserConstants.STATUS_MESSAGE)&&s.setStatusMessage(r[A.UserConstants.STATUS_MESSAGE]),r=s}var o=r.uid;_.makeApiCall("updateUser",{uid:o},r).then(function(t){var e=m.UsersController.trasformJSONUser(t.data);n(e)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.getUser=function(s){return new Promise(function(n,e){try{"object"==typeof s&&s.hasOwnProperty("uid")&&(s=s.uid);var t=C.validateId(s);if(t instanceof g.CometChatException)return void e(t);_.makeApiCall("user",{uid:s}).then(function(t){var e=m.UsersController.trasformJSONUser(t.data);n(e)}).catch(function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.getLoggedInUser=function(){var l=this;return new Promise(function(c,u){try{d.localStorage.get("user").then(function(t){if(t)c(d.user=new E.Me(t));else{var s="",o="",r=A.APPINFO.platform,i=A.APPINFO.sdkVersion,a=A.APPINFO.apiVersion;d.keyStore.get("deviceId").then(function(t){if(o=t,navigator&&(s=navigator.userAgent),null==o){var e=l.appId.substr(0,l.appId.length-10)+"_"+X()+"_"+(new Date).getTime();o=C.SHA1(e),d.keyStore.set("deviceId",o)}var n={platform:r,userAgent:s,deviceId:o,appInfo:{version:i,apiVersion:a}};_.makeApiCall("updateMyDetails",{},n,!1).then(function(t){c(new E.Me(t.data))},function(t){u(new g.CometChatException(t.error))}).catch(function(t){u(new g.CometChatException(t))})})}})}catch(t){u(new g.CometChatException(t))}})},d.getLoggedinUser=function(){return new Promise(function(e,n){try{d.localStorage.get("user").then(function(t){e(t?new E.User(t):null)},function(t){e(null)})}catch(t){n(new g.CometChatException(t))}})},d.blockUsers=function(s){return new Promise(function(e,n){try{var t=C.validateArray(s);if(t instanceof g.CometChatException)return void n(t);C.isFalsy(s)?n(new g.CometChatException(O.USERS_REQUEST_ERRORS.EMPTY_USERS_LIST)):_.makeApiCall("blockUsers",{},{blockedUids:s}).then(function(t){e(t.data)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.unblockUsers=function(s){return new Promise(function(e,n){try{var t=C.validateArray(s);if(t instanceof g.CometChatException)return void n(t);C.isFalsy(s)?n(new g.CometChatException(O.USERS_REQUEST_ERRORS.EMPTY_USERS_LIST)):_.makeApiCall("unblockUsers",{},{blockedUids:s}).then(function(t){e(t.data)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.createGroup=function(o){return new Promise(function(e,n){try{var t=C.validateCreateGroup(o);if(t instanceof g.CometChatException)return void n(t);if(!(o instanceof I.Group)){var s=void 0;if(!o.hasOwnProperty(A.GroupConstants.KEYS.GUID))return void n(new g.CometChatException(O.ERRORS.PARAMETER_MISSING));if(!o.hasOwnProperty(A.GroupConstants.KEYS.NAME))return void n(new g.CometChatException(O.ERRORS.PARAMETER_MISSING));if(s=new I.Group(o[A.GroupConstants.KEYS.GUID],o[A.GroupConstants.KEYS.NAME],""),o.hasOwnProperty(A.GroupConstants.KEYS.TYPE))if(o[A.GroupConstants.KEYS.TYPE].toLocaleLowerCase()==A.GroupType.Password){if(!o.hasOwnProperty(A.GroupConstants.KEYS.PASSWORD))return void n(new g.CometChatException(O.GROUP_CREATION_ERRORS.EMPTY_PASSWORD));s.setType(A.GROUP_TYPE.PASSWORD),s.setPassword(o[A.GroupConstants.KEYS.PASSWORD])}else s.setType(o[A.GroupConstants.KEYS.TYPE]);else s.setType(A.GROUP_TYPE.PUBLIC);o.hasOwnProperty(A.GroupConstants.KEYS.ICON)&&s.setIcon(o[A.GroupConstants.KEYS.ICON]),o.hasOwnProperty(A.GroupConstants.KEYS.DESCRIPTION)&&s.setDescription(o[A.GroupConstants.KEYS.DESCRIPTION]),o=s}_.makeApiCall("createGroup",{},o).then(function(t){j.joinMuc(o),N.GroupsController.trasformJSONGroup(t.data).setHasJoined(!0),e(N.GroupsController.trasformJSONGroup(t.data))},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.getGroup=function(s){return new Promise(function(e,n){try{"object"==typeof s&&s.hasOwnProperty("guid")&&(s=s.guid);var t=C.validateId(s);if(t instanceof g.CometChatException)return void n(t);_.makeApiCall("getGroup",{guid:s}).then(function(t){e(N.GroupsController.trasformJSONGroup(t.data))},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.getJoinedGroups=function(){return new Promise(function(e,n){try{j.getRooms().then(function(t){e(t)},function(t){n(t)})}catch(t){n(new g.CometChatException(t))}})},d.joinGroup=function(o,r,i){return void 0===r&&(r=A.GroupType.Public),void 0===i&&(i=""),new Promise(function(n,e){try{var s,t=C.validateJoinGroup(o,r,i);if(t instanceof g.CometChatException)return void e(t);"object"==typeof o&&(o.hasOwnProperty(A.GroupConstants.KEYS.GUID)?(o.hasOwnProperty(A.GroupConstants.KEYS.TYPE)&&(r=o[A.GroupConstants.KEYS.TYPE],o[A.GroupConstants.KEYS.TYPE].toLocaleLowerCase()===A.GroupType.Password&&o.hasOwnProperty(A.GroupConstants.KEYS.PASSWORD)&&(i=o[A.GroupConstants.KEYS.PASSWORD])),o=o[A.GroupConstants.KEYS.GUID]):e(new g.CometChatException(O.ERRORS.PARAMETER_MISSING))),s=C.isFalsy(i)?new I.Group(o,"name",r):new I.Group(o,"name",r,i),_.makeApiCall("joinGroup",s,s).then(function(t){j.joinMuc(s);var e=N.GroupsController.trasformJSONGroup(t.data[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA][A.ActionConstatnts.ACTION_KEYS.ENTITIES][A.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][A.ActionConstatnts.ACTION_KEYS.ENTITY]);e.setHasJoined(!0),n(e)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.updateGroup=function(o){return new Promise(function(e,n){try{var t=C.validateUpdateGroup(o);if(t instanceof g.CometChatException)return void n(t);if(!(o instanceof I.Group)){var s=void 0;if(!o.hasOwnProperty(A.GroupConstants.KEYS.GUID))return void n(new g.CometChatException(O.ERRORS.PARAMETER_MISSING));s=new I.Group(A.GroupConstants.KEYS.GUID,"",""),o.hasOwnProperty(A.GroupConstants.KEYS.TYPE)?s.setType(o[A.GroupConstants.KEYS.TYPE]):(o[A.GroupConstants.KEYS.TYPE]=A.GROUP_TYPE.PUBLIC,s.setType[A.GROUP_TYPE.PUBLIC]),o.hasOwnProperty(A.GroupConstants.KEYS.NAME)&&s.setName(o[A.GroupConstants.KEYS.NAME]),o.hasOwnProperty(A.GroupConstants.KEYS.ICON)&&s.setIcon(o[A.GroupConstants.KEYS.ICON]),o.hasOwnProperty(A.GroupConstants.KEYS.DESCRIPTION)&&s.setDescription(o[A.GroupConstants.KEYS.DESCRIPTION]),o=s}_.makeApiCall("updateGroup",o,o).then(function(t){e(N.GroupsController.trasformJSONGroup(t.data))},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.deleteGroup=function(s){return new Promise(function(e,n){try{var t=C.validateId(s);if(t instanceof g.CometChatException)return void n(t);_.makeApiCall("deleteGroup",{guid:s}).then(function(t){e(!0)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.leaveGroup=function(s){return new Promise(function(e,n){try{var t=C.validateId(s);if(t instanceof g.CometChatException)return void n(t);_.makeApiCall("leaveGroup",{guid:s}).then(function(t){j.leaveMuc(s),e(!0)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.kickGroupMember=function(o,r){return new Promise(function(e,n){try{var t=C.validateId(o);if(t instanceof g.CometChatException)return void n(t);var s=C.validateId(r);if(s instanceof g.CometChatException)return void n(s);_.makeApiCall("kickGroupMembers",{guid:o,uid:r}).then(function(t){e(!0)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.updateGroupMemberScope=function(r,i,a){return new Promise(function(e,n){try{var t=C.validateId(r);if(t instanceof g.CometChatException)return void n(t);var s=C.validateId(i);if(s instanceof g.CometChatException)return void n(s);var o=C.validateScope(a);if(o instanceof g.CometChatException)return void n(o);_.makeApiCall("changeScopeOfMember",{guid:r,uid:i},{scope:a}).then(function(t){e(!0)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.banGroupMember=function(o,r){return new Promise(function(e,n){try{var t=C.validateId(o);if(t instanceof g.CometChatException)return void n(t);var s=C.validateId(r);if(s instanceof g.CometChatException)return void n(s);_.makeApiCall("banGroupMember",{guid:o,uid:r}).then(function(t){e(!0)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.unbanGroupMember=function(o,r){return new Promise(function(e,n){try{var t=C.validateId(o);if(t instanceof g.CometChatException)return void n(t);var s=C.validateId(r);if(s instanceof g.CometChatException)return void n(s);_.makeApiCall("unbanGroupMember",{guid:o,uid:r}).then(function(t){e(!0)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.addMembersToGroup=function(i,a,c){var u=[],l=[],E=[],h=[];return new Promise(function(t,e){try{var n=C.validateId(i);if(n instanceof g.CometChatException)return void e(n);var s=C.validateArray(a);if(s instanceof g.CometChatException)return void e(s);var o=C.validateArray(c);if(o instanceof g.CometChatException)return void e(o);C.isFalsy(a)&&C.isFalsy(c)?e(new g.CometChatException({})):C.isFalsy(a)||C.isFalsy(c)?C.isFalsy(a)?c.map(function(t){h.push(t)}):(a.filter(function(t){if(t.getScope()==A.GROUP_MEMBER_SCOPE.ADMIN)return!0}).map(function(t){u.push(t.getUid())}),a.filter(function(t){if(t.getScope()==A.GROUP_MEMBER_SCOPE.MODERATOR)return!0}).map(function(t){l.push(t.getUid())}),a.filter(function(t){if(t.getScope()==A.GROUP_MEMBER_SCOPE.PARTICIPANT)return!0}).map(function(t){E.push(t.getUid())})):(a.filter(function(t){if(t.getScope()==A.GROUP_MEMBER_SCOPE.ADMIN)return!0}).map(function(t){u.push(t.getUid())}),a.filter(function(t){if(t.getScope()==A.GROUP_MEMBER_SCOPE.MODERATOR)return!0}).map(function(t){l.push(t.getUid())}),a.filter(function(t){if(t.getScope()==A.GROUP_MEMBER_SCOPE.PARTICIPANT)return!0}).map(function(t){E.push(t.getUid())}),c.map(function(t){h.push(t)}));var r={};C.isFalsy(u)||(r=p({},r,{admins:u})),C.isFalsy(E)||(r=p({},r,{participants:E})),C.isFalsy(l)||(r=p({},r,{moderators:l})),C.isFalsy(h)||(r=p({},r,{usersToBan:h})),_.makeApiCall("addMemebersToGroup",{guid:i},r).then(function(e){var n={};Object.keys(e.data.admins).map(function(t){e.data.admins[t][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS]?n[t]=A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS:n[t]=e.data.admins[t][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.ERROR][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.MESSAGE]}),Object.keys(e.data.participants).map(function(t){e.data.participants[t][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS]?n[t]=A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS:n[t]=e.data.participants[t][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.ERROR][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.MESSAGE]}),Object.keys(e.data.moderators).map(function(t){e.data.moderators[t][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS]?n[t]=A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS:n[t]=e.data.moderators[t][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.ERROR][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.MESSAGE]}),Object.keys(e.data.usersToBan).map(function(t){e.data.usersToBan[t][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS]?n[t]=A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.SUCCESS:n[t]=e.data.usersToBan[t][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.ERROR][A.ResponseConstants.RESPONSE_KEYS.GROUP_MEMBERS_RESPONSE.MESSAGE]}),t(n)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.initiateCall=function(e){var t=this;return new Promise(function(n,s){if(null===t.getActiveCall())try{C.isFalsy(JSON.parse(JSON.stringify(e)).sender)?C.isFalsy(t.getActiveCall())?(e.setStatus(A.CallConstants.CALL_STATUS.INITIATED),e.receiver=e.receiverId.toString(),delete e.receiverId,_.makeApiCall("createCallSession",{},e).then(function(t){var e=T.MessageController.trasformJSONMessge(t[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);R.CallController.getInstance().initiateCall(e).then(function(t){n(e)}).catch(function(t){s(new g.CometChatException(t))})},function(t){s(new g.CometChatException(t.error))})):s(new g.CometChatException(A.CALL_ERROR.ERROR_IN_CALLING)):R.CallController.getInstance().initiateCall(e).then(function(t){n(Object.assign(e))}).catch(function(t){s(new g.CometChatException(t))})}catch(t){s(new g.CometChatException(t))}else s(new g.CometChatException(A.CALL_ERROR.CALL_ALREADY_INITIATED))})},d.acceptCall=function(s){var o=this;return new Promise(function(n,e){if(null===o.getActiveCall())try{var t={};t[A.CallConstants.CALL_KEYS.CALL_STATUS]=A.CallConstants.CALL_STATUS.ONGOING,_.makeApiCall("updateCallSession",{sessionid:s},t).then(function(t){var e=T.MessageController.trasformJSONMessge(t[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);R.CallController.getInstance().onCallStarted(e),n(e)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}else e(new g.CometChatException(A.CALL_ERROR.CANNOT_ACCEPT_CALL))})},d.rejectCall=function(t,e){var n=this.getActiveCall();if(null!==n&&n.getSessionId()===t)try{switch(e){case A.CallConstants.CALL_STATUS.REJECTED:return this.rejectIncomingCall(t);case A.CallConstants.CALL_STATUS.CANCELLED:return this.cancelCall(t);case A.CallConstants.CALL_STATUS.BUSY:return this.sendBusyResponse(t);default:return this.endCall(t)}}catch(t){C.Logger.error("CometChat: rejectCall",t)}},d.endCall=function(o){var r=this;return new Promise(function(n,e){var s=r.getActiveCall();if(null!==s&&s.getSessionId()===o)try{var t={};t[A.CallConstants.CALL_KEYS.CALL_STATUS]=A.CallConstants.CALL_STATUS.ENDED,s.getJoinedAt()&&(t[A.CallConstants.CALL_KEYS.CALL_JOINED_AT]=s.getJoinedAt()),_.makeApiCall("updateCallSession",{sessionid:o},t).then(function(t){var e=T.MessageController.trasformJSONMessge(t[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);n(e),R.CallController.getInstance().getCallListner()&&R.CallController.getInstance().getCallListner()._eventListener.onCallEnded(e),R.CallController.getInstance().endCall()},function(t){C.Logger.log("calling Log",{error:t}),s.setStatus(A.CallConstants.CALL_STATUS.ENDED),n(s),R.CallController.getInstance().getCallListner()&&R.CallController.getInstance().getCallListner()._eventListener.onCallEnded(s),R.CallController.getInstance().endCall()})}catch(t){e(new g.CometChatException(t))}})},d.getActiveCall=function(){try{return R.CallController.getInstance().getActiveCall()}catch(t){C.Logger.error("CometChat: getActiveCall",t)}},d.startCall=function(t,e,n,s){try{R.CallController.getInstance().startCall(e,n,s)}catch(t){C.Logger.error("CometChat: startCall",t)}},d.toggleAudio=function(){try{R.CallController.toggleAudio()}catch(t){C.Logger.error("CometChat: toggleAudio",t)}},d.toggleVideo=function(){try{R.CallController.toggleVideo()}catch(t){C.Logger.error("CometChat: toggleVideo",t)}},d.leaveCall=function(){try{R.CallController.leave()}catch(t){C.Logger.error("CometChat: leaveCall",t)}},d.createCallView=function(t){var e=this;try{return{prop1:this.makeCall,onMessage:function(t){R.CallController.getInstance().getCallListner()._eventListener.onCallEnded(e.getActiveCall()),d.endCall(e.getActiveCall().getSessionId()).then(function(t){C.Logger.info("CometChat: createCallView",t)}).catch(function(t){C.Logger.error("CometChat: createCallView",t)})}}}catch(t){C.Logger.error("CometChat: createCallView",t)}},d.makeCall=function(t,e){try{t.setState(function(t){return p({},t,{uri:e})})}catch(t){C.Logger.error("CometChat: makeCall",t)}},d.rejectIncomingCall=function(s){return new Promise(function(n,e){try{var t={};t[A.CallConstants.CALL_KEYS.CALL_STATUS]=A.CallConstants.CALL_STATUS.REJECTED,_.makeApiCall("updateCallSession",{sessionid:s},t).then(function(t){var e=T.MessageController.trasformJSONMessge(t[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);n(e)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.cancelCall=function(o){var r=this;return new Promise(function(n,e){var t=r.getActiveCall();if(null!==t&&t.getSessionId()===o&&t.getCallInitiator().getUid().toLocaleLowerCase()===d.user.getUid().toLocaleLowerCase())try{var s={};s[A.CallConstants.CALL_KEYS.CALL_STATUS]=A.CallConstants.CALL_STATUS.CANCELLED,_.makeApiCall("updateCallSession",{sessionid:o},s).then(function(t){var e=T.MessageController.trasformJSONMessge(t[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);R.CallController.getInstance().endCallSession(),n(e)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.sendBusyResponse=function(s){return new Promise(function(n,e){try{var t={};t[A.CallConstants.CALL_KEYS.CALL_STATUS]=A.CallConstants.CALL_STATUS.BUSY,_.makeApiCall("updateCallSession",{sessionid:s},t).then(function(t){var e=T.MessageController.trasformJSONMessge(t[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);n(e)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.sendUnansweredResponse=function(s){return new Promise(function(n,e){try{var t={};t[A.CallConstants.CALL_KEYS.CALL_STATUS]=A.CallConstants.CALL_STATUS.UNANSWERED,_.makeApiCall("updateCallSession",{sessionid:s},t).then(function(t){var e=T.MessageController.trasformJSONMessge(t[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);a.XMPPConnectionHelper.getInstance().trigerMessageHandler(Object.assign(e,t[A.ResponseConstants.RESPONSE_KEYS.KEY_DATA])),n(e)},function(t){e(new g.CometChatException(t.error))})}catch(t){e(new g.CometChatException(t))}})},d.addConnectionListener=function(t,e){try{j.addXMPPConnectionEventListener(t,e)}catch(t){C.Logger.error("CometChat: addConnectionListener",t)}},d.removeConnectionListener=function(t){try{j.removeXMPPConnectionEventListener(t)}catch(t){C.Logger.error("CometChat: removeConnectionListener",t)}},d.addMessageListener=function(t,e){try{j.addMessageEventListener(t,e)}catch(t){C.Logger.error("CometChat: addMessageListener",t)}},d.removeMessageListener=function(t){try{j.removeMessageEventListener(t)}catch(t){C.Logger.error("CometChat: removeMessageListener",t)}},d.addCallListener=function(t,e){try{j.addCallEventListener(t,e)}catch(t){C.Logger.error("CometChat: addCallListener",t)}},d.removeCallListener=function(t){try{j.removeCallEventListener(t)}catch(t){C.Logger.error("CometChat: removeCallListener",t)}},d.addUserListener=function(t,e){try{j.addUserEventListener(t,e)}catch(t){C.Logger.error("CometChat: addUserListener",t)}},d.removeUserListener=function(t){try{j.removeUserEventListener(t)}catch(t){C.Logger.error("CometChat: removeUserListener",t)}},d.addGroupListener=function(t,e){try{j.addGroupEventListener(t,e)}catch(t){C.Logger.error("CometChat: addGroupListener",t)}},d.removeGroupListener=function(t){try{j.removeGroupEventListener(t)}catch(t){C.Logger.error("CometChat: removeGroupListener",t)}},d.generateAuthToken=function(E){var h=this;return new Promise(function(s,o){try{var r={},i="",a="",c=A.APPINFO.platform,u=A.APPINFO.sdkVersion,l=A.APPINFO.apiVersion;navigator&&(a=navigator.userAgent),d.keyStore.get("deviceId").then(function(t){if(null==(i=t)){var e=X(),n=(new Date).getTime();i=h.appId+"_"+e+"_"+n,d.keyStore.set("deviceId",i)}r={platform:c,userAgent:a,deviceId:i,appInfo:{version:u,apiVersion:l}},_.makeApiCall("authToken",{uid:E},r).then(function(t){s(t.data)}).catch(function(t){o(new g.CometChatException(t.error))})},function(t){C.Logger.error("Got error while fetching data from key store",t)})}catch(t){o(new g.CometChatException(t))}})},d.XMPPLogin=function(e,n,s){var o=this;try{var r=!1;this.timeOut+this.timeIncrements<3e4&&(this.timeOut=this.timeOut+this.timeIncrements,this.timeIncrements=this.timeIncrements+2e3);var i=!0;j.XMMPLogin(e.getUid(),e.getWsChannel().secret,!1,function(t){switch(t){case c.Strophe.Status.CONNFAIL:r=!0,i&&setTimeout(function(){o.fallback=!o.fallback,o.XMPPLogin(e,n,s)},o.timeOut);break;case c.Strophe.Status.CONNECTING:o.currentConnectionStatus==A.CONNECTION_STATUS.DISCONNECTED&&j.XMPPConnectionHandlers.map(function(t){try{t._XMPPeventListener&&(C.isFalsy(t._XMPPeventListener.inConnecting)||t._XMPPeventListener.inConnecting())}catch(t){C.Logger.error("XMPPConnectionHandlers: inConnecting Status",t)}}),o.currentConnectionStatus=A.CONNECTION_STATUS.CONNECTING;break;case c.Strophe.Status.CONNECTED:o.currentConnectionStatus==A.CONNECTION_STATUS.CONNECTING&&j.XMPPConnectionHandlers.map(function(t){try{t._XMPPeventListener&&(C.isFalsy(t._XMPPeventListener.onConnected)||t._XMPPeventListener.onConnected())}catch(t){C.Logger.error("XMPPConnectionHandlers: onConnected Status",t)}}),o.currentConnectionStatus=A.CONNECTION_STATUS.CONNECTED,o.timeOut=0,o.timeIncrements=1e3,r=!1,o.localStorage.set("user",e),n(new E.User(e));break;case c.Strophe.Status.DISCONNECTED:o.currentConnectionStatus==A.CONNECTION_STATUS.CONNECTED&&j.XMPPConnectionHandlers.map(function(t){try{t._XMPPeventListener&&(C.isFalsy(t._XMPPeventListener.onDisconnected)||t._XMPPeventListener.onDisconnected())}catch(t){C.Logger.error("XMPPConnectionHandlers: Disconnected Status",t)}}),o.currentConnectionStatus=A.CONNECTION_STATUS.DISCONNECTED,i&&!r&&setTimeout(function(){o.fallback=!o.fallback,o.XMPPLogin(e,n,s)},o.timeOut);break;case c.Strophe.Status.DISCONNECTING:i=!1;break;case c.Strophe.Status.AUTHFAIL:o.timeOut=0,o.timeIncrements=1e3,r=!1,s(new g.CometChatException(O.LOGIN_ERROR.XMPP_AUTH_FAIL))}})}catch(t){return void s(new g.CometChatException(t))}},d.getConnectionStatus=function(){return this.currentConnectionStatus},d.getAppSettings=function(){return new Promise(function(e,n){try{_.makeApiCall("appSettings").then(function(t){h.LocalStorage.getInstance().set("app_settings",t.data),e(t.data)},function(t){n(new g.CometChatException(t.error))})}catch(t){n(new g.CometChatException(t))}})},d.logout=function(){var s=this;return new Promise(function(e,n){try{_.makeApiCall("userLogout").then(function(t){s.clearCache().then(function(){d.apiKey=void 0,d.user=void 0,d.authToken=void 0,d.cometChat=void 0,a.XMPPConnectionHelper.getInstance().XMPPDisconnect(),e(t.data)})},function(t){s.clearCache().then(function(){d.apiKey=void 0,d.user=void 0,d.authToken=void 0,d.cometChat=void 0,a.XMPPConnectionHelper.getInstance().XMPPDisconnect(),new g.CometChatException(t.error).code==O.SERVER_ERRORS.AUTH_ERR.code?e({}):n(new g.CometChatException(t.error))})})}catch(t){n(new g.CometChatException(t))}})},d.isExtensionEnabled=function(s){return new Promise(function(e,n){try{K.ExtensionController.getExtensionList().then(function(t){Object.keys(t).map(function(t){t==s&&e(!0)}),e(!1)},function(t){C.Logger.log("error while fetching exntension list",t),e(!1)})}catch(t){n(new g.CometChatException(t))}})},d.clearCache=function(){return new Promise(function(t,e){try{h.LocalStorage.getInstance().clearStore().then(function(){s.UserStore.getInstance().clearStore().then(function(){n.MessagesStore.getInstance().clearStore().then(function(){C.Logger.info("CometChat: clearCache => All store cleared successfully","true"),t(!0)})})})}catch(t){C.Logger.error("CometChat: clearCache",t),e(t)}})},d.typingTimer=function(){try{setInterval(function(){b.TypingNotificationController.clearTimer()},500)}catch(t){C.Logger.error("CometChat: typingTimer",t)}},d.initialzed=!1,d.CallingComponent=q.CallingComponent,d.isNative=!1,d.CometChatException=g.CometChatException,d.TextMessage=f.TextMessage,d.MediaMessage=S.MediaMessage,d.CustomMessage=G.CustomMessage,d.Action=y.Action,d.Call=r.Call,d.TypingIndicator=Y.TypingIndicator,d.Group=I.Group,d.AppUser=E.User,d.User=E.User,d.GroupMember=x.GroupMember,d.Conversation=V.Conversation,d.USER_STATUS={ONLINE:A.PresenceConstatnts.STATUS.ONLINE,OFFLINE:A.PresenceConstatnts.STATUS.OFFLINE},d.MessagesRequest=D.DefaultMessagesRequest,d.MessagesRequestBuilder=D.DefaultMessagesRequestBuilder,d.UsersRequest=v.UsersRequest,d.UsersRequestBuilder=v.UsersRequestBuilder,d.ConversationsRequest=L.ConversationsRequest,d.ConversationsRequestBuilder=L.ConversationsRequestBuilder,d.CallSettings=U.CallSettings,d.CallSettingsBuilder=U.CallSettingsBuilder,d.BlockedUsersRequest=H.BlockedUsersRequest,d.BlockedUsersRequestBuilder=H.BlockedUsersRequestBuilder,d.GroupsRequest=M.GroupsRequest,d.GroupsRequestBuilder=M.GroupsRequestBuilder,d.GroupMembersRequest=P.GroupMembersRequest,d.GroupMembersRequestBuilder=P.GroupMembersRequestBuilder,d.BannedMembersRequest=P.GroupMembersRequest,d.BannedMembersRequestBuilder=P.GroupOutCastMembersRequestBuilder,d.AppSettings=k.AppSettings,d.AppSettingsBuilder=k.AppSettingsBuilder,d.MessageListener=o.MessageEventListener,d.UserListener=o.UserEventListener,d.GroupListener=o.GroupEventListener,d.OngoingCallListener=o.UserCallEventListener,d.CallListener=o.CallEventListener,d.ConnectionListener=a.XMPPConnectionEventListener,d.MESSAGE_TYPE=A.MessageConstatnts.TYPE,d.CATEGORY_MESSAGE=A.MessageConstatnts.CATEGORY.MESSAGE,d.CATEGORY_ACTION=A.MessageConstatnts.CATEGORY.ACTION,d.CATEGORY_CALL=A.MessageConstatnts.CATEGORY.CALL,d.ACTION_TYPE=A.ActionConstatnts.ACTIONS,d.CALL_TYPE=A.CallConstants.CALL_TYPE,d.RECEIVER_TYPE=A.MessageConstatnts.RECEIVER_TYPE,d.CALL_STATUS=A.CallConstants.CALL_STATUS,d.CallController=R.CallController,d.GROUP_MEMBER_SCOPE=A.GROUP_MEMBER_SCOPE,d.GROUP_TYPE=A.GROUP_TYPE,d.MESSAGE_REQUEST=A.MessageConstatnts.PAGINATION.CURSOR_FILEDS,d.CometChatExtension=B.CometChatExtension,d.ExtensionManager=F.ExtensionManager,d.isCall=!1,d.endpointFactory=new t.EndpointFactory,d.startTypingCount=0,d.endTypingCount=0,d.CometChatHelper=J.CometChatHelper,d.fallback=!1,d.timeOut=0,d.timeIncrements=1e3,d.currentConnectionStatus=A.CONNECTION_STATUS.DISCONNECTED,d.CONNECTION_STATUS=A.CONNECTION_STATUS,d}();W.CometChat=d}).call(this,$(39))},function(t,e,n){"use strict";e.__esModule=!0;var c=n(40),u=n(3),i=n(1),l=n(2);function E(e,t,n,s,o){var r;return void 0===e&&(e=""),void 0===t&&(t="GET"),void 0===n&&(n={}),void 0===s&&(s={}),n=i.isFalsy(n)?void 0:("GET"==t&&(e+="?",Object.keys(n).map(function(t){e=e+t+"="+n[t]+"&"}),n=void 0),o&&(r=new FormData,Object.keys(n).map(function(t){"data"!=t?"metadata"!=t&&r.append(t,n[t]):r.append(t,JSON.stringify(n[t]))})),JSON.stringify(n)),fetch(e,{method:t,mode:"cors",cache:"no-cache",headers:s,redirect:"follow",referrer:"no-referrer",body:o?r:n})}e.makeApiCall=function(o,t,r,i){void 0===o&&(o=""),void 0===t&&(t={}),void 0===r&&(r={});var a=u.CometChat.getInstance();return new Promise(function(n,s){try{c.getEndPoint(o,t).then(function(t){var e={appId:u.CometChat.getAppId(),Accept:"application/json"};i||(e["Content-Type"]="application/json"),t.hasOwnProperty("isAdminApi")&&t.isAdminApi?a.getApiKey()?e.apiKey=a.getApiKey():s({error:{code:"API_KEY_NOT_SET",message:"An apiKey is needed to use the "+o+" api.",name:"API_KEY_NOT_SET"}}):a.getAuthToken()?e.authToken=a.getAuthToken():s({error:{code:"USER_NOT_LOGED_IN",message:"An authToken is need to use the "+o+" api.",name:"user not logged in"}}),E(t.endpoint,t.method,r,e,i).then(function(t){return t.json()}).then(function(t){t.hasOwnProperty("data")?(t.data.hasOwnProperty("authToken")&&u.CometChat.setAuthToken(t.data.authToken),n(t)):s(t)}).catch(function(t){return s})}).catch(function(t){return s})}catch(t){s(new l.CometChatException(t))}})},e.makeAdminApiCall=function(o,t,r,i){void 0===o&&(o=""),void 0===t&&(t={}),void 0===r&&(r={});var a=u.CometChat.getInstance();return new Promise(function(n,s){c.getEndPoint(o,t).then(function(t){var e={appId:u.CometChat.getAppId(),Accept:"application/json"};i||(e["Content-Type"]="application/json"),t.hasOwnProperty("isAdminApi")&&t.isAdminApi?a.getApiKey()?e.apiKey=a.getApiKey():s({error:"An apiKey is need to use the "+o+" api."}):a.getAuthToken()?e.authToken=a.getAuthToken():s({error:"An authToken is need to use the "+o+" api."}),E(t.endpoint,t.method,r,e,i).then(function(t){return t.json()}).then(function(t){t.hasOwnProperty("data")?(t.data.hasOwnProperty("authToken")&&u.CometChat.setAuthToken(t.data.authToken),n(t)):s(t)}).catch(function(t){return s})}).catch(function(t){return s})})},e.postData=E},function(t,e,n){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var r=n(2),i=n(15),a=n(0),c=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.hasBlockedMe=!1,this.blockedByMe=!1,1===t.length)typeof t[0]===a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING?this.uid=t[0]:(this.uid=t[0].uid,this.name=t[0].name,t[0].authToken&&(this.authToken=t[0].authToken),t[0].avatar&&(this.avatar=t[0].avatar),t[0].lastActiveAt&&(this.lastActiveAt=t[0].lastActiveAt),t[0].link&&(this.link=t[0].link),t[0].metadata&&(this.metadata=t[0].metadata),t[0].role&&(this.role=t[0].role),t[0].statusMessage&&(this.statusMessage=t[0].statusMessage));else{if(2!==t.length)throw new r.CometChatException(i.ERRORS.PARAMETER_MISSING);this.uid=t[0],this.name=t[1]}}return t.prototype.getUid=function(){return this.uid},t.prototype.setUid=function(t){this.uid=t},t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){t&&(this.name=t)},t.prototype.getAuthToken=function(){return this.authToken},t.prototype.setAuthToken=function(t){this.authToken=t},t.prototype.getAvatar=function(){return this.avatar},t.prototype.setAvatar=function(t){this.avatar=t},t.prototype.getLastActiveAt=function(){return this.lastActiveAt},t.prototype.setLastActiveAt=function(t){this.lastActiveAt=t},t.prototype.getLink=function(){return this.link},t.prototype.setLink=function(t){return this.link=t},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t},t.prototype.getRole=function(){return this.role},t.prototype.setRole=function(t){this.role=t},t.prototype.getStatus=function(){return this.status},t.prototype.setStatus=function(t){this.status=t},t.prototype.getStatusMessage=function(){return this.statusMessage},t.prototype.setStatusMessage=function(t){this.statusMessage=t},t.prototype.setBlockedByMe=function(t){this.blockedByMe=t},t.prototype.getBlockedByMe=function(){return this.blockedByMe},t.prototype.setHasBlockedMe=function(t){this.hasBlockedMe=t},t.prototype.getHasBlockedMe=function(){return this.hasBlockedMe},t}(),u=function(n){function t(t){var e=n.call(this,t)||this;return e.wsChannel=t.wsChannel,e}return o(t,n),t.prototype.getWsChannel=function(){return this.wsChannel},t}(e.User=c);e.Me=u},function(t,e,n){"use strict";e.__esModule=!0;var s=n(0),o=function(){function t(t,e,n,s,o,r,i){this.hasJoined=!1,this.guid=t,e&&(this.name=e),n&&(this.type=n),!s&&""!==s||"password"!=n||(this.password=s),(o||""===o)&&(this.icon=o),(r||""===r)&&(this.description=r),i&&(this.hasJoined=i)}return t.prototype.getGuid=function(){return this.guid},t.prototype.setGuid=function(t){this.guid=t},t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){t&&(this.name=t)},t.prototype.getType=function(){return this.type},t.prototype.setType=function(t){this.type=t},t.prototype.setPassword=function(t){this.password=t},t.prototype.getIcon=function(){return this.icon},t.prototype.setIcon=function(t){this.icon=t},t.prototype.getDescription=function(){return this.description},t.prototype.setDescription=function(t){this.description=t},t.prototype.getOwner=function(){return this.owner},t.prototype.setOwner=function(t){this.owner=t},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t},t.prototype.getCreatedAt=function(){return this.createdAt},t.prototype.setCreatedAt=function(t){this.createdAt=t},t.prototype.getUpdatedAt=function(){return this.updatedAt},t.prototype.setUpdatedAt=function(t){this.updatedAt=t},t.prototype.getHasJoined=function(){return this.hasJoined},t.prototype.setHasJoined=function(t){this.hasJoined=t},t.prototype.getWsChannel=function(){return this.wsChannel},t.prototype.setWsChannel=function(t){this.wsChannel=t},t.prototype.setScope=function(t){this.scope=t},t.prototype.getScope=function(){return this.scope},t.prototype.getJoinedAt=function(){return this.joinedAt},t.prototype.setJoinedAt=function(t){this.joinedAt=t},t.TYPE=s.GroupType,t.Type=t.TYPE,t}();e.Group=o},function(t,e,n){"use strict";e.__esModule=!0;var r=n(17),i=n(10),a=n(18),u=n(4),s=n(21),l=n(1),E=n(0),h=n(13),p=n(22),d=n(23),C=n(42),g=n(2),_=n(43),S=n(19),f=n(3),T=n(8),o=function(){function c(){}return c.trasformXMPPMessage=function(t){var e={};try{var n=JSON.parse(unescape(i.parseHTML(t.getElementsByTagName("body")[0])).trim().toString());e=this.trasformJSONMessge(n)}catch(t){l.Logger.error("MessageController: transformXMPPMessage",{e:t})}return e},c.checkIfCabon=function(t){try{return 0<t.getElementsByTagName("forwarded").length&&t.getElementsByTagName("forwarded")[0],0<t.getElementsByTagName("forwarded").length}catch(t){l.Logger.error("MessageController: checkIfCabon",{e:t})}},c.trasformJSONMessge=function(n){try{var t=void 0;switch(n[E.MessageConstatnts.KEYS.CATEGORY]){case E.MessageConstatnts.CATEGORY.ACTION:t=p.Action.actionFromJSON(n);break;case E.MessageConstatnts.CATEGORY.CALL:t=d.Call.callFromJSON(n);break;case E.MessageConstatnts.CATEGORY.MESSAGE:switch(n[E.MessageConstatnts.KEYS.TYPE]){case E.MessageConstatnts.TYPE.TEXT:t=new r.TextMessage(n[E.MessageConstatnts.KEYS.RECEIVER],n[E.MessageConstatnts.KEYS.DATA][E.MessageConstatnts.KEYS.TEXT],n[E.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;case E.MessageConstatnts.TYPE.CUSTOM:t=new S.CustomMessage(n[E.MessageConstatnts.KEYS.RECEIVER],n[E.MessageConstatnts.KEYS.DATA][E.MessageConstatnts.KEYS.CUSTOM_DATA],n[E.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;default:if(t=new a.MediaMessage(n[E.MessageConstatnts.KEYS.RECEIVER],n[E.MessageConstatnts.KEYS.DATA][E.MessageConstatnts.KEYS.URL],n[E.MessageConstatnts.KEYS.TYPE],n[E.MessageConstatnts.KEYS.RECEIVER_TYPE]),n.hasOwnProperty(E.MessageConstatnts.KEYS.DATA)){var e=n[E.MessageConstatnts.KEYS.DATA];if(e.hasOwnProperty(E.MessageConstatnts.KEYS.ATTATCHMENTS)){var s,o=e[E.MessageConstatnts.KEYS.ATTATCHMENTS];new Array;o.map(function(t){s=new _.Attachment(t)}),t.setAttachment(s)}e.hasOwnProperty(E.MessageConstatnts.KEYS.TEXT)&&t.setCaption(e[E.MessageConstatnts.KEYS.TEXT])}t.hasOwnProperty("file")&&delete t.file}break;case E.MessageConstatnts.CATEGORY.CUSTOM:t=new S.CustomMessage(n[E.MessageConstatnts.KEYS.RECEIVER],n[E.MessageConstatnts.KEYS.DATA][E.MessageConstatnts.KEYS.CUSTOM_DATA],n[E.MessageConstatnts.KEYS.RECEIVER_TYPE],n.type)}n[E.MessageConstatnts.KEYS.MY_RECEIPTS]&&(n[E.MessageConstatnts.KEYS.MY_RECEIPTS]=n[E.MessageConstatnts.KEYS.MY_RECEIPTS],Object.keys(n[E.MessageConstatnts.KEYS.MY_RECEIPTS]).map(function(t){var e=new C.MessageReceipt;t==E.DELIVERY_RECEIPTS.DELIVERED_AT&&(e.setReceiptType(e.RECEIPT_TYPE.DELIVERY_RECEIPT),e.setDeliveredAt(n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.DELIVERY_RECEIPTS.DELIVERED_AT]),l.isFalsy(n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.DELIVERY_RECEIPTS.RECIPIENT])?n[E.DELIVERY_RECEIPTS.DELIVERED_TO_ME_AT]=n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.DELIVERY_RECEIPTS.DELIVERED_AT]:e.setSender(n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.DELIVERY_RECEIPTS.RECIPIENT]),e.setReceiverType(n[E.MessageConstatnts.KEYS.RECEIVER_TYPE]),e.setReceiver(n[E.MessageConstatnts.KEYS.RECEIVER])),n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.READ_RECEIPTS.READ_AT]&&(e.setReceiptType(e.RECEIPT_TYPE.READ_RECEIPT),e.setReadAt(n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.READ_RECEIPTS.READ_AT]),l.isFalsy(n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.READ_RECEIPTS.RECIPIENT])?n[E.READ_RECEIPTS.READ_BY_ME_AT]=n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.READ_RECEIPTS.READ_AT]:e.setSender(n[E.MessageConstatnts.KEYS.MY_RECEIPTS][E.READ_RECEIPTS.RECIPIENT]),e.setReceiverType(n[E.MessageConstatnts.KEYS.RECEIVER_TYPE]),e.setReceiver(n[E.MessageConstatnts.KEYS.RECEIVER]))}));try{if(Object.assign(t,n),(n=t)instanceof r.TextMessage)n.setSender(n.getSender()),n.setReceiver(n.getReceiver()),n.getData()[E.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[E.MessageConstatnts.KEYS.METADATA]);else if(n instanceof a.MediaMessage)n.getData()[E.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[E.MessageConstatnts.KEYS.METADATA]),n.setSender(n.getSender()),n.setReceiver(n.getReceiver());else if(n instanceof p.Action)n.setSender(n.getSender()),n.setReceiver(n.getActionFor()),n.setActionBy(n.getActionBy()),n.setActionOn(n.getActionOn()),n.setActionFor(n.getActionFor()),n.setMessage(n.getMessage());else if(n instanceof d.Call){try{n.setSender(n.getSender())}catch(t){l.Logger.error("MessageController: trasformJSONMessge: setSender",t)}try{n.setCallInitiator(n.getCallInitiator())}catch(t){l.Logger.error("MessageController: trasformJSONMessge: setCallInitiator",t)}try{n.setReceiver(n.getCallReceiver()),n.setCallReceiver(n.getCallReceiver())}catch(t){l.Logger.error("MessageController: trasformJSONMessge: setCallreceiver",t)}}else n instanceof S.CustomMessage&&(n.getData()[E.MessageConstatnts.KEYS.METADATA]&&n.setMetadata(n.getData()[E.MessageConstatnts.KEYS.METADATA]),n.setSubType(n.getData()[E.MessageConstatnts.KEYS.CUSTOM_SUB_TYPE]),n.setSender(n.getSender()),n.setReceiver(n.getReceiver()))}catch(t){l.Logger.error("MessageController: trasformJSONMessge: Main",t),n=null}return n}catch(t){l.Logger.error("MessageController: trasformJSONMessge",t)}},c.getOfflineHistory=function(t,e){void 0===t&&(t=1e3),void 0===e&&(e=1);try{s.MessagesStore.getInstance();var n=[];u.makeApiCall("getMessages",{},this.createData(t,e)).then(function(t){return l.isFalsy(t.data)||t.data.map(function(t){h.XMPPConnectionHelper.getInstance().trigerMessageHandler(t),n.push(c.trasformJSONMessge(t))}),!0})}catch(t){l.Logger.error("MessageController: getOfflineHistory",t)}},c.getAllMessage=function(t,s,o,r){var i=this;void 0===t&&(t=100);var a=[];return new Promise(function(e,n){try{u.makeApiCall("getMessages",{},i.createAllMessageData(t,s,o,r)).then(function(t){l.isFalsy(t.data)||(t.data.map(function(t){a.push(c.trasformJSONMessge(t))}),e(a))},function(t){l.Logger.error("Error on fetching all message",t),e([])})}catch(t){n(new g.CometChatException(t))}})},c.createData=function(t,e){return void 0===e&&(e=0),{per_page:t,cursorValue:e,cursorField:E.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,cursorAffix:l.isFalsy(e)?E.MessageConstatnts.PAGINATION.AFFIX.PREPEND:E.MessageConstatnts.PAGINATION.AFFIX.APPEND}},c.createAllMessageData=function(t,e,n,s){return{per_page:t,cursorValue:e,cursorField:n,cursorAffix:s}},c.isDeliveryReceipt=function(t){try{return 0<t.getElementsByTagName(E.DELIVERY_RECEIPTS.RECEIVED).length}catch(t){l.Logger.error("MessageController: isDeliveryReceipts",t)}},c.isReadRceipt=function(t){try{return 0<t.getElementsByTagName(E.READ_RECEIPTS.READ).length}catch(t){l.Logger.error("MessageController: isDeliveryReceipts",t)}},c.processDeliveryReceipt=function(r){return new Promise(function(n,e){try{var s=r.getElementsByTagName(E.DELIVERY_RECEIPTS.RECEIVED)[0],o=r.getElementsByTagName(E.DELIVERY_RECEIPTS.DELIVERED_AT)[0];h.XMPPConnectionHelper.getInstance().getUsersVCard(i.getUidFromJid(r.getAttribute(E.MessageConstatnts.XMPP_KEYS.FROM)),function(t){var e=new C.MessageReceipt;e.setSender(t),s.getAttribute(E.DELIVERY_RECEIPTS.RECEIVER_TYPE)==E.MessageConstatnts.RECEIVER_TYPE.GROUP?(e.setReceiverType(E.MessageConstatnts.RECEIVER_TYPE.GROUP),e.setReceiver(s.getAttribute(E.DELIVERY_RECEIPTS.RECEIVER_ID))):(e.setReceiverType(E.MessageConstatnts.RECEIVER_TYPE.USER),e.setReceiver(i.getUidFromJid(r.getAttribute(E.MessageConstatnts.XMPP_KEYS.TO)))),e.setReceiptType(e.RECEIPT_TYPE.DELIVERY_RECEIPT),e.setMessageId(i.getmessageIdFromStanzaId(s.getAttribute(E.DELIVERY_RECEIPTS.ID))),e.setTimestamp(o.getAttribute(E.DELIVERY_RECEIPTS.TIME)),e.setDeliveredAt(o.getAttribute(E.DELIVERY_RECEIPTS.TIME)),n(e)})}catch(t){e(new g.CometChatException(t))}})},c.processReadReceipt=function(r){return new Promise(function(n,e){try{var s=r.getElementsByTagName(E.READ_RECEIPTS.READ)[0],o=r.getElementsByTagName(E.READ_RECEIPTS.READ_AT)[0];h.XMPPConnectionHelper.getInstance().getUsersVCard(i.getUidFromJid(r.getAttribute(E.MessageConstatnts.XMPP_KEYS.FROM)),function(t){var e=new C.MessageReceipt;e.setSender(t),s.getAttribute(E.READ_RECEIPTS.RECEIVER_TYPE)==E.MessageConstatnts.RECEIVER_TYPE.GROUP?(e.setReceiverType(E.MessageConstatnts.RECEIVER_TYPE.GROUP),e.setReceiver(s.getAttribute(E.READ_RECEIPTS.RECEIVER_ID))):(e.setReceiverType(E.MessageConstatnts.RECEIVER_TYPE.USER),e.setReceiver(i.getUidFromJid(r.getAttribute(E.MessageConstatnts.XMPP_KEYS.TO)))),e.setReceiptType(e.RECEIPT_TYPE.READ_RECEIPT),e.setMessageId(i.getmessageIdFromStanzaId(s.getAttribute(E.READ_RECEIPTS.ID))),e.setTimestamp(o.getAttribute(E.READ_RECEIPTS.TIME)),e.setReadAt(o.getAttribute(E.READ_RECEIPTS.TIME)),n(e)})}catch(t){e(new g.CometChatException(t))}})},c.getReceiptsFromJSON=function(o){return new Promise(function(t,e){try{var s=[];f.CometChat.getLoggedInUser().then(function(n){l.isFalsy(o.receipts)?t([]):(o.receipts.data.map(function(t){var e=new C.MessageReceipt;t[E.DELIVERY_RECEIPTS.DELIVERED_AT]&&(e.setReceiptType(e.RECEIPT_TYPE.DELIVERY_RECEIPT),e.setDeliveredAt(t[E.DELIVERY_RECEIPTS.DELIVERED_AT]),e.setTimestamp(t[E.DELIVERY_RECEIPTS.DELIVERED_AT]),l.isFalsy(t[E.DELIVERY_RECEIPTS.RECIPIENT])?e.setSender(n):e.setSender(T.UsersController.trasformJSONUser(t[E.DELIVERY_RECEIPTS.RECIPIENT])),e.setReceiverType(o[E.MessageConstatnts.KEYS.RECEIVER_TYPE]),e.setReceiver(o[E.MessageConstatnts.KEYS.RECEIVER])),t[E.READ_RECEIPTS.READ_AT]&&(e.setReceiptType(e.RECEIPT_TYPE.READ_RECEIPT),e.setReadAt(t[E.READ_RECEIPTS.READ_AT]),e.setTimestamp(t[t[E.READ_RECEIPTS.READ_AT]]),l.isFalsy(t[E.READ_RECEIPTS.RECIPIENT])?e.setSender(n):e.setSender(T.UsersController.trasformJSONUser(t[E.READ_RECEIPTS.RECIPIENT])),e.setReceiverType(o[E.MessageConstatnts.KEYS.RECEIVER_TYPE]),e.setReceiver(o[E.MessageConstatnts.KEYS.RECEIVER])),s.push(e)}),t(s))})}catch(t){e(new g.CometChatException(t))}})},c}();e.MessageController=o},function(t,e,n){"use strict";e.__esModule=!0;var s=n(5),o=n(1),r=function(){function t(){}return t.trasformJSONUser=function(t){var e;try{"offline"!=t.status&&(t.status="online"),e=new s.User(t),Object.assign(e,t),t=e}catch(t){o.Logger.error("UsersController:transformJSONUser",t)}return t},t}();e.UsersController=r},function(t,e,n){"use strict";e.__esModule=!0;var s=n(1),o=n(0),r=n(2),i=function(){function t(t){this.store=o.constants.DEFAULT_STORE,s.isFalsy(t)||(this.store=t);try{this.localStore=n(11).AsyncStorage}catch(t){s.Logger.error("store: constructor",{e:t})}}return t.getInstance=function(){return null==t.localStorage&&(t.localStorage=new t),t.localStorage},t.prototype.set=function(t,e){return this.localStore.setItem(t,JSON.stringify(e))},t.prototype.remove=function(t){this.localStore.removeItem(t)},t.prototype.get=function(t){var s=this;return new Promise(function(n,e){try{s.localStore.getItem(t).then(function(e){try{n(JSON.parse(e))}catch(t){n(e)}},function(t){e(t)})}catch(t){e(new r.CometChatException(t))}})},t.prototype.clearStore=function(){var o=this;return new Promise(function(n,e){try{var s=["user","app_settings"];o.localStore.getAllKeys().then(function(t){if(0<t.length)for(var e=0;e<t.length;e++)-1!==s.indexOf(t[e])&&o.localStore.removeItem(t[e]),e===t.length-1&&n(!0);else n(!0)},function(t){e(t)})}catch(t){e(t)}})},t.prototype.clear=function(t){},t.prototype.selectStore=function(t){this.store=t},t.localStorage=null,t}();e.LocalStorage=i},function(t,e,n){"use strict";e.__esModule=!0;var o=n(0),r=n(1),i=n(3),a=n(2);e.getUidFromJid=function(t){try{return t.substring(t.lastIndexOf("]")+1,t.lastIndexOf("@"))}catch(t){r.Logger.error("XMPPUtils: getUidFromJid",t)}},e.getappIdFromJid=function(t){try{return t.substring(t.lastIndexOf("[")+1,t.lastIndexOf("]"))}catch(t){r.Logger.error("XMPPUtils: getappIdFromJid",t)}},e.getmessageIdFromStanzaId=function(e){try{return e?e.substring(e.lastIndexOf("]")+1,e.length):e}catch(t){return r.Logger.error("XMPPUtils: getmessageIdFromStanzaId",t),e}},e.parseHTML=function(e){try{return void 0!==e?e.textContent:e}catch(t){return r.Logger.error("XMPPUtils: parseHTML",t),e}},e.getJidFromUid=function(s){return new Promise(function(e,n){try{r.getAppSettings().then(function(t){e(r.format(o.XMPP.bare_jid_string,i.CometChat.getAppId(),s,t[o.APP_SETTINGS.KEYS.CHAT_HOST]))},function(t){e(r.format(o.XMPP.bare_jid_string,i.CometChat.getAppId(),s,o.XMPP.host))})}catch(t){n(new a.CometChatException(t))}})},e.getGUIDFromJID=function(t){try{return t.substring(t.indexOf("]")+1,t.indexOf("@"))}catch(t){r.Logger.error("XMPPUtils: getGUIDFromJID",t)}},e.getGroupJidFromGUID=function(s){return new Promise(function(e,n){try{r.getAppSettings().then(function(t){e(r.format(o.XMPP.muc_jid_string,i.CometChat.getAppId(),s,t[o.APP_SETTINGS.KEYS.GROUP_SERVICE],t[o.APP_SETTINGS.KEYS.CHAT_HOST]))},function(t){e(r.format(o.XMPP.muc_jid_string,i.CometChat.getAppId(),s,i.CometChat.getAppId(),o.XMPP.host))})}catch(t){n(new a.CometChatException(t))}})},e.getFullJidForGroup=function(t){try{return t.substring(t.indexOf("/")+1)}catch(t){r.Logger.error("XMPPUtils: getFullJidForGroup",t)}},e.getGroupJidFullGroupJid=function(t){try{return t.substring(0,t.indexOf("/"))}catch(t){r.Logger.error("XMPPUtils: getGroupJidFullGroupJid",t)}}},function(t,e){if(void 0===s){var n=new Error("Cannot find module 'react-native'");throw n.code="MODULE_NOT_FOUND",n}t.exports=s},function(t,e,n){"use strict";e.__esModule=!0;var s=function(){function t(t,e,n,s){this.receiverId=t,this.type=e,this.receiverType=n,this.category=s}return t.prototype.getId=function(){return this.id},t.prototype.setId=function(t){this.id=t},t.prototype.getConversationId=function(){return this.conversationId},t.prototype.setConversationId=function(t){this.conversationId=t},t.prototype.getMuid=function(){return this.muid},t.prototype.setMuid=function(t){this.muid=t},t.prototype.getSender=function(){return this.sender},t.prototype.setSender=function(t){this.sender=t},t.prototype.getReceiver=function(){return this.receiver},t.prototype.setReceiver=function(t){this.receiver=t},t.prototype.getReceiverId=function(){return this.receiverId},t.prototype.setReceiverId=function(t){this.receiverId=t},t.prototype.getType=function(){return this.type},t.prototype.setType=function(t){this.type=t},t.prototype.get=function(){return this.id},t.prototype.setReceiverType=function(t){this.receiverType=t},t.prototype.getReceiverType=function(){return this.receiverType},t.prototype.setSentAt=function(t){this.sentAt=t},t.prototype.getSentAt=function(){return this.sentAt},t.prototype.getStatus=function(){return this.status},t.prototype.setStatus=function(t){this.status=t},t.prototype.getDeliveredAt=function(){return this.deliveredAt},t.prototype.setDeliveredAt=function(t){this.deliveredAt=t},t.prototype.getDeliveredToMeAt=function(){return this.deliveredToMeAt},t.prototype.setDeliveredToMeAt=function(t){this.deliveredToMeAt=t},t.prototype.getReadAt=function(){return this.readAt},t.prototype.setReadAt=function(t){this.readAt=t},t.prototype.getReadByMeAt=function(){return this.readByMeAt},t.prototype.setReadByMeAt=function(t){this.readByMeAt=t},t.prototype.getCategory=function(){return this.category},t.prototype.setCategory=function(t){this.category=t},t.prototype.setEditedAt=function(t){this.editedAt=t},t.prototype.getEditedAt=function(){return this.editedAt},t.prototype.setEditedBy=function(t){this.editedBy=t},t.prototype.getEditedBy=function(){return this.editedBy},t.prototype.setDeletedAt=function(t){this.deletedAt=t},t.prototype.getDeletedAt=function(){return this.deletedAt},t.prototype.setDeletedBy=function(t){this.deletedBy=t},t.prototype.getDeletedBy=function(){return this.deletedBy},t}();e.BaseMessage=s},function(t,e,n){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__awaiter||function(r,i,a,c){return new(a||(a=Promise))(function(t,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,s)}o((c=c.apply(r,i||[])).next())})},u=this&&this.__generator||function(n,s){var o,r,i,t,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(i=2&e[0]?r.return:e[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,e[1])).done)return i;switch(r=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){a.label=e[1];break}if(6===e[0]&&a.label<i[1]){a.label=i[1],i=e;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(e);break}i[2]&&a.ops.pop(),a.trys.pop();continue}e=s.call(n,a)}catch(t){e=[6,t],r=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};e.__esModule=!0;var l=n(1),C=n(41),E=n(3),r=n(20),h=n(7),p=n(0),d=n(27),g=(n(45),n(46),n(47),n(22)),_=n(10),a=n(48),S=n(23),f=n(24),T=n(9),m=n(28),A=n(29),I=n(25),N=n(8),R=n(31),O=n(2);C.Strophe.addConnectionPlugin("pubsub",{_connection:null,init:function(t){this._connection=t,C.Strophe.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),C.Strophe.addNamespace("PUBSUB_SUBSCRIBE_OPTIONS",C.Strophe.NS.PUBSUB+"#subscribe_options"),C.Strophe.addNamespace("PUBSUB_ERRORS",C.Strophe.NS.PUBSUB+"#errors"),C.Strophe.addNamespace("PUBSUB_EVENT",C.Strophe.NS.PUBSUB+"#event"),C.Strophe.addNamespace("PUBSUB_OWNER",C.Strophe.NS.PUBSUB+"#owner"),C.Strophe.addNamespace("PUBSUB_AUTO_CREATE",C.Strophe.NS.PUBSUB+"#auto-create"),C.Strophe.addNamespace("PUBSUB_PUBLISH_OPTIONS",C.Strophe.NS.PUBSUB+"#publish-options"),C.Strophe.addNamespace("PUBSUB_NODE_CONFIG",C.Strophe.NS.PUBSUB+"#node_config"),C.Strophe.addNamespace("PUBSUB_CREATE_AND_CONFIGURE",C.Strophe.NS.PUBSUB+"#create-and-configure"),C.Strophe.addNamespace("PUBSUB_SUBSCRIBE_AUTHORIZATION",C.Strophe.NS.PUBSUB+"#subscribe_authorization"),C.Strophe.addNamespace("PUBSUB_GET_PENDING",C.Strophe.NS.PUBSUB+"#get-pending"),C.Strophe.addNamespace("PUBSUB_MANAGE_SUBSCRIPTIONS",C.Strophe.NS.PUBSUB+"#manage-subscriptions"),C.Strophe.addNamespace("PUBSUB_META_DATA",C.Strophe.NS.PUBSUB+"#meta-data")},createNode:function(t,e,n,s,o){var r=this._connection.getUniqueId("pubsubcreatenode"),i=C.$iq({from:t,to:e,type:"set",id:r}),a=C.Strophe.xmlElement("configure",[]),c=C.Strophe.xmlElement("x",[["xmlns","jabber:x:data"]]),u=C.Strophe.xmlElement("field",[["var","FORM_TYPE"],["type","hidden"]]),l=C.Strophe.xmlElement("value",[]),E=C.Strophe.xmlTextNode(C.Strophe.NS.PUBSUB+"#node_config");for(var h in l.appendChild(E),u.appendChild(l),c.appendChild(u),s){var p=s[h];c.appendChild(p)}return s.length&&0!=s.length&&a.appendChild(c),i.c("pubsub",{xmlns:C.Strophe.NS.PUBSUB}).c("create",{node:n}).up().cnode(a),this._connection.addHandler(o,null,"iq",null,r,null),this._connection.send(i.tree()),r},subscribe:function(t,e,n,s,o,r){var i=this._connection.getUniqueId("subscribenode"),a=C.Strophe.xmlElement("options",[]),c=C.Strophe.xmlElement("x",[["xmlns","jabber:x:data"]]),u=C.Strophe.xmlElement("field",[["var","FORM_TYPE"],["type","hidden"]]),l=C.Strophe.xmlElement("value",[]),E=C.Strophe.xmlTextNode(C.Strophe.NS.PUBSUB_SUBSCRIBE_OPTIONS);l.appendChild(E),u.appendChild(l),c.appendChild(u);var h=C.$iq({from:t,to:e,type:"set",id:i});if(s&&s.length&&0!==s.length){for(var p=0;p<s.length;p++){var d=s[p];c.appendChild(d)}a.appendChild(c),h.c("pubsub",{xmlns:C.Strophe.NS.PUBSUB}).c("subscribe",{node:n,jid:t}).up().cnode(a)}else h.c("pubsub",{xmlns:C.Strophe.NS.PUBSUB}).c("subscribe",{node:n,jid:t});return this._connection.addHandler(r,null,"iq",null,i,null),this._connection.addHandler(o,null,"message",null,null,null),this._connection.send(h.tree()),i},unsubscribe:function(t,e,n,s){var o=this._connection.getUniqueId("unsubscribenode"),r=C.$iq({from:t,to:e,type:"set",id:o});return r.c("pubsub",{xmlns:C.Strophe.NS.PUBSUB}).c("unsubscribe",{node:n,jid:t}),this._connection.addHandler(s,null,"iq",null,o,null),this._connection.send(r.tree()),o},publish:function(t,e,n,s,o){var r=this._connection.getUniqueId("publishnode"),i=C.Strophe.xmlElement("publish",[["node",n],["jid",t]]);for(var a in s){var c=C.Strophe.xmlElement("item",[]),u=C.Strophe.xmlElement("entry",[]),l=C.Strophe.xmlTextNode(s[a]);u.appendChild(l),c.appendChild(u),i.appendChild(c)}var E=C.$iq({from:t,to:e,type:"set",id:r});return E.c("pubsub",{xmlns:C.Strophe.NS.PUBSUB}).cnode(i),this._connection.addHandler(o,null,"iq",null,r,null),this._connection.send(E.tree()),r},items:function(t,e,n,s,o){var r=C.$iq({from:t,to:e,type:"get"});return r.c("pubsub",{xmlns:C.Strophe.NS.PUBSUB}).c("items",{node:n}),this._connection.sendIQ(r.tree(),s,o)}});var c=function(){function c(){this.messageHandlers=[],this.XMPPConnectionHandlers=[],this.userHandlers=[],this.callHandlers=[],this.groupHandlers=[],this.joinedGroups=[],this.iqHandlers=[]}return c.getInstance=function(){try{return null!=this.xMPPConnectionHelper&&null!=this.xMPPConnectionHelper||(this.xMPPConnectionHelper=new c),this.xMPPConnectionHelper}catch(t){l.Logger.error("Error in getInstance",t)}},c.prototype.XMPPConnect=function(t,s){var o=this,r="wss://",i="/ws/";return t&&(r="https://",i="/http-bind/"),new Promise(function(e,n){try{l.isFalsy(s)&&(s=t?c.XMPP_BIND_URL_HTTPS:c.XMPP_BIND_URL_WS),T.LocalStorage.getInstance().get(p.APP_SETTINGS.APP_SETTINGS).then(function(t){l.isFalsy(t)?l.getAppSettings().then(function(t){c.XMPP_BIND_URL=r+t[p.APP_SETTINGS.KEYS.CHAT_HOST]+":"+t[p.APP_SETTINGS.KEYS.CHAT_HTTPS_BIND_PORT]+i,o.connection=new C.Strophe.Connection(c.XMPP_BIND_URL),e(!0)}):(c.XMPP_BIND_URL=r+t[p.APP_SETTINGS.KEYS.CHAT_HOST]+":"+t[p.APP_SETTINGS.KEYS.CHAT_HTTPS_BIND_PORT]+i,o.connection=new C.Strophe.Connection(c.XMPP_BIND_URL),e(!0))})}catch(t){n(new O.CometChatException(t))}})},c.prototype.XMPPDisconnect=function(){try{this.connection?(this.connection.flush(),this.connection.disconnect(),clearInterval(this.pingInterval)):l.Logger.info("XMPPPHelper","No connection object found")}catch(t){l.Logger.error("XMPPHelper: XMPPDisconnect",t)}},c.prototype.XMMPLogin=function(e,n,t,s){var o=this;void 0===n&&(n=p.XMPP.deafult_password);try{this.XMPPConnect(t).then(function(t){o.connection.connected?s(C.Strophe.Status.CONNECTED):(clearInterval(o.pingInterval),T.LocalStorage.getInstance().get(p.APP_SETTINGS.APP_SETTINGS).then(function(t){l.isFalsy(t)?l.getAppSettings().then(function(t){o.perfomAfterConnection(e,n,s,t[p.APP_SETTINGS.KEYS.CHAT_HOST])}):o.perfomAfterConnection(e,n,s,t[p.APP_SETTINGS.KEYS.CHAT_HOST])}))})}catch(t){l.Logger.error("XMPPHelper: XMPPLogin",t)}},c.prototype.getPresenceInfo=function(n,e){var s=this;try{var t="somename"+(new Date).getTime();this.addIqHandler(t,function(t){e(t)}),l.getAppSettings().then(function(t){var e=C.$iq({from:s.connection.jid,id:"CC^COMETCHAT-PRESENCE",type:"get",to:t[p.APP_SETTINGS.KEYS.CHAT_HOST]}).c("query",{xmlns:"jabber:iq:presencereq",action:"presence"}).t(JSON.stringify(n));s.connection.send(e)},function(t){l.Logger.error("XMPPHelper: getPresenceInfo",t);var e=C.$iq({from:s.connection.jid,id:"CC^COMETCHAT-PRESENCE",type:"get",to:p.XMPP.host}).c("query",{xmlns:"jabber:iq:presencereq",action:"presence"}).t(JSON.stringify(n));s.connection.send(e)})}catch(t){l.Logger.error("XMPPHelper: getPresenceInfo",t)}},c.prototype.sendTypingStarted=function(t,e,n){void 0===e&&(e=p.XMPP.CONVERSATION.TYPE.CHAT);try{if(t){switch(e){case p.XMPP.CONVERSATION.TYPE.CHAT:case p.XMPP.CONVERSATION.TYPE.GROUP_CHAT:}this.connection.chatstates.sendComposing(t,e,n)}}catch(t){l.Logger.error("XMPPHelper: sendTypingStarted",t)}},c.prototype.sendTypingPaused=function(t,e,n){void 0===e&&(e=p.XMPP.CONVERSATION.TYPE.CHAT);try{if(t){switch(e){case p.XMPP.CONVERSATION.TYPE.CHAT:case p.XMPP.CONVERSATION.TYPE.GROUP_CHAT:}this.connection.chatstates.sendPaused(t,e,n)}}catch(t){l.Logger.error("XMPPHelper: sendTypingPaused",t)}},c.prototype.addMessageEventListener=function(e,t){try{this.messageHandlers=this.messageHandlers.filter(function(t){return t._name!=e}),this.messageHandlers=this.messageHandlers.concat([new r.MessageListener(e,t)])}catch(t){l.Logger.error("XMPPHelper: addMessageEventListener",t)}},c.prototype.removeMessageEventListener=function(e){try{this.messageHandlers=this.messageHandlers.filter(function(t){return t._name!==e})}catch(t){l.Logger.error("XMPPHelper: removeMessageEventListener",t)}},c.prototype.addXMPPConnectionEventListener=function(e,t){try{this.XMPPConnectionHandlers=this.XMPPConnectionHandlers.filter(function(t){return t._name!=e}),this.XMPPConnectionHandlers=this.XMPPConnectionHandlers.concat([new P(e,t)])}catch(t){l.Logger.error("XMPPHelper: addXMPPConnectionEventListener",t)}},c.prototype.removeXMPPConnectionEventListener=function(e){try{this.XMPPConnectionHandlers=this.XMPPConnectionHandlers.filter(function(t){return t._name!==e})}catch(t){l.Logger.error("XMPPHelper: removeXMPPConnectionEventListener",t)}},c.prototype.addCallEventListener=function(e,t){try{this.callHandlers=this.callHandlers.filter(function(t){return t._name!=e}),this.callHandlers=this.callHandlers.concat([new r.CallListener(e,t)])}catch(t){l.Logger.error("XMPPHelper: addCallEventListener",t)}},c.prototype.removeCallEventListener=function(e){try{this.callHandlers=this.callHandlers.filter(function(t){return t._name!==e})}catch(t){l.Logger.error("XMPPHelper: removeCallEventListener",t)}},c.prototype.addUserEventListener=function(e,t){try{this.userHandlers=this.userHandlers.filter(function(t){return t._name!=e}),this.userHandlers=this.userHandlers.concat([new r.UserListener(e,t)])}catch(t){l.Logger.error("XMPPHelper: addUserEventListener",t)}},c.prototype.removeUserEventListener=function(e){try{this.userHandlers=this.userHandlers.filter(function(t){return t._name!==e})}catch(t){l.Logger.error("XMPPHelper: removeUserEventListener",t)}},c.prototype.addGroupEventListener=function(e,t){try{this.groupHandlers=this.groupHandlers.filter(function(t){return t._name!=e}),this.groupHandlers=this.groupHandlers.concat([new r.GroupListener(e,t)])}catch(t){l.Logger.error("XMPPHelper: addGroupEventListener",t)}},c.prototype.removeGroupEventListener=function(e){try{this.groupHandlers=this.groupHandlers.filter(function(t){return t._name!==e})}catch(t){l.Logger.error("XMPPHelper: removeGroupEventListener",t)}},c.prototype.addIqHandler=function(t,e){try{this.iqHandlers=this.iqHandlers.concat([new r.Listener(t,e)])}catch(t){l.Logger.error("XMPPHelper: addIqHandler",t)}},c.prototype.removeIqHandler=function(e){try{this.iqHandlers=this.iqHandlers.filter(function(t){return t._name!==e})}catch(t){l.Logger.error("XMPPHelper: removeIqHandler",t)}},c.prototype.joinMuc=function(e){var n=this;try{l.getAppSettings().then(function(t){n.connection.muc.join(l.format(p.XMPP.muc_jid_string,E.CometChat.getAppId(),e.getGuid(),E.CometChat.getAppId(),t[p.APP_SETTINGS.KEYS.CHAT_HOST]),n.connection.jid,null,null,null,null,0)})}catch(t){l.Logger.error("XMPPHelper: joinMuc",t)}},c.prototype.leaveMuc=function(e){var n=this;try{l.getAppSettings().then(function(t){n.connection.muc.leave(l.format(p.XMPP.muc_jid_string,E.CometChat.getAppId(),e,E.CometChat.getAppId(),t[p.APP_SETTINGS.KEYS.CHAT_HOST]),n.connection.jid)})}catch(t){l.Logger.error("XMPPHelper: leaveMuc",t)}},c.prototype.getUsersVCard=function(t,e){var n=this;try{_.getJidFromUid(t).then(function(t){n.connection.vcard.get(function(t){e(a.VCardController.transformVCard(t))},t)})}catch(t){l.Logger.error("XMPPHelper: getUsersVCard",t)}},c.prototype.trigerMessageHandler=function(n,t){if(l.isFalsy(t))n=h.MessageController.trasformJSONMessge(n),this.messageHandlers.map(function(t){try{if(t._eventListener)if(n instanceof g.Action);else if(n instanceof S.Call);else{var e=n;switch(e.getType()){case p.MessageConstatnts.TYPE.TEXT:l.isFalsy(t._eventListener.onTextMessageReceived)||t._eventListener.onTextMessageReceived(n);break;case p.MessageConstatnts.TYPE.CUSTOM:l.isFalsy(t._eventListener.onCustomMessageReceived)||t._eventListener.onCustomMessageReceived(n);break;default:e.getCategory()==p.MessageCategory.CUSTOM?l.isFalsy(t._eventListener.onCustomMessageReceived)||t._eventListener.onCustomMessageReceived(n):l.isFalsy(t._eventListener.onMediaMessageReceived)||t._eventListener.onMediaMessageReceived(n)}}}catch(t){l.Logger.error("XMPPHelper: trigerMessageHandler",t)}}),n instanceof S.Call&&this.publishCallEvents(n),n instanceof g.Action&&this.publishActionEvents(n);else if(n=h.MessageController.trasformJSONMessge(n),this.messageHandlers[t]._eventListener)try{if(this.messageHandlers[t]._eventListener)if(n instanceof g.Action);else if(n instanceof S.Call);else{var e=n;switch(e.getType()){case p.MessageConstatnts.TYPE.TEXT:l.isFalsy(this.messageHandlers[t]._eventListener.onTextMessageReceived)||this.messageHandlers[t]._eventListener.onTextMessageReceived(n);break;case p.MessageConstatnts.TYPE.CUSTOM:l.isFalsy(this.messageHandlers[t]._eventListener.onCustomMessageReceived)||this.messageHandlers[t]._eventListener.onCustomMessageReceived(n);break;default:e.getCategory()==p.MessageCategory.CUSTOM?l.isFalsy(this.messageHandlers[t]._eventListener.onCustomMessageReceived)||this.messageHandlers[t]._eventListener.onCustomMessageReceived(n):l.isFalsy(this.messageHandlers[t]._eventListener.onMediaMessageReceived)||this.messageHandlers[t]._eventListener.onMediaMessageReceived(n)}}}catch(t){l.Logger.error("XMPPHelper: trigerMessageHandler",t)}},c.prototype.publishActionEvents=function(n){var s=this;try{switch(n.getAction()){case p.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_JOINED:this.groupHandlers.map(function(t){l.isFalsy(t._eventListener.onUserJoined)||t._eventListener.onUserJoined(n,n.getActionBy(),n.getActionFor())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_INVITED:this.groupHandlers.map(function(t){l.isFalsy(t._eventListener.onUserJoined)||t._eventListener.onUserJoined(n,n.getActionBy(),n.getActionFor())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_LEFT:this.groupHandlers.map(function(t){l.isFalsy(t._eventListener.onUserLeft)||t._eventListener.onUserLeft(n,n.getActionBy(),n.getActionFor())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_BANNED:this.groupHandlers.map(function(t){l.isFalsy(t._eventListener.onUserBanned)||t._eventListener.onUserBanned(n,n.getActionOn(),n.getActionBy(),n.getActionFor())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_KICKED:this.groupHandlers.map(function(t){l.isFalsy(t._eventListener.onUserKicked)||t._eventListener.onUserKicked(n,n.getActionOn(),n.getActionBy(),n.getActionFor())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_UNBANNED:this.groupHandlers.map(function(t){l.isFalsy(t._eventListener.onUserUnbanned)||t._eventListener.onUserUnbanned(n,n.getActionOn(),n.getActionBy(),n.getActionFor())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_SCOPE_CHANGED:this.groupHandlers.map(function(t){l.isFalsy(t._eventListener.onMemberScopeChanged)||t._eventListener.onMemberScopeChanged(n,n.getActionOn(),n.getNewScope(),n.getOldScope(),n.getActionFor())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MESSAGE_EDITED:this.messageHandlers.map(function(t){l.isFalsy(t._eventListener.onMessageEdited)||t._eventListener.onMessageEdited(n.getActionOn())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MESSAGE_DELETED:this.messageHandlers.map(function(t){l.isFalsy(t._eventListener.onMessageDeleted)||t._eventListener.onMessageDeleted(n.getActionOn())});break;case p.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_ADDED:var t=n.getActionOn();_.getJidFromUid(t.getUid()).then(function(t){t==C.Strophe.getBareJidFromJid(s.connection.jid)&&(s.joinMuc(n.getActionFor()),s.markAsDelivered(n.getActionFor().guid,"group",n.getId()))}),this.groupHandlers.map(function(e){var t=n.getActionOn();_.getJidFromUid(t.getUid()).then(function(t){t==C.Strophe.getBareJidFromJid(s.connection.jid)&&s.joinMuc(n.getActionFor()),l.isFalsy(e._eventListener.onMemberAddedToGroup)||e._eventListener.onMemberAddedToGroup(n,n.getActionOn(),n.getActionBy(),n.getActionFor())})})}}catch(t){l.Logger.error("XMPPHelper: publishActionEvents",t)}},c.prototype.publishCallEvents=function(e){try{var n=f.CallController.getInstance().getActiveCall();switch(e.getStatus()){case p.CallConstants.CALL_STATUS.INITIATED:e.getReceiverType()==p.CallConstants.RECEIVER_TYPE_GROUP?this.callHandlers.map(function(t){e.getCallInitiator().getUid().toLocaleLowerCase()!=E.CometChat.user.getUid().toLocaleLowerCase()&&(l.isFalsy(t._eventListener.onIncomingCallReceived)||t._eventListener.onIncomingCallReceived(e))}):this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onIncomingCallReceived)||t._eventListener.onIncomingCallReceived(e)});break;case p.CallConstants.CALL_STATUS.ONGOING:e.getReceiverType()==p.CallConstants.RECEIVER_TYPE_GROUP?e.getCallInitiator().getUid().toLocaleLowerCase()==E.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onOutgoingCallAccepted)||t._eventListener.onOutgoingCallAccepted(e)}):this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onOutgoingCallAccepted)||t._eventListener.onOutgoingCallAccepted(e)});break;case p.CallConstants.CALL_STATUS.UNANSWERED:if(e.getCallInitiator().getUid().toLocaleLowerCase()==E.CometChat.user.getUid().toLocaleLowerCase())this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)});else{if(null!==n&&n.getSessionId()===e.getSessionId())try{f.CallController.getInstance().endCall()}catch(t){l.Logger.error("CallError",t)}this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onIncomingCallCancelled)||t._eventListener.onIncomingCallCancelled(e)})}break;case p.CallConstants.CALL_STATUS.REJECTED:if(e.getReceiverType()==p.CallConstants.RECEIVER_TYPE_GROUP)e.getCallInitiator().getUid().toLocaleLowerCase()==E.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)});else{if(null!==n&&n.getSessionId()===e.getSessionId())try{f.CallController.getInstance().endCall()}catch(t){l.Logger.error("CallError",t)}this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)})}break;case p.CallConstants.CALL_STATUS.BUSY:e.getReceiverType()==p.CallConstants.RECEIVER_TYPE_GROUP?e.getCallInitiator().getUid().toLocaleLowerCase()==E.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)}):this.callHandlers.map(function(t){if(null!==n&&n.getSessionId()===e.getSessionId())try{f.CallController.getInstance().endCall()}catch(t){l.Logger.error("CallError",t)}l.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)});break;case p.CallConstants.CALL_STATUS.CANCELLED:if(this.callHandlers.map(function(t){l.isFalsy(t._eventListener.onIncomingCallCancelled)||t._eventListener.onIncomingCallCancelled(e)}),null!==n&&n.getSessionId()===e.getSessionId())try{f.CallController.getInstance().endCall()}catch(t){l.Logger.error("CallError",t)}break;case p.CallConstants.CALL_STATUS.ENDED:if(null!==n&&n.getSessionId()===e.getSessionId())try{f.CallController.getInstance().getCallListner()&&f.CallController.getInstance().getCallListner()._eventListener.onCallEnded(e),f.CallController.getInstance().endCall()}catch(t){l.Logger.error("CallError",t)}}}catch(t){l.Logger.error("XMPPHelper: publishCallEvents",t)}},c.prototype.publishTypinStatusNotification=function(e,t){try{switch(t){case p.TYPING_NOTIFICATION.ACTIONS.STARTED:this.messageHandlers.map(function(t){t._eventListener.onTypingStarted&&t._eventListener.onTypingStarted(e)}),A.TypingNotificationController.addIncomingTypingStarted(e);break;case p.TYPING_NOTIFICATION.ACTIONS.ENDED:this.messageHandlers.map(function(t){t._eventListener.onTypingEnded&&t._eventListener.onTypingEnded(e)}),A.TypingNotificationController.removeIncomingTypingStarted(e)}}catch(t){l.Logger.error("XMPPHelper: publishTypingStatusNotification",t)}},c.prototype.publishDeliveryReceipt=function(t){var n=this;try{h.MessageController.processDeliveryReceipt(t).then(function(e){n.messageHandlers.map(function(t){t._eventListener.onMessagesDelivered&&t._eventListener.onMessagesDelivered(e)})},function(t){l.Logger.error("Error in publish delivery",t)})}catch(t){l.Logger.error("XMPPHelper: publishDeliveryReceipt",t)}},c.prototype.publishReadReceipt=function(t){var n=this;try{h.MessageController.processReadReceipt(t).then(function(e){n.messageHandlers.map(function(t){t._eventListener.onMessagesRead&&t._eventListener.onMessagesRead(e)})},function(t){l.Logger.error("Error in publish read",t)})}catch(t){l.Logger.error("XMPPHelper: publishReadReceipt",t)}},c.prototype.markAsRead=function(s,o,r){var i=this;try{o==p.MessageConstatnts.RECEIVER_TYPE.USER?_.getJidFromUid(s).then(function(t){var e=C.$msg({to:t,from:i.connection.jid,id:i.connection.getUniqueId(),type:p.MessageConstatnts.XMPP_KEYS.TYPE_USER}),n=C.Strophe.xmlElement("read",{type:o,receiverId:s,xmlns:"urn:xmpp:receipts",id:"["+E.CometChat.getAppId()+"]"+r});e.tree().appendChild(n),i.connection.send(e)}):_.getGroupJidFromGUID(s).then(function(t){var e=C.$msg({to:t,from:i.connection.jid,id:i.connection.getUniqueId(),type:p.MessageConstatnts.XMPP_KEYS.TYPE_GROUP}),n=C.Strophe.xmlElement("read",{type:o,receiverId:s,xmlns:C.Strophe.NS.RECEIPTS,id:"["+E.CometChat.getAppId()+"]"+r});e.tree().appendChild(n),i.connection.send(e)})}catch(t){l.Logger.error("XMPPHelper: markAsRead",t)}},c.prototype.markAsDelivered=function(s,o,r){var i=this;try{o==p.MessageConstatnts.RECEIVER_TYPE.USER?_.getJidFromUid(s).then(function(t){var e=C.$msg({to:t,from:i.connection.jid,id:i.connection.getUniqueId(),type:p.MessageConstatnts.XMPP_KEYS.TYPE_USER}),n=C.Strophe.xmlElement("delivered",{type:o,receiverId:s,xmlns:"urn:xmpp:receipts",id:"["+E.CometChat.getAppId()+"]"+r});e.tree().appendChild(n),i.connection.send(e)}):_.getGroupJidFromGUID(s).then(function(t){var e=C.$msg({to:t,from:i.connection.jid,id:i.connection.getUniqueId(),type:p.MessageConstatnts.XMPP_KEYS.TYPE_GROUP}),n=C.Strophe.xmlElement("delivered",{type:o,receiverId:s,xmlns:C.Strophe.NS.RECEIPTS,id:"["+E.CometChat.getAppId()+"]"+r});e.tree().appendChild(n),i.connection.send(e)})}catch(t){l.Logger.error("XMPPHelper: markAsDelivered",t)}},c.prototype.subscribeToTopic=function(e){var n=this;try{T.LocalStorage.getInstance().get(p.APP_SETTINGS.APP_SETTINGS).then(function(t){l.isFalsy(t)?l.getAppSettings().then(function(t){n.connection.pubsub.subscribe(n.connection.jid,p.XMPP.PUBSUB_CHANNEL+"."+t[p.APP_SETTINGS.KEYS.CHAT_HOST],e,{},function(){l.Logger.info("XMPPHelper: subscribeToTopic","onEvent")},function(){l.Logger.info("XMPPHelper: subscribeToTopic","onsubscribe")})}):n.connection.pubsub.subscribe(n.connection.jid,p.XMPP.PUBSUB_CHANNEL+"."+t[p.APP_SETTINGS.KEYS.CHAT_HOST],e,{},function(){l.Logger.info("XMPPHelper: subscribeToTopic","onEvent")},function(){l.Logger.info("XMPPHelper: subscribeToTopic","onsubscribe")})})}catch(t){l.Logger.error("XMPPHelper: subscribeToTopic",t)}},c.prototype.getRooms=function(){var s=this;return new Promise(function(n,e){try{void 0!==s.connection?T.LocalStorage.getInstance().get(p.APP_SETTINGS.APP_SETTINGS).then(function(t){l.isFalsy(t)?l.getAppSettings().then(function(t){s.connection.muc.listRooms(E.CometChat.getAppId()+"."+t[p.APP_SETTINGS.KEYS.CHAT_HOST],function(t){var e=t.getElementsByTagName("item");e=Array.prototype.slice.call(e),s.joinedGroups=[],e.map(function(t){s.joinedGroups.push(_.getUidFromJid(t.getAttribute("jid")))}),n(s.joinedGroups)})}):s.connection.muc.listRooms(E.CometChat.getAppId()+"."+t[p.APP_SETTINGS.KEYS.CHAT_HOST],function(t){var e=t.getElementsByTagName("item");e=Array.prototype.slice.call(e),s.joinedGroups=[],e.map(function(t){s.joinedGroups.push(_.getUidFromJid(t.getAttribute("jid")))}),n(s.joinedGroups)})},function(t){e(new O.CometChatException(t))}):s.addXMPPConnectionEventListener("XMPPConnectionListener",new y({onConnected:function(){s.getRooms().then(function(t){n(t),s.removeXMPPConnectionEventListener("XMPPConnectionListener")})}}))}catch(t){e(new O.CometChatException(t))}})},c.prototype.perfomAfterConnection=function(t,e,n,s){var a=this,o=E.CometChat.getInstance();this.connection.connect(l.format(p.XMPP.jid_string,E.CometChat.getAppId(),t,s,o.getAuthToken()),e,function(t){try{if(l.isFalsy(n)||n(t),t==C.Strophe.Status.CONNECTED){switch(a.connection.sendPresence(C.$pres().c("priority").t("1").up().c("status").t("online")),a.connection.muc.init(a.connection),a.connection.vcard.init(a.connection),a.connection.chatstates.init(a.connection),a.connection.receipts.init(a.connection),a.connection.pubsub.init(a.connection),a.pingInterval=setInterval(function(){a.connection.ping.ping(s,function(){return i(a,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return l.Logger.info("ping result","successful"),E.CometChat.currentConnectionStatus==p.CONNECTION_STATUS.CONNECTED?[3,2]:(clearInterval(this.pingInterval),[4,this.XMMPLogin(E.CometChat.user.getUid(),E.CometChat.user.getWsChannel().secret,!1)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},function(){l.Logger.info("ping result","unsuccessful"),E.CometChat.currentConnectionStatus==p.CONNECTION_STATUS.CONNECTED&&(E.CometChat.currentConnectionStatus=p.CONNECTION_STATUS.DISCONNECTED,a.XMPPConnectionHandlers.map(function(t){try{t._XMPPeventListener&&(l.isFalsy(t._XMPPeventListener.onDisconnected)||t._XMPPeventListener.onDisconnected())}catch(t){l.Logger.error("XMPPConnectionHandlers: Disconnected Status",t)}})),E.CometChat.currentConnectionStatus==p.CONNECTION_STATUS.DISCONNECTED&&(E.CometChat.currentConnectionStatus=p.CONNECTION_STATUS.CONNECTING,a.XMPPConnectionHandlers.map(function(t){try{t._XMPPeventListener&&(l.isFalsy(t._XMPPeventListener.inConnecting)||t._XMPPeventListener.inConnecting())}catch(t){l.Logger.error("XMPPConnectionHandlers: Disconnected Status",t)}}))},2e3)},25e3),T.LocalStorage.getInstance().get(p.APP_SETTINGS.APP_SETTINGS).then(function(t){l.isFalsy(t)?l.getAppSettings().then(function(t){a.connection.muc.listRooms(E.CometChat.getAppId()+"."+t[p.APP_SETTINGS.KEYS.CHAT_HOST],function(t){var e=t.getElementsByTagName("item");(e=Array.prototype.slice.call(e)).map(function(t){a.connection.muc.join(t.getAttribute("jid"),a.connection.jid)})})}):a.connection.muc.listRooms(E.CometChat.getAppId()+"."+t[p.APP_SETTINGS.KEYS.CHAT_HOST],function(t){var e=t.getElementsByTagName("item");(e=Array.prototype.slice.call(e)).map(function(t){a.connection.muc.join(t.getAttribute("jid"),a.connection.jid,null,null,null,null,0,null)})})}),E.CometChat.appSettings.getSubscriptionType()){case R.AppSettings.SUBSCRIPTION_TYPE_ALL_USERS:a.subscribeToTopic(l.format(p.XMPP.pubsub_global_string,E.CometChat.getAppId()));break;case R.AppSettings.SUBSCRIPTION_TYPE_FRIENDS:case R.AppSettings.SUBSCRIPTION_TYPE_NONE:break;case R.AppSettings.SUBSCRIPTION_TYPE_ROLES:E.CometChat.appSettings.getRoles().map(function(t){a.subscribeToTopic(l.format(p.XMPP.pubsub_role_string,E.CometChat.getAppId(),t))})}a.connection.send(C.$iq({from:C.Strophe.getBareJidFromJid(a.connection.jid),id:"enable1",type:"set"}).c("enable",{xmlns:"urn:xmpp:carbons:2"})),a.connection.addHandler(function(t){if(!(0<t.getElementsByTagName("x").length)){var n=d.PresenceController.transformPresence(t);a.getUsersVCard(n.getUid(),function(e){l.isFalsy(e.getUid())||E.CometChat.appSettings.getSubscriptionType()==R.AppSettings.SUBSCRIPTION_TYPE_FRIENDS&&a.userHandlers.map(function(t){if(t)switch(e.setLastActiveAt(n.getLastActiveAt()),n.getStatus()){case p.PresenceConstatnts.STATUS.ONLINE:e.setStatus(p.PresenceConstatnts.STATUS.ONLINE),l.isFalsy(t._eventListener.onUserOnline)||t._eventListener.onUserOnline(e);break;default:e.setStatus(p.PresenceConstatnts.STATUS.OFFLINE),l.isFalsy(t._eventListener.onUserOffline)||t._eventListener.onUserOffline(e)}})})}return!0},null,"presence"),a.connection.addHandler(function(t){0<t.getElementsByTagName("muc:join").length&&a.connection.muc.join(t.getAttribute(p.MessageConstatnts.XMPP_KEYS.FROM),a.connection.jid,null,null,null,null,0);var e=t.getElementsByTagName("presence");return 0<(e=Array.prototype.slice.call(e)).length&&a.iqHandlers.map(function(t){t._callback(d.PresenceController.transformPresences(e))}),!0},null,"iq"),T.LocalStorage.getInstance().get(p.APP_SETTINGS.APP_SETTINGS).then(function(t){l.isFalsy(t)?l.getAppSettings().then(function(t){a.connection.addHandler(function(t){var e=JSON.parse(unescape(_.parseHTML(t.getElementsByTagName("body")[0])).trim().toString()),n=N.UsersController.trasformJSONUser(e);return a.userHandlers.map(function(t){if(t)switch(n.getStatus()){case p.PresenceConstatnts.STATUS.OFFLINE:l.isFalsy(t._eventListener.onUserOffline)||t._eventListener.onUserOffline(n);break;default:l.isFalsy(t._eventListener.onUserOnline)||t._eventListener.onUserOnline(n)}}),!0},null,"message",null,null,p.XMPP.PUBSUB_CHANNEL+"."+t[p.APP_SETTINGS.KEYS.CHAT_HOST],null)}):a.connection.addHandler(function(t){var e=JSON.parse(unescape(_.parseHTML(t.getElementsByTagName("body")[0])).trim().toString()),n=N.UsersController.trasformJSONUser(e);return a.userHandlers.map(function(t){if(t)switch(n.getStatus()){case p.PresenceConstatnts.STATUS.OFFLINE:l.isFalsy(t._eventListener.onUserOffline)||t._eventListener.onUserOffline(n);break;default:l.isFalsy(t._eventListener.onUserOnline)||t._eventListener.onUserOnline(n)}}),!0},null,"message",null,null,p.XMPP.PUBSUB_CHANNEL+"."+t[p.APP_SETTINGS.KEYS.CHAT_HOST],null)}),a.connection.addHandler(function(r){var t;try{try{if(t=h.MessageController.trasformXMPPMessage(r),l.isFalsy(t))if(h.MessageController.isDeliveryReceipt(r))r.getAttribute(p.MessageConstatnts.XMPP_KEYS.TYPE)==p.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&_.getFullJidForGroup(r.getAttribute(p.MessageConstatnts.XMPP_KEYS.FROM))==c.getInstance().connection.jid||a.publishDeliveryReceipt(r);else{if(!h.MessageController.isReadRceipt(r))return!0;r.getAttribute(p.MessageConstatnts.XMPP_KEYS.TYPE)==p.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&_.getFullJidForGroup(r.getAttribute(p.MessageConstatnts.XMPP_KEYS.FROM))==c.getInstance().connection.jid||a.publishReadReceipt(r)}else r.getAttribute(p.MessageConstatnts.XMPP_KEYS.TYPE)==p.MessageConstatnts.XMPP_KEYS.TYPE_GROUP?_.getFullJidForGroup(r.getAttribute(p.MessageConstatnts.XMPP_KEYS.FROM))==c.getInstance().connection.jid||h.MessageController.checkIfCabon(r)||a.connection.receipts._processReceipt(r,t.getId()):h.MessageController.checkIfCabon(r)?a.trigerMessageHandler(r):a.connection.receipts._processReceipt(r,t.getId());h.MessageController.isReadRceipt(r)||h.MessageController.isDeliveryReceipt(r)?r=t:r.getAttribute(p.MessageConstatnts.XMPP_KEYS.TYPE)==p.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&_.getFullJidForGroup(r.getAttribute(p.MessageConstatnts.XMPP_KEYS.FROM))==c.getInstance().connection.jid||(r=t)}catch(t){return l.Logger.error("Error in processing incoming message",{e:t,message:r}),!0}l.isFalsy(r)||(a.messageHandlers.map(function(o){return i(a,void 0,void 0,function(){var e,n,s;return u(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),o?r instanceof g.Action?[3,4]:[3,1]:[3,4];case 1:return r instanceof S.Call?[3,4]:[3,2];case 2:return e=r,n=h.MessageController.trasformJSONMessge(e),[4,I.ExtensionController.hookOnMessageReceived(n)];case 3:switch((e=t.sent()).getType()){case p.MessageConstatnts.TYPE.TEXT:l.isFalsy(o._eventListener.onTextMessageReceived)||o._eventListener.onTextMessageReceived(e);break;case p.MessageConstatnts.TYPE.CUSTOM:l.isFalsy(o._eventListener.onCustomMessageReceived)||o._eventListener.onCustomMessageReceived(e);break;default:e.getCategory()==p.MessageCategory.CUSTOM?l.isFalsy(o._eventListener.onCustomMessageReceived)||o._eventListener.onCustomMessageReceived(r):l.isFalsy(o._eventListener.onMediaMessageReceived)||o._eventListener.onMediaMessageReceived(r)}t.label=4;case 4:return[3,6];case 5:return s=t.sent(),l.Logger.error("Error in processing incoming message",{e:s}),[3,6];case 6:return[2]}})})}),r instanceof S.Call&&a.publishCallEvents(r),r instanceof g.Action&&a.publishActionEvents(r))}catch(t){l.Logger.error("Error in message processing",{error:t})}return!0},null,"message"),a.connection.addHandler(function(t){try{if(0<t.getElementsByTagName("error").length)return!0;var e,n=t.getElementsByTagName("composing"),s=t.getElementsByTagName("paused"),o=t.getAttribute("from"),r=t.getAttribute("type");if(t.getElementsByTagName("body")[0]&&(e=unescape(_.parseHTML(t.getElementsByTagName("body")[0])).trim().toString()),0<n.length||0<s.length)switch(r){case p.XMPP.CONVERSATION.TYPE.CHAT:var i=new m.TypingIndicator(_.getUidFromJid(a.connection.jid),p.MessageConstatnts.RECEIVER_TYPE.USER);a.getUsersVCard(_.getUidFromJid(o),function(t){i.setSender(t),e&&i.setMetadata(e),0<n.length&&A.TypingNotificationController.addIncomingTypingStarted(i),0<s.length&&A.TypingNotificationController.removeIncomingTypingStarted(i),a.messageHandlers.map(function(t){0<n.length&&t._eventListener.onTypingStarted&&t._eventListener.onTypingStarted(i),0<s.length&&t._eventListener.onTypingEnded&&t._eventListener.onTypingEnded(i)})});break;case p.XMPP.CONVERSATION.TYPE.GROUP_CHAT:if(_.getFullJidForGroup(t.getAttribute(p.MessageConstatnts.XMPP_KEYS.FROM))==c.getInstance().connection.jid)return!0;i=new m.TypingIndicator(_.getGUIDFromJID(o),p.MessageConstatnts.RECEIVER_TYPE.GROUP),a.getUsersVCard(_.getUidFromJid(o),function(t){i.setSender(t),e&&i.setMetadata(e),0<n.length&&A.TypingNotificationController.addIncomingTypingStarted(i),0<s.length&&A.TypingNotificationController.removeIncomingTypingStarted(i),a.messageHandlers.map(function(t){0<n.length&&t._eventListener.onTypingStarted&&t._eventListener.onTypingStarted(i),0<s.length&&t._eventListener.onTypingEnded&&t._eventListener.onTypingEnded(i)})})}}catch(t){l.Logger.error("error in message processing",{error:t})}return!0},C.Strophe.NS.CHATSTATES,"message")}}catch(t){l.Logger.error("XMPPHelper: performAfterConnection",t)}})},c.XMPP_HOST=p.XMPP.host,c.XMPP_PORT=p.XMPP.port,c.xMPPConnectionHelper=new c,c.XMPP_BIND_URL="wss://"+c.XMPP_HOST+":"+c.XMPP_PORT+p.XMPP.ws_url,c.XMPP_BIND_URL_WS="wss://"+c.XMPP_HOST+":"+c.XMPP_PORT+p.XMPP.ws_url,c.XMPP_BIND_URL_HTTPS="https://"+c.XMPP_HOST+":"+c.XMPP_PORT+p.XMPP.bind_url,c}();e.XMPPConnectionHelper=c;var y=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onConnected=void 0,this.inConnecting=void 0,this.onDisconnected=void 0,l.isFalsy(t[0].onConnected)||(this.onConnected=t[0].onConnected),l.isFalsy(t[0].inConnecting)||(this.inConnecting=t[0].inConnecting),l.isFalsy(t[0].onDisconnected)||(this.onDisconnected=t[0].onDisconnected)};e.XMPPConnectionEventListener=y;var M=function(t,e){this._name=t,this._callback=e},P=function(r){function t(t,e,n,s){var o=r.call(this,t,s)||this;return o._XMPPeventListener=e,n&&(o._cursor=n),o}return o(t,r),t}(e.XMPPListener=M);e.XMPPConnectionListener=P},function(t,e,n){var s;window,s=function(){return function(n){var s={};function o(t){if(s[t])return s[t].exports;var e=s[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}return o.m=n,o.c=s,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s="./src/strophe.js")}({"./src/bosh.js":function(t,e,n){"use strict";n.r(e);var s=n("./src/core.js"),E=s.default.Strophe,o=s.default.$build;E.Request=function(t,e,n,s){this.id=++E._requestId,this.xmlData=t,this.data=E.serialize(t),this.origFunc=e,this.func=e,this.rid=n,this.date=NaN,this.sends=s||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},E.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(t=this.xhr.responseXML.documentElement).tagName)throw E.error("invalid response received"),E.error("responseText: "+this.xhr.responseText),E.error("responseXML: "+E.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText&&(E.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(t=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement)))throw new Error("Parsing produced null node");return t},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=this.func.bind(null,this),t}},E.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},E.Bosh.prototype={strip:null,_buildBody:function(){var t=o("body",{rid:this.rid++,xmlns:E.NS.HTTPBIND});return null!==this.sid&&t.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),t},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(t,e,n){this.wait=t||this.wait,this.hold=e||this.hold,this.errors=0;var s=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":E.NS.BOSH});n&&s.attrs({route:n});var o=this._conn._connect_cb;this._requests.push(new E.Request(s.tree(),this._onRequestStateChange.bind(this,o.bind(this._conn)),s.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(t,e,n,s,o,r,i){this._conn.jid=t,this.sid=e,this.rid=n,this._conn.connect_callback=s,this._conn.domain=E.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=r||this.hold,this.window=i||this.window,this._conn._changeConnectStatus(E.Status.ATTACHED,null)},_restore:function(t,e,n,s,o){var r=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=r&&r.rid&&r.sid&&r.jid&&(null==t||E.getBareJidFromJid(r.jid)===E.getBareJidFromJid(t)||null===E.getNodeFromJid(t)&&E.getDomainFromJid(r.jid)===t))){var i=new Error("_restore: no restoreable session.");throw i.name="StropheSessionError",i}this._conn.restored=!0,this._attach(r.jid,r.sid,r.rid,e,n,s,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(t){var e=t.getAttribute("type");if(null!==e&&"terminate"===e){var n=t.getAttribute("condition");E.error("BOSH-Connection failed: "+n);var s=t.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&0<s.length&&(n="conflict"),this._conn._changeConnectStatus(E.Status.CONNFAIL,n)):this._conn._changeConnectStatus(E.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),E.Status.CONNFAIL}this.sid||(this.sid=t.getAttribute("sid"));var o=t.getAttribute("requests");o&&(this.window=parseInt(o,10));var r=t.getAttribute("hold");r&&(this.hold=parseInt(r,10));var i=t.getAttribute("wait");i&&(this.wait=parseInt(i,10));var a=t.getAttribute("inactivity");a&&(this.inactivity=parseInt(a,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(t){var e=this._getRequestStatus(t),n=this._conn.protocolErrorHandlers.HTTP[e];n&&n.call(this,e)},_hitError:function(t){this.errors++,E.warn("request errored, status: "+t+", number of errors: "+this.errors),4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(t){E.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),t=t?t.bind(this._conn):this._conn._connect_cb.bind(this._conn);var e=this._buildBody();this._requests.push(new E.Request(e.tree(),this._onRequestStateChange.bind(this,t),e.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;0<this._requests.length;){var t=this._requests.pop();t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}}},_onIdle:function(){var t=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===t.length&&!this._conn.disconnecting&&(E.info("no requests during idle cycle, sending blank request"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&0<t.length){for(var e=this._buildBody(),n=0;n<t.length;n++)null!==t[n]&&("restart"===t[n]?e.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":E.NS.BOSH}):e.cnode(t[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new E.Request(e.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),e.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(0<this._requests.length){var s=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(E.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),s>Math.floor(E.TIMEOUT*this.wait)&&(E.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(E.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(t,e){var n;if(4===t.xhr.readyState)try{n=t.xhr.status}catch(t){E.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof e?e:0),n},_onRequestStateChange:function(t,e){if(E.debug("request id "+e.id+"."+e.sends+" state changed to "+e.xhr.readyState),e.abort)e.abort=!1;else if(4===e.xhr.readyState){var n=this._getRequestStatus(e);if(this.lastResponseHeaders=e.xhr.getAllResponseHeaders(),this.disconnecting&&400<=n)return this._hitError(n),void this._callProtocolErrorHandlers(e);var s=0<n&&n<500,o=e.sends>this._conn.maxRetries;if((s||o)&&(this._removeRequest(e),E.debug("request id "+e.id+" should now be removed")),200===n){var r=this._requests[0]===e;(this._requests[1]===e||r&&0<this._requests.length&&this._requests[0].age()>Math.floor(E.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(e.rid)+1),E.debug("request id "+e.id+"."+e.sends+" got 200"),t(e),this.errors=0}else 0===n||400<=n&&n<600||12e3<=n?(E.error("request id "+e.id+"."+e.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(e),400<=n&&n<500&&(this._conn._changeConnectStatus(E.Status.DISCONNECTING,null),this._conn._doDisconnect())):E.error("request id "+e.id+"."+e.sends+" error "+n+" happened");s||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(E.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(t){var n=this,s=this._requests[t],e=this._getRequestStatus(s,-1);if(s.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var o=s.age(),r=!isNaN(o)&&o>Math.floor(E.TIMEOUT*this.wait),i=null!==s.dead&&s.timeDead()>Math.floor(E.SECONDARY_TIMEOUT*this.wait),a=4===s.xhr.readyState&&(e<1||500<=e);if((r||i||a)&&(i&&E.error("Request ".concat(this._requests[t].id," timed out (secondary), restarting")),s.abort=!0,s.xhr.abort(),s.xhr.onreadystatechange=function(){},this._requests[t]=new E.Request(s.xmlData,s.origFunc,s.rid,s.sends),s=this._requests[t]),0===s.xhr.readyState){E.debug("request id "+s.id+"."+s.sends+" posting");try{var c=this._conn.options.contentType||"text/xml; charset=utf-8";s.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==s.xhr.setRequestHeader&&s.xhr.setRequestHeader("Content-Type",c),this._conn.options.withCredentials&&(s.xhr.withCredentials=!0)}catch(t){return E.error("XHR open failed: "+t.toString()),this._conn.connected||this._conn._changeConnectStatus(E.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(s.date=new Date,n._conn.options.customHeaders){var t=n._conn.options.customHeaders;for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&s.xhr.setRequestHeader(e,t[e])}s.xhr.send(s.data)};if(1<s.sends){var l=1e3*Math.min(Math.floor(E.TIMEOUT*this.wait),Math.pow(s.sends,3));setTimeout(function(){u()},l)}else u();s.sends++,this._conn.xmlOutput!==E.Connection.prototype.xmlOutput&&(s.xmlData.nodeName===this.strip&&s.xmlData.childNodes.length?this._conn.xmlOutput(s.xmlData.childNodes[0]):this._conn.xmlOutput(s.xmlData)),this._conn.rawOutput!==E.Connection.prototype.rawOutput&&this._conn.rawOutput(s.data)}else E.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+s.xhr.readyState)}},_removeRequest:function(t){E.debug("removing request");for(var e=this._requests.length-1;0<=e;e--)t===this._requests[e]&&this._requests.splice(e,1);t.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!==t.message)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(t){E.info("_sendTerminate was called");var e=this._buildBody().attrs({type:"terminate"});t&&e.cnode(t.tree());var n=new E.Request(e.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),e.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var t=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return t._conn._onIdle()},100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?E.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):E.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":function(t,e,n){"use strict";n.r(e);var d=n("./src/md5.js"),f=n("./src/sha1.js"),T=n("./src/utils.js");function r(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){return new g.Builder(t,e)}function o(t){return new g.Builder("iq",t)}function s(t){return new g.Builder("presence",t)}var g={VERSION:"1.3.0",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<g.XHTML.tags.length;e++)if(t===g.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==g.XHTML.attributes[t]&&0<g.XHTML.attributes[t].length)for(var n=0;n<g.XHTML.attributes[t].length;n++)if(e===g.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<g.XHTML.css.length;e++)if(t===g.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){g.NS[t]=e},forEachChild:function(t,e,n){for(var s=0;s<t.childNodes.length;s++){var o=t.childNodes[s];o.nodeType!==g.ElementType.NORMAL||e&&!this.isTagEqual(o,e)||n(o)}},isTagEqual:function(t,e){return t.tagName===e},_xmlGenerator:null,_makeGenerator:function(){var t;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(t=this._getIEXmlDom()).appendChild(t.createElement("strophe")):t=document.implementation.createDocument("jabber:client","strophe",null),t},xmlGenerator:function(){return g._xmlGenerator||(g._xmlGenerator=g._makeGenerator()),g._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(t){if(!t)return null;for(var e=g.xmlGenerator().createElement(t),n=1;n<arguments.length;n++){var s=arguments[n];if(s)if("string"==typeof s||"number"==typeof s)e.appendChild(g.xmlTextNode(s));else if("object"===C(s)&&"function"==typeof s.sort)for(var o=0;o<s.length;o++){var r=s[o];"object"===C(r)&&"function"==typeof r.sort&&void 0!==r[1]&&null!==r[1]&&e.setAttribute(r[0],r[1])}else if("object"===C(s))for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&void 0!==s[i]&&null!==s[i]&&e.setAttribute(i,s[i])}return e},xmlescape:function(t){return t=(t=(t=(t=(t=t.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(t){return t=(t=(t=(t=(t=t.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(t){return g.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t));return e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType===g.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType===g.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return g.xmlescape(e)},copyElement:function(t){var e;if(t.nodeType===g.ElementType.NORMAL){e=g.xmlElement(t.tagName);for(var n=0;n<t.attributes.length;n++)e.setAttribute(t.attributes[n].nodeName,t.attributes[n].value);for(var s=0;s<t.childNodes.length;s++)e.appendChild(g.copyElement(t.childNodes[s]))}else t.nodeType===g.ElementType.TEXT&&(e=g.xmlGenerator().createTextNode(t.nodeValue));return e},createHtml:function(t){var e;if(t.nodeType===g.ElementType.NORMAL){var n=t.nodeName.toLowerCase();if(g.XHTML.validTag(n))try{e=g.xmlElement(n);for(var s=0;s<g.XHTML.attributes[n].length;s++){var o=g.XHTML.attributes[n][s],r=t.getAttribute(o);if(null!=r&&""!==r&&!1!==r&&0!==r)if("style"===o&&"object"===C(r)&&void 0!==r.cssText&&(r=r.cssText),"style"===o){for(var i=[],a=r.split(";"),c=0;c<a.length;c++){var u=a[c].split(":"),l=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(g.XHTML.validCSS(l)){var E=u[1].replace(/^\s*/,"").replace(/\s*$/,"");i.push(l+": "+E)}}0<i.length&&(r=i.join("; "),e.setAttribute(o,r))}else e.setAttribute(o,r)}for(var h=0;h<t.childNodes.length;h++)e.appendChild(g.createHtml(t.childNodes[h]))}catch(t){e=g.xmlTextNode("")}else{e=g.xmlGenerator().createDocumentFragment();for(var p=0;p<t.childNodes.length;p++)e.appendChild(g.createHtml(t.childNodes[p]))}}else if(t.nodeType===g.ElementType.FRAGMENT){e=g.xmlGenerator().createDocumentFragment();for(var d=0;d<t.childNodes.length;d++)e.appendChild(g.createHtml(t.childNodes[d]))}else t.nodeType===g.ElementType.TEXT&&(e=g.xmlTextNode(t.nodeValue));return e},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=g.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},_handleError:function(t){void 0!==t.stack&&g.fatal(t.stack),t.sourceURL?g.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?g.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):g.fatal("error: "+t.message)},log:function(t,e){t===this.LogLevel.FATAL&&"object"===C(window.console)&&"function"==typeof window.console.error&&window.console.error(e)},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(n){if(!n)return null;"function"==typeof n.tree&&(n=n.tree());var t=r(Array(n.attributes.length).keys()).map(function(t){return n.attributes[t].nodeName});t.sort();var e=t.reduce(function(t,e){return"".concat(t," ").concat(e,'="').concat(g.xmlescape(n.attributes.getNamedItem(e).value),'"')},"<".concat(n.nodeName));if(0<n.childNodes.length){e+=">";for(var s=0;s<n.childNodes.length;s++){var o=n.childNodes[s];switch(o.nodeType){case g.ElementType.NORMAL:e+=g.serialize(o);break;case g.ElementType.TEXT:e+=g.xmlescape(o.nodeValue);break;case g.ElementType.CDATA:e+="<![CDATA["+o.nodeValue+"]]>"}}e+="</"+n.nodeName+">"}else e+="/>";return e},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){g._connectionPlugins[t]=e},Builder:function(t,e){"presence"!==t&&"message"!==t&&"iq"!==t||(e&&!e.xmlns?e.xmlns=g.NS.CLIENT:e||(e={xmlns:g.NS.CLIENT})),this.nodeTree=g.xmlElement(t,e),this.node=this.nodeTree}};g.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return g.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(void 0===t[e]?this.node.removeAttribute(e):this.node.setAttribute(e,t[e]));return this},c:function(t,e,n){var s=g.xmlElement(t,e,n);return this.node.appendChild(s),"string"!=typeof n&&"number"!=typeof n&&(this.node=s),this},cnode:function(t){var e,n=g.xmlGenerator();try{e=void 0!==n.importNode}catch(t){e=!1}var s=e?n.importNode(t,!0):g.copyElement(t);return this.node.appendChild(s),this.node=s,this},t:function(t){var e=g.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement("body");e.innerHTML=t;for(var n=g.createHtml(e);0<n.childNodes.length;)this.node.appendChild(n.childNodes[0]);return this}},g.Handler=function(t,e,n,s,o,r,i){this.handler=t,this.ns=e,this.name=n,this.type=s,this.id=o,this.options=i||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(g.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=r?g.getBareJidFromJid(r):null:this.from=r,this.user=!0},g.Handler.prototype={getNamespace:function(t){var e=t.getAttribute("xmlns");return e&&this.options.ignoreNamespaceFragment&&(e=e.split("#")[0]),e},namespaceMatch:function(t){var e=this,n=!1;return!this.ns||(g.forEachChild(t,null,function(t){e.getNamespace(t)===e.ns&&(n=!0)}),n||this.getNamespace(t)===this.ns)},isMatch:function(t){var e=t.getAttribute("from");this.options.matchBareFromJid&&(e=g.getBareJidFromJid(e));var n=t.getAttribute("type");return!(!this.namespaceMatch(t)||this.name&&!g.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&t.getAttribute("id")!==this.id||this.from&&e!==this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw g._handleError(t),t}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},g.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},g.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},g.Connection=function(t,e){var n=this;this.service=t,this.options=e||{};var s=this.options.protocol||"";for(var o in 0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===s.indexOf("ws")?this._proto=new g.Websocket(this):this._proto=new g.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return n._onIdle()},100),T.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),g._connectionPlugins)if(Object.prototype.hasOwnProperty.call(g._connectionPlugins,o)){var r=function(){};r.prototype=g._connectionPlugins[o],this[o]=new r,this[o].init(this)}},g.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)});return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},addProtocolErrorHandler:function(t,e,n){this.protocolErrorHandlers[t][e]=n},connect:function(t,e,n,s,o,r,i){this.jid=t,this.authzid=g.getBareJidFromJid(this.jid),this.authcid=i||g.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=g.getDomainFromJid(this.jid),this._changeConnectStatus(g.Status.CONNECTING,null),this._proto._connect(s,o,r)},attach:function(t,e,n,s,o,r,i){if(!(this._proto instanceof g.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(t,e,n,s,o,r,i)},restore:function(t,e,n,s,o){if(!this._sessionCachingSupported()){var r=new Error('The "restore" method can only be used with a BOSH connection.');throw r.name="StropheSessionError",r}this._proto._restore(t,e,n,s,o)},_sessionCachingSupported:function(){if(this._proto instanceof g.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(t,e,n,s){var o=this,r=null;"function"==typeof t.tree&&(t=t.tree());var i=t.getAttribute("id");if(i||(i=this.getUniqueId("sendPresence"),t.setAttribute("id",i)),"function"==typeof e||"function"==typeof n){var a=this.addHandler(function(t){r&&o.deleteTimedHandler(r),"error"===t.getAttribute("type")?n&&n(t):e&&e(t)},null,"presence",null,i);s&&(r=this.addTimedHandler(s,function(){return o.deleteHandler(a),n&&n(null),!1}))}return this.send(t),i},sendIQ:function(t,s,o,e){var r=this,i=null;"function"==typeof t.tree&&(t=t.tree());var n=t.getAttribute("id");if(n||(n=this.getUniqueId("sendIQ"),t.setAttribute("id",n)),"function"==typeof s||"function"==typeof o){var a=this.addHandler(function(t){i&&r.deleteTimedHandler(i);var e=t.getAttribute("type");if("result"===e)s&&s(t);else{if("error"!==e){var n=new Error("Got bad IQ type of ".concat(e));throw n.name="StropheError",n}o&&o(t)}},null,"iq",["error","result"],n);e&&(i=this.addTimedHandler(e,function(){return r.deleteHandler(a),o&&o(null),!1}))}return this.send(t),n},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes){var e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(t)},_sendRestart:function(){var t=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return t._onIdle()},100)},addTimedHandler:function(t,e){var n=new g.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,s,o,r,i){var a=new g.Handler(t,e,n,s,o,r,i);return this.addHandlers.push(a),a},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);0<=e&&this.addHandlers.splice(e,1)},registerSASLMechanisms:function(t){this.mechanisms={},(t=t||[g.SASLAnonymous,g.SASLExternal,g.SASLMD5,g.SASLOAuthBearer,g.SASLXOAuth2,g.SASLPlain,g.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(t){this.mechanisms[t.prototype.name]=t},disconnect:function(t){if(this._changeConnectStatus(g.Status.DISCONNECTING,t),g.info("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=s({xmlns:g.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else g.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(t,e,n){for(var s in g._connectionPlugins)if(Object.prototype.hasOwnProperty.call(g._connectionPlugins,s)){var o=this[s];if(o.statusChanged)try{o.statusChanged(t,e)}catch(t){g.error("".concat(s," plugin caused an exception changing status: ").concat(t))}}if(this.connect_callback)try{this.connect_callback(t,e,n)}catch(t){g._handleError(t),g.error("User connection callback caused an exception: ".concat(t))}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),g.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(g.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){var o=this;g.info("_dataRecv called");var n=this._proto._reqToData(t);if(null!==n){for(this.xmlInput!==g.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==g.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(g.serialize(n)));0<this.removeHandlers.length;){var s=this.removeHandlers.pop(),r=this.handlers.indexOf(s);0<=r&&this.handlers.splice(r,1)}for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var i=n.getAttribute("type");if(null!==i&&"terminate"===i){if(this.disconnecting)return;var a=n.getAttribute("condition"),c=n.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&0<c.length&&(a="conflict"),this._changeConnectStatus(g.Status.CONNFAIL,a)):this._changeConnectStatus(g.Status.CONNFAIL,g.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}g.forEachChild(n,null,function(t){var e=o.handlers;o.handlers=[];for(var n=0;n<e.length;n++){var s=e[n];try{!s.isMatch(t)||!o.authenticated&&s.user?o.handlers.push(s):s.run(t)&&o.handlers.push(s)}catch(t){g.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}}},mechanisms:{},_connect_cb:function(t,e,n){var s;g.info("_connect_cb was called"),this.connected=!0;try{s=this._proto._reqToData(t)}catch(t){if(t.name!==g.ErrorCondition.BAD_FORMAT)throw t;this._changeConnectStatus(g.Status.CONNFAIL,g.ErrorCondition.BAD_FORMAT),this._doDisconnect(g.ErrorCondition.BAD_FORMAT)}if(s&&(this.xmlInput!==g.Connection.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==g.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(g.serialize(s))),this._proto._connect_cb(s)!==g.Status.CONNFAIL))if(s.getElementsByTagNameNS?0<s.getElementsByTagNameNS(g.NS.STREAM,"features").length:0<s.getElementsByTagName("stream:features").length||0<s.getElementsByTagName("features").length){var o=[],r=s.getElementsByTagName("mechanism");if(0<r.length)for(var i=0;i<r.length;i++){var a=g.getText(r[i]);this.mechanisms[a]&&o.push(this.mechanisms[a])}0!==o.length||0!==s.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(o):this._proto._no_auth_received(e)}else this._proto._no_auth_received(e)},sortMechanismsByPriority:function(t){for(var e=0;e<t.length-1;++e){for(var n=e,s=e+1;s<t.length;++s)t[s].prototype.priority>t[n].prototype.priority&&(n=s);if(n!==e){var o=t[e];t[e]=t[n],t[n]=o}}return t},_attemptSASLAuth:function(t){t=this.sortMechanismsByPriority(t||[]);for(var e=!1,n=0;n<t.length;++n)if(t[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new t[n],this._sasl_mechanism.onStart(this);var s=i("auth",{xmlns:g.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var o=this._sasl_mechanism.onChallenge(this,null);s.t(btoa(o))}this.send(s.tree()),e=!0;break}return e},_attemptLegacyAuth:function(){null===g.getNodeFromJid(this.jid)?(this._changeConnectStatus(g.Status.CONNFAIL,g.ErrorCondition.MISSING_JID_NODE),this.disconnect(g.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(g.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:g.NS.AUTH}).c("username",{}).t(g.getNodeFromJid(this.jid)).tree()))},authenticate:function(t){this._attemptSASLAuth(t)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(t){var e=atob(g.getText(t)),n=this._sasl_mechanism.onChallenge(this,e),s=i("response",{xmlns:g.NS.SASL});return""!==n&&s.t(btoa(n)),this.send(s.tree()),!0},_auth1_cb:function(t){var e=o({type:"set",id:"_auth_2"}).c("query",{xmlns:g.NS.AUTH}).c("username",{}).t(g.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return g.getResourceFromJid(this.jid)||(this.jid=g.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(g.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){var n=this;if(this._sasl_data["server-signature"]){var e,s=atob(g.getText(t)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===s[1]&&(e=s[2]),e!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}g.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var o=[],r=function(t,e){for(;t.length;)n.deleteHandler(t.pop());return n._sasl_auth1_cb(e),!1};return o.push(this._addSysHandler(function(t){return r(o,t)},null,"stream:features",null,null)),o.push(this._addSysHandler(function(t){return r(o,t)},g.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(g.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var s=g.getResourceFromJid(this.jid);return s?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:g.NS.BIND}).c("resource",{}).t(s).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:g.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){var e;if("error"===t.getAttribute("type"))return g.info("SASL binding failed."),0<t.getElementsByTagName("conflict").length&&(e=g.ErrorCondition.CONFLICT),this._changeConnectStatus(g.Status.AUTHFAIL,e,t),!1;var n=t.getElementsByTagName("bind");if(!(0<n.length))return g.info("SASL binding failed."),this._changeConnectStatus(g.Status.AUTHFAIL,null,t),!1;var s=n[0].getElementsByTagName("jid");0<s.length&&(this.jid=g.getText(s[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:g.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(g.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if("result"===t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(g.Status.CONNECTED,null);else if("error"===t.getAttribute("type"))return g.info("Session creation failed."),this._changeConnectStatus(g.Status.AUTHFAIL,null,t),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(g.Status.AUTHFAIL,null,t),!1},_auth2_cb:function(t){return"result"===t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(g.Status.CONNECTED,null)):"error"===t.getAttribute("type")&&(this._changeConnectStatus(g.Status.AUTHFAIL,null,t),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new g.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,s,o){var r=new g.Handler(t,e,n,s,o);return r.user=!1,this.addHandlers.push(r),r},_onDisconnectTimeout:function(){return g.info("_onDisconnectTimeout was called"),this._changeConnectStatus(g.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t=this;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;){var e=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(e);0<=n&&this.timedHandlers.splice(n,1)}for(var s=(new Date).getTime(),o=[],r=0;r<this.timedHandlers.length;r++){var i=this.timedHandlers[r];if(this.authenticated||!i.user)i.lastCalled+i.period-s<=0?i.run()&&o.push(i):o.push(i)}this.timedHandlers=o,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return t._onIdle()},100))}},g.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},g.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},g.SASLAnonymous=function(){},g.SASLAnonymous.prototype=new g.SASLMechanism("ANONYMOUS",!1,20),g.SASLAnonymous.prototype.test=function(t){return null===t.authcid},g.SASLPlain=function(){},g.SASLPlain.prototype=new g.SASLMechanism("PLAIN",!0,50),g.SASLPlain.prototype.test=function(t){return null!==t.authcid},g.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,T.default.utf16to8(e)},g.SASLSHA1=function(){},g.SASLSHA1.prototype=new g.SASLMechanism("SCRAM-SHA-1",!0,70),g.SASLSHA1.prototype.test=function(t){return null!==t.authcid},g.SASLSHA1.prototype.onChallenge=function(t,e,n){var s=n||d.default.hexdigest(1234567890*Math.random()),o="n="+T.default.utf16to8(t.authcid);return o+=",r=",o+=s,t._sasl_data.cnonce=s,o="n,,"+(t._sasl_data["client-first-message-bare"]=o),this.onChallenge=function(t,e){for(var n,s,o,r,i,a,c,u,l="c=biws,",E="".concat(t._sasl_data["client-first-message-bare"],",").concat(e,","),h=t._sasl_data.cnonce,p=/([a-z]+)=([^,]+)(,|$)/;e.match(p);){var d=e.match(p);switch(e=e.replace(d[0],""),d[1]){case"r":n=d[2];break;case"s":s=d[2];break;case"i":o=d[2]}}if(n.substr(0,h.length)!==h)return t._sasl_data={},t._sasl_failure_cb();E+=l+="r="+n,s=atob(s),s+="\0\0\0";var C=T.default.utf16to8(t.pass);for(r=a=f.default.core_hmac_sha1(C,s),c=1;c<o;c++){for(i=f.default.core_hmac_sha1(C,f.default.binb2str(a)),u=0;u<5;u++)r[u]^=i[u];a=i}r=f.default.binb2str(r);var g=f.default.core_hmac_sha1(r,"Client Key"),_=f.default.str_hmac_sha1(r,"Server Key"),S=f.default.core_hmac_sha1(f.default.str_sha1(f.default.binb2str(g)),E);for(t._sasl_data["server-signature"]=f.default.b64_hmac_sha1(_,E),u=0;u<5;u++)g[u]^=S[u];return l+=",p="+btoa(f.default.binb2str(g))},o},g.SASLMD5=function(){},g.SASLMD5.prototype=new g.SASLMechanism("DIGEST-MD5",!1,60),g.SASLMD5.prototype.test=function(t){return null!==t.authcid},g.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},g.SASLMD5.prototype.onChallenge=function(t,e,n){for(var s=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,o=n||d.default.hexdigest(""+1234567890*Math.random()),r="",i=null,a="";e.match(s);){var c=e.match(s);switch(e=e.replace(c[0],""),c[2]=c[2].replace(/^"(.+)"$/,"$1"),c[1]){case"realm":r=c[2];break;case"nonce":a=c[2];break;case"qop":c[2];break;case"host":i=c[2]}}var u=t.servtype+"/"+t.domain;null!==i&&(u=u+"/"+i);var l=T.default.utf16to8(t.authcid+":"+r+":"+this._connection.pass),E=d.default.hash(l)+":"+a+":"+o,h="AUTHENTICATE:"+u,p="";return p+="charset=utf-8,",p+="username="+this._quote(T.default.utf16to8(t.authcid))+",",p+="realm="+this._quote(r)+",",p+="nonce="+this._quote(a)+",",p+="nc=00000001,",p+="cnonce="+this._quote(o)+",",p+="digest-uri="+this._quote(u)+",",p+="response="+d.default.hexdigest(d.default.hexdigest(E)+":"+a+":00000001:"+o+":auth:"+d.default.hexdigest(h))+",",p+="qop=auth",this.onChallenge=function(){return""},p},g.SASLOAuthBearer=function(){},g.SASLOAuthBearer.prototype=new g.SASLMechanism("OAUTHBEARER",!0,40),g.SASLOAuthBearer.prototype.test=function(t){return null!==t.pass},g.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,";return null!==t.authcid&&(e=e+"a="+t.authzid),e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",e+="",T.default.utf16to8(e)},g.SASLExternal=function(){},g.SASLExternal.prototype=new g.SASLMechanism("EXTERNAL",!0,10),g.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},g.SASLXOAuth2=function(){},g.SASLXOAuth2.prototype=new g.SASLMechanism("X-OAUTH2",!0,30),g.SASLXOAuth2.prototype.test=function(t){return null!==t.pass},g.SASLXOAuth2.prototype.onChallenge=function(t){var e="\0";return null!==t.authcid&&(e+=t.authzid),e+="\0",e+=t.pass,T.default.utf16to8(e)},e.default={Strophe:g,$build:i,$iq:o,$msg:function(t){return new g.Builder("message",t)},$pres:s,SHA1:f.default,MD5:d.default,b64_hmac_sha1:f.default.b64_hmac_sha1,b64_sha1:f.default.b64_sha1,str_hmac_sha1:f.default.str_hmac_sha1,str_sha1:f.default.str_sha1}},"./src/md5.js":function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return r});var E=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},s=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},a=function(t,e,n,s,o,r){return E((i=E(E(e,t),E(s,r)))<<(a=o)|i>>>32-a,n);var i,a},h=function(t,e,n,s,o,r,i){return a(e&n|~e&s,t,e,o,r,i)},p=function(t,e,n,s,o,r,i){return a(e&s|n&~s,t,e,o,r,i)},d=function(t,e,n,s,o,r,i){return a(e^n^s,t,e,o,r,i)},C=function(t,e,n,s,o,r,i){return a(n^(e|~s),t,e,o,r,i)},o=function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var n,s,o,r,i=1732584193,a=-271733879,c=-1732584194,u=271733878,l=0;l<t.length;l+=16)i=h(n=i,s=a,o=c,r=u,t[l+0],7,-680876936),u=h(u,i,a,c,t[l+1],12,-389564586),c=h(c,u,i,a,t[l+2],17,606105819),a=h(a,c,u,i,t[l+3],22,-1044525330),i=h(i,a,c,u,t[l+4],7,-176418897),u=h(u,i,a,c,t[l+5],12,1200080426),c=h(c,u,i,a,t[l+6],17,-1473231341),a=h(a,c,u,i,t[l+7],22,-45705983),i=h(i,a,c,u,t[l+8],7,1770035416),u=h(u,i,a,c,t[l+9],12,-1958414417),c=h(c,u,i,a,t[l+10],17,-42063),a=h(a,c,u,i,t[l+11],22,-1990404162),i=h(i,a,c,u,t[l+12],7,1804603682),u=h(u,i,a,c,t[l+13],12,-40341101),c=h(c,u,i,a,t[l+14],17,-1502002290),a=h(a,c,u,i,t[l+15],22,1236535329),i=p(i,a,c,u,t[l+1],5,-165796510),u=p(u,i,a,c,t[l+6],9,-1069501632),c=p(c,u,i,a,t[l+11],14,643717713),a=p(a,c,u,i,t[l+0],20,-373897302),i=p(i,a,c,u,t[l+5],5,-701558691),u=p(u,i,a,c,t[l+10],9,38016083),c=p(c,u,i,a,t[l+15],14,-660478335),a=p(a,c,u,i,t[l+4],20,-405537848),i=p(i,a,c,u,t[l+9],5,568446438),u=p(u,i,a,c,t[l+14],9,-1019803690),c=p(c,u,i,a,t[l+3],14,-187363961),a=p(a,c,u,i,t[l+8],20,1163531501),i=p(i,a,c,u,t[l+13],5,-1444681467),u=p(u,i,a,c,t[l+2],9,-51403784),c=p(c,u,i,a,t[l+7],14,1735328473),a=p(a,c,u,i,t[l+12],20,-1926607734),i=d(i,a,c,u,t[l+5],4,-378558),u=d(u,i,a,c,t[l+8],11,-2022574463),c=d(c,u,i,a,t[l+11],16,1839030562),a=d(a,c,u,i,t[l+14],23,-35309556),i=d(i,a,c,u,t[l+1],4,-1530992060),u=d(u,i,a,c,t[l+4],11,1272893353),c=d(c,u,i,a,t[l+7],16,-155497632),a=d(a,c,u,i,t[l+10],23,-1094730640),i=d(i,a,c,u,t[l+13],4,681279174),u=d(u,i,a,c,t[l+0],11,-358537222),c=d(c,u,i,a,t[l+3],16,-722521979),a=d(a,c,u,i,t[l+6],23,76029189),i=d(i,a,c,u,t[l+9],4,-640364487),u=d(u,i,a,c,t[l+12],11,-421815835),c=d(c,u,i,a,t[l+15],16,530742520),a=d(a,c,u,i,t[l+2],23,-995338651),i=C(i,a,c,u,t[l+0],6,-198630844),u=C(u,i,a,c,t[l+7],10,1126891415),c=C(c,u,i,a,t[l+14],15,-1416354905),a=C(a,c,u,i,t[l+5],21,-57434055),i=C(i,a,c,u,t[l+12],6,1700485571),u=C(u,i,a,c,t[l+3],10,-1894986606),c=C(c,u,i,a,t[l+10],15,-1051523),a=C(a,c,u,i,t[l+1],21,-2054922799),i=C(i,a,c,u,t[l+8],6,1873313359),u=C(u,i,a,c,t[l+15],10,-30611744),c=C(c,u,i,a,t[l+6],15,-1560198380),a=C(a,c,u,i,t[l+13],21,1309151649),i=C(i,a,c,u,t[l+4],6,-145523070),u=C(u,i,a,c,t[l+11],10,-1120210379),c=C(c,u,i,a,t[l+2],15,718787259),a=C(a,c,u,i,t[l+9],21,-343485551),i=E(i,n),a=E(a,s),c=E(c,o),u=E(u,r);return[i,a,c,u]},r={hexdigest:function(t){return function(t){for(var e="0123456789abcdef",n="",s=0;s<4*t.length;s++)n+=e.charAt(t[s>>2]>>s%4*8+4&15)+e.charAt(t[s>>2]>>s%4*8&15);return n}(o(s(t),8*t.length))},hash:function(t){return function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e}(o(s(t),8*t.length))}}},"./src/sha1.js":function(t,e,n){"use strict";function a(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;var n,s,o,r,i,a,c,u,l,E=new Array(80),h=1732584193,p=-271733879,d=-1732584194,C=271733878,g=-1009589776;for(n=0;n<t.length;n+=16){for(r=h,i=p,a=d,c=C,u=g,s=0;s<80;s++)E[s]=s<16?t[n+s]:f(E[s-3]^E[s-8]^E[s-14]^E[s-16],1),o=S(S(f(h,5),_(s,p,d,C)),S(S(g,E[s]),(l=s)<20?1518500249:l<40?1859775393:l<60?-1894007588:-899497514)),g=C,C=d,d=f(p,30),p=h,h=o;h=S(h,r),p=S(p,i),d=S(d,a),C=S(C,c),g=S(g,u)}return[h,p,d,C,g]}function _(t,e,n,s){return t<20?e&n|~e&s:t<40?e^n^s:t<60?e&n|e&s|n&s:e^n^s}function s(t,e){var n=c(t);16<n.length&&(n=a(n,8*t.length));for(var s=new Array(16),o=new Array(16),r=0;r<16;r++)s[r]=909522486^n[r],o[r]=1549556828^n[r];var i=a(s.concat(c(e)),512+8*e.length);return a(o.concat(i),672)}function S(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function f(t,e){return t<<e|t>>>32-e}function c(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function o(t){for(var e,n,s="",o=0;o<4*t.length;o+=3)for(e=(t[o>>2]>>8*(3-o%4)&255)<<16|(t[o+1>>2]>>8*(3-(o+1)%4)&255)<<8|t[o+2>>2]>>8*(3-(o+2)%4)&255,n=0;n<4;n++)8*o+6*n>32*t.length?s+="=":s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6*(3-n)&63);return s}function r(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}n.r(e),n.d(e,"default",function(){return i});var i={b64_hmac_sha1:function(t,e){return o(s(t,e))},b64_sha1:function(t){return o(a(c(t),8*t.length))},binb2str:r,core_hmac_sha1:s,str_hmac_sha1:function(t,e){return r(s(t,e))},str_sha1:function(t){return r(a(c(t),8*t.length))}}},"./src/strophe.js":function(t,e,n){"use strict";n.r(e);n("./src/bosh.js"),n("./src/websocket.js");var s=n("./src/core.js");n.d(e,"default",function(){return s.default})},"./src/utils.js":function(t,e,n){"use strict";function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.r(e),n.d(e,"default",function(){return s});var s={utf16to8:function(t){var e,n,s="",o=t.length;for(e=0;e<o;e++)0<=(n=t.charCodeAt(e))&&n<=127?s+=t.charAt(e):(2047<n?(s+=String.fromCharCode(224|n>>12&15),s+=String.fromCharCode(128|n>>6&63)):s+=String.fromCharCode(192|n>>6&31),s+=String.fromCharCode(128|n>>0&63));return s},addCookies:function(t){for(var e in t=t||{})if(Object.prototype.hasOwnProperty.call(t,e)){var n="",s="",o="",r=t[e],i="object"===c(r),a=escape(unescape(i?r.value:r));i&&(n=r.expires?";expires="+r.expires:"",s=r.domain?";domain="+r.domain:"",o=r.path?";path="+r.path:""),document.cookie=e+"="+a+n+s+o}}}},"./src/websocket.js":function(t,e,n){"use strict";n.r(e);var s=n("./src/core.js"),u=s.default.Strophe,o=s.default.$build;u.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==e.indexOf("/")?n+=window.location.pathname+e:n+=e,t.service=n}},u.Websocket.prototype={_buildStream:function(){return o("open",{xmlns:u.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(t,e){var n;if(0===(n=t.getElementsByTagNameNS?t.getElementsByTagNameNS(u.NS.STREAM,"error"):t.getElementsByTagName("stream:error")).length)return!1;for(var s=n[0],o="",r="",i=0;i<s.childNodes.length;i++){var a=s.childNodes[i];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;"text"===a.nodeName?r=a.textContent:o=a.nodeName}var c="WebSocket stream error: ";return c+=o||"unknown",r&&(c+=" - "+r),u.error(c),this._conn._changeConnectStatus(e,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){if(this._check_streamerror(t,u.Status.CONNFAIL))return u.Status.CONNFAIL},_handleStreamStart:function(t){var e=!1,n=t.getAttribute("xmlns");"string"!=typeof n?e="Missing xmlns in <open />":n!==u.NS.FRAMING&&(e="Wrong xmlns in <open />: "+n);var s=t.getAttribute("version");return"string"!=typeof s?e="Missing version in <open />":"1.0"!==s&&(e="Wrong version in <open />: "+s),!e||(this._conn._changeConnectStatus(u.Status.CONNFAIL,e),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(t){if(0===t.data.indexOf("<open ")||0===t.data.indexOf("<?xml")){var e=t.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===e)return;var n=(new DOMParser).parseFromString(e,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(t.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===t.data.indexOf("<close ")){var s=(new DOMParser).parseFromString(t.data,"text/xml").documentElement;this._conn.xmlInput(s),this._conn.rawInput(t.data);var o=s.getAttribute("see-other-uri");if(o){var r=this._conn.service;(0<=r.indexOf("wss:")&&0<=o.indexOf("wss:")||0<=r.indexOf("ws:"))&&(this._conn._changeConnectStatus(u.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect())}else this._conn._changeConnectStatus(u.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var i=this._streamWrap(t.data),a=(new DOMParser).parseFromString(i,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(a,null,t.data)}},_disconnect:function(t){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){t&&this._conn.send(t);var e=o("close",{xmlns:u.NS.FRAMING});this._conn.xmlOutput(e.tree());var n=u.serialize(e);this._conn.rawOutput(n);try{this.socket.send(n)}catch(t){u.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){u.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(t){u.debug(t.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(t){this._conn.connected&&!this._conn.disconnecting?(u.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t&&1006===t.code&&!this._conn.connected&&this.socket?(u.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(u.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):u.info("Websocket closed")},_no_auth_received:function(t){u.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(u.Status.CONNFAIL,u.ErrorCondition.NO_AUTH_MECH),t&&t.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){u.error("Websocket error "+t),this._conn._changeConnectStatus(u.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var t=this._conn._data;if(0<t.length&&!this._conn.paused){for(var e=0;e<t.length;e++)if(null!==t[e]){var n=void 0;n="restart"===t[e]?this._buildStream().tree():t[e];var s=u.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}},_onMessage:function(t){var e,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(t.data===n)return this._conn.rawInput(n),this._conn.xmlInput(t),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===t.data.search("<open ")){if(e=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(e))return}else{var s=this._streamWrap(t.data);e=(new DOMParser).parseFromString(s,"text/xml").documentElement}return this._check_streamerror(e,u.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===e.firstChild.nodeName&&"unavailable"===e.firstChild.getAttribute("type")?(this._conn.xmlInput(e),void this._conn.rawInput(u.serialize(e))):void this._conn._dataRecv(e,t.data)},_onOpen:function(){u.info("Websocket open");var t=this._buildStream();this._conn.xmlOutput(t.tree());var e=u.serialize(t);this._conn.rawOutput(e),this.socket.send(e)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},t.exports=s()},function(t,e,n){"use strict";e.__esModule=!0,e.SERVER_ERRORS={AUTH_ERR:{code:"AUTH_ERR_AUTH_TOKEN_NOT_FOUND",message:"The auth token %s% does not exist. Please make sure you are logged in and have a valid auth token or try login again."}},e.ERRORS={PARAMETER_MISSING:{code:"MISSING_PARAMETERS",name:"MISSING/ INVALID PARAMETER"}},e.INIT_ERROR={NO_APP_ID:{code:e.ERRORS.PARAMETER_MISSING.code,name:e.ERRORS.PARAMETER_MISSING.name,message:"mandatory parameter appId missing",details:{}}},e.GROUP_CREATION_ERRORS={EMPTY_PASSWORD:{code:"ERR_EMPTY_GROUP_PASS",details:void 0,message:"The password is required to join a group.",name:void 0}},e.USERS_REQUEST_ERRORS={EMPTY_USERS_LIST:{code:"EMPTY_USERS_LIST",name:"EMPTY_USERS_LIST",message:"please provide atleat one uid",details:{}}},e.MESSAGES_REQUEST_ERRORS={REQUEST_IN_PROGRESS_ERROR:{code:"REQUEST_IN_PROGRESS",name:"REQUEST_IN_PROGRESS",message:"request already in progress",details:{}},NOT_ENOUGH_PARAMS:{code:"NOT_ENOUGH_PARAMETERS",name:"NOT_ENOUGH_PARAMETERS",message:"you need to set timstamp or message id to fetch next set of messages",details:{}}},e.MESSAGE_ERRORS={INVALID_CUSTOM_DATA:{code:"-1",name:"%s_CUSTOM_DATA",message:"",details:{}}},e.LOGIN_ERROR={NOT_INITIALIZED:{code:"-1",name:"COMETCHAT_INITIALIZATION_NOT_DONE",message:"please initialize the cometchat before using login method",details:{}},UNAUTHORISED:{code:401,name:"USER_NOT_AUTHORISED",message:"provided user is not authorised",details:{}},XMPP_CONNECTION_FAIL:{code:-1,name:"WS_CONNECTION_FAIL",message:"WS Connection failed. %s",details:{}},XMPP_CONNECTION_FAIL_PORT_ERROR:{code:-1,name:"WS_CONNECTION_FAIL",message:"WS Connection failed. Trying to connect with port: %s",details:{}},XMPP_CONNECTION_FALLBACK_FAIL_PORT_ERROR:{code:-1,name:"WS_CONNECTION_FALLBACK_FAIL",message:"WS Connection fallback failed. Trying to connect with port: %s",details:{}},XMPP_AUTH_FAIL:{code:-1,name:"WS_AUTH_FAIL",message:"WS username/password not correct",details:{}},NO_INTERNET:{code:-1,name:"NO_INTERNET_CONNECTION",message:"You do not have internet connection",details:{}}},e.TYPINGNOTIFICATION_CONSTANTS={TOO_MANY_REQUEST:{code:"TOO_MANY_REQUEST",name:"TOO MANY REQUEST",message:"too many request, wait for `%s` seconds before sending next request",details:{}}}},function(t,e,n){"use strict";e.__esModule=!0;var s=n(6),o=n(0),r=n(1),i=function(){function t(){}return t.trasformJSONGroup=function(t){var e;try{e=new s.Group(t[o.GroupConstants.KEYS.GUID],t[o.GroupConstants.KEYS.NAME],t[o.GroupConstants.KEYS.NAME]),t.wsChannel&&delete t.wsChannel,Object.assign(e,t),t=e}catch(t){r.Logger.error("GroupsController:transformJSONGroup",t)}return t},t}();e.GroupsController=i},function(t,e,n){"use strict";var s,r=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var o=n(12),a=n(0),c=n(5),u=n(6),l=n(1),E=function(o){function t(t,e,n){var s=o.call(this,t,"text",n,a.MessageCategory.MESSAGE)||this;return s.type="text",s.data={text:e},s.text=e,s}return r(t,o),t.prototype.getSender=function(){try{return this.getSenderFromData()}catch(t){return this.sender}},t.prototype.getReceiver=function(){try{return this.getReceiverFromData()}catch(t){return this.receiver}},t.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},t.prototype.setMetadata=function(t){this.metadata=t,this.data=i({},this.data,{metadata:t})},t.prototype.getData=function(){return this.data},t.prototype.setData=function(t){this.data=t},t.prototype.getText=function(){return this.text},t.prototype.setText=function(t){this.text=t,this.data.text=t},t.prototype.setProcessedText=function(t){this.processedText=t},t.prototype.getProcessedText=function(){return this.processedText},t.prototype.getSenderFromData=function(){try{var t=this.getData();if(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new c.User(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])}catch(t){l.Logger.error("TextMessageModel: getSenderFromData",t)}},t.prototype.getReceiverFromData=function(){try{var t=this.getData(),e=t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.RECEIVER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY];if(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.RECEIVER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITYTYPE]==[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITY_TYPE.USER])return new c.User(e);var n=new u.Group(e[a.GroupConstants.KEYS.GUID],e[a.GroupConstants.KEYS.NAME],e[a.MessageConstatnts.KEYS.TYPE]);return Object.assign(n,e)}catch(t){l.Logger.error("TextMessageModel: getReceiverFromData",t)}},t.TYPE=a.MessageConstatnts.TYPE.TEXT,t.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,t.CATEGORY=a.MessageConstatnts.CATEGORY.MESSAGE,t}(o.BaseMessage);e.TextMessage=E},function(t,e,n){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var r=n(12),a=n(0),c=n(5),u=n(6),l=n(1),E=function(r){function t(t,e,n,s){var o=r.call(this,t,n,s,a.MessageCategory.MESSAGE)||this;return o.data={url:"object"!=typeof e?e:void 0},o.file=e,o}return o(t,r),t.prototype.setCaption=function(t){this.caption=t,this.data[a.MessageConstatnts.KEYS.TEXT]=t},t.prototype.getCaption=function(){return this.data[a.MessageConstatnts.KEYS.TEXT]},t.prototype.getSender=function(){try{return this.getSenderFromData()}catch(t){return this.sender}},t.prototype.getReceiver=function(){try{return this.getReceiverFromData()}catch(t){return this.receiver}},t.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},t.prototype.setMetadata=function(t){this.metadata=t,this.data=i({},this.data,{metadata:t})},t.prototype.getData=function(){return this.data},t.prototype.setData=function(t){this.data=t},t.prototype.getAttachment=function(){return this.attachment},t.prototype.setAttachment=function(t){this.attachment=t},t.prototype.getURL=function(){try{var t=this.getData();if(t[a.MessageConstatnts.KEYS.URL])return t[a.MessageConstatnts.KEYS.URL]}catch(t){l.Logger.error("MediaMessageModel: getURL",t)}},t.prototype.getSenderFromData=function(){try{var t=this.getData();if(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new c.User(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])}catch(t){l.Logger.error("MediaMessageModel: getSenderFromData",t)}},t.prototype.getReceiverFromData=function(){try{var t=this.getData(),e=t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.RECEIVER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY];if(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.RECEIVER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITYTYPE]==[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITY_TYPE.USER])return new c.User(e);var n=new u.Group(e[a.GroupConstants.KEYS.GUID],e[a.GroupConstants.KEYS.NAME],e[a.MessageConstatnts.KEYS.TYPE]);return Object.assign(n,e)}catch(t){l.Logger.error("MediaMessageModel: getReceiverFromData",t)}},t.TYPE=a.MessageConstatnts.TYPE,t.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,t.CATEGORY=a.MessageConstatnts.CATEGORY,t}(r.BaseMessage);e.MediaMessage=E},function(t,e,n){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var i=n(12),c=n(0),u=n(5),l=n(1),E=n(6),a=function(a){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this;if(3==t.length){var s=t[0],o=t[1],r=t[2];n=a.call(this,s,c.MessageConstatnts.TYPE.CUSTOM,o,c.MessageCategory.MESSAGE)||this,("object"!=typeof r||Array.isArray(r))&&(r={}),n.customData=r,l.isFalsy(n.data)&&(n.data={}),n.data[c.MessageConstatnts.KEYS.CUSTOM_DATA]=r}if(4==t.length){s=t[0],o=t[1];var i=t[2];r=t[3];n=a.call(this,s,i,o,c.MessageCategory.CUSTOM)||this,("object"!=typeof r||Array.isArray(r))&&(r={}),n.customData=r,l.isFalsy(n.data)&&(n.data={}),n.data[c.MessageConstatnts.KEYS.CUSTOM_DATA]=r}return n}return o(t,a),t.prototype.getCustomData=function(){return this.customData},t.prototype.setCustomData=function(t){this.customData=t,this.data[c.MessageConstatnts.KEYS.CUSTOM_DATA]=t},t.prototype.getSender=function(){try{return this.getSenderFromData()}catch(t){return this.sender}},t.prototype.getReceiver=function(){try{return this.getReceiverFromData()}catch(t){return this.receiver}},t.prototype.getSubType=function(){return this.subType},t.prototype.setSubType=function(t){this.subType=t,this.data=r({},this.data,{subType:t})},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t,this.data=r({},this.data,{metadata:t})},t.prototype.getData=function(){return this.data},t.prototype.getSenderFromData=function(){try{var t=this.getData();if(t[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][c.MessageConstatnts.KEYS.SENDER][c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new u.User(t[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][c.MessageConstatnts.KEYS.SENDER][c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])}catch(t){l.Logger.error("CustomMessageModel: getSenderFromData",t)}},t.prototype.getReceiverFromData=function(){try{var t=this.getData(),e=t[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][c.MessageConstatnts.KEYS.RECEIVER][c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY];if(t[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][c.MessageConstatnts.KEYS.RECEIVER][c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITYTYPE]==[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITY_TYPE.USER])return new u.User(e);var n=new E.Group(e[c.GroupConstants.KEYS.GUID],e[c.GroupConstants.KEYS.NAME],e[c.MessageConstatnts.KEYS.TYPE]);return Object.assign(n,e)}catch(t){l.Logger.error("CustomMessageModel: getReceiverFromData",t)}},t}(i.BaseMessage);e.CustomMessage=a},function(t,e,n){"use strict";var s,i=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var o=n(1),r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onAction=void 0,this.onTextMessageReceived=void 0,this.onMediaMessageReceived=void 0,this.onCustomMessageReceived=void 0,this.onCall=void 0,this.onTypingStarted=void 0,this.onTypingEnded=void 0,this.onMessagesDelivered=void 0,this.onMessagesRead=void 0,this.onMessageEdited=void 0,this.onMessageDeleted=void 0,o.isFalsy(t[0].onAction)||(this.onAction=t[0].onAction),o.isFalsy(t[0].onTextMessageReceived)||(this.onTextMessageReceived=t[0].onTextMessageReceived),o.isFalsy(t[0].onMediaMessageReceived)||(this.onMediaMessageReceived=t[0].onMediaMessageReceived),o.isFalsy(t[0].onCall)||(this.onCall=t[0].onCall),o.isFalsy(t[0].onTypingStarted)||(this.onTypingStarted=t[0].onTypingStarted),o.isFalsy(t[0].onTypingEnded)||(this.onTypingEnded=t[0].onTypingEnded),o.isFalsy(t[0].onMessagesDelivered)||(this.onMessagesDelivered=t[0].onMessagesDelivered),o.isFalsy(t[0].onMessagesRead)||(this.onMessagesRead=t[0].onMessagesRead),o.isFalsy(t[0].onCustomMessageReceived)||(this.onCustomMessageReceived=t[0].onCustomMessageReceived),o.isFalsy(t[0].onMessageEdited)||(this.onMessageEdited=t[0].onMessageEdited),o.isFalsy(t[0].onMessageDeleted)||(this.onMessageDeleted=t[0].onMessageDeleted)};e.MessageEventListener=r;var a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onIncomingCallReceived=void 0,this.onOutgoingCallAccepted=void 0,this.onOutgoingCallRejected=void 0,this.onIncomingCallCancelled=void 0,o.isFalsy(t[0].onIncomingCallReceived)||(this.onIncomingCallReceived=t[0].onIncomingCallReceived),o.isFalsy(t[0].onOutgoingCallAccepted)||(this.onOutgoingCallAccepted=t[0].onOutgoingCallAccepted),o.isFalsy(t[0].onOutgoingCallRejected)||(this.onOutgoingCallRejected=t[0].onOutgoingCallRejected),o.isFalsy(t[0].onIncomingCallCancelled)||(this.onIncomingCallCancelled=t[0].onIncomingCallCancelled)};e.CallEventListener=a;var c=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];o.isFalsy(t[0].onUserOnline)||(this.onUserOnline=t[0].onUserOnline),o.isFalsy(t[0].onUserOffline)||(this.onUserOffline=t[0].onUserOffline)};e.UserEventListener=c;var u=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];o.isFalsy(t[0].onGroupMemberJoined)||(this.onUserJoined=t[0].onGroupMemberJoined),o.isFalsy(t[0].onGroupMemberLeft)||(this.onUserLeft=t[0].onGroupMemberLeft),o.isFalsy(t[0].onGroupMemberKicked)||(this.onUserKicked=t[0].onGroupMemberKicked),o.isFalsy(t[0].onGroupMemberBanned)||(this.onUserBanned=t[0].onGroupMemberBanned),o.isFalsy(t[0].onGroupMemberUnbanned)||(this.onUserUnbanned=t[0].onGroupMemberUnbanned),o.isFalsy(t[0].onGroupMemberScopeChanged)||(this.onMemberScopeChanged=t[0].onGroupMemberScopeChanged),o.isFalsy(t[0].onMemberAddedToGroup)||(this.onMemberAddedToGroup=t[0].onMemberAddedToGroup)};e.GroupEventListener=u;var l=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];o.isFalsy(t[0].onYouLeft)||(this.onYouLeft=t[0].onYouLeft),o.isFalsy(t[0].onYouJoined)||(this.onYouJoined=t[0].onYouJoined),o.isFalsy(t[0].onUserJoined)||(this.onUserJoined=t[0].onUserJoined),o.isFalsy(t[0].onUserLeft)||(this.onUserLeft=t[0].onUserLeft),o.isFalsy(t[0].onCallEnded)||(this.onCallEnded=t[0].onCallEnded),o.isFalsy(t[0].onError)||(this.onError=t[0].onError)};e.UserCallEventListener=l;var E=function(t,e){this._name=t,this._callback=e},h=function(r){function t(t,e,n,s){var o=r.call(this,t,s)||this;return o._eventListener=e,n&&(o._cursor=n),o}return i(t,r),t}(e.Listener=E);e.MessageListener=h;var p=function(r){function t(t,e,n,s){var o=r.call(this,t,s)||this;return o._eventListener=e,n&&(o._cursor=n),o}return i(t,r),t}(E);e.UserListener=p;var d=function(r){function t(t,e,n,s){var o=r.call(this,t,s)||this;return o._eventListener=e,n&&(o._cursor=n),o}return i(t,r),t}(E);e.GroupListener=d;var C=function(o){function t(t,e,n){var s=o.call(this,"callListner",n)||this;return s._eventListener=t,s}return i(t,o),t}(E);e.UserCallListener=C;var g=function(r){function t(t,e,n,s){var o=r.call(this,t,s)||this;return o._eventListener=e,o}return i(t,r),t}(E);e.CallListener=g},function(t,e,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var s=n(3),c=n(1),u=n(0),o=function(){function t(t){this.store=u.constants.DEFAULT_STORE,c.isFalsy(t)||(this.store=t);try{this.messagesStore=n(11).AsyncStorage}catch(t){c.Logger.error("MessageStore: constructor",{e:t})}}return t.getInstance=function(){return null==t.MessagesStore&&(t.MessagesStore=new t),t.MessagesStore},t.prototype.set=function(t,e){return this.messagesStore.setItem(t,e)},t.prototype.remove=function(t){this.messagesStore.removeItem(t)},t.prototype.get=function(t){return this.messagesStore.getItem(t)},t.prototype.clearStore=function(){var o=this;return new Promise(function(n,e){try{var s=["user","app_settings"];o.messagesStore.getAllKeys().then(function(t){if(0<t.length)for(var e=0;e<t.length;e++)-1!==s.indexOf(t[e])&&o.messagesStore.removeItem(t[e]),e===t.length-1&&n(!0);else n(!0)},function(t){e(t)})}catch(t){e(t)}})},t.prototype.getAllMessages=function(){var n=this,s={};return new Promise(function(t,e){n.messagesStore.iterate(function(t,e,n){e!=u.constants.MSG_VER_POST&&e!=u.constants.MSG_VER_POST&&(s=a({},s,t))}).then(function(){t(s)})})},t.prototype.clear=function(t){},t.prototype.selectStore=function(t){this.store=t},t.prototype.storeMessages=function(t){var n=this;if(s.CometChat.user.getUid()){var o=s.CometChat.user.getUid(),r={},i=0;return this.get(u.constants.MSG_VER_POST).then(function(s){t.map(function(t){var e;if(!c.isFalsy(t)){0==i&&(i=parseInt(t.getId().toString())),i>t.getId()&&(i=parseInt(t.getId().toString())),s<t.getId()&&(s=parseInt(t.getId().toString()));var n=void 0;n=t.getSender()instanceof Object?t.getSender().getUid():t.getSender(),t.getReceiverType()==u.MessageConstatnts.RECEIVER_TYPE.GROUP&&(n=t.getReceiver()),t.getSender()instanceof Object?t.getSender().getUid()==o&&(n=t.getReceiver()):t.getSender()==o&&(n=t.getReceiver()),r[n]||(r[n]={}),r[n]=a({},r[n],((e={})[t.getId()]=t,e))}}),n.get(u.constants.MSG_VER_PRE).then(function(t){(0<i&&i<t||null==t)&&n.set(u.constants.MSG_VER_PRE,i)})&&0<s&&n.set(u.constants.MSG_VER_POST,s),Object.keys(r).map(function(e){n.get(e).then(function(t){null==t&&(t={}),n.set(e,a({},r[e],t))})})}),!0}},t}();e.MessagesStore=o},function(t,e,n){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var i=n(12),u=n(6),l=n(5),E=n(0),a=n(1),h=n(7),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.actionFromJSON=function(t){var e=new this(t[E.MessageConstatnts.KEYS.RECEIVER],t[E.MessageConstatnts.KEYS.TYPE],t[E.MessageConstatnts.KEYS.RECEIVER_TYPE],E.MessageCategory.ACTION),n=t[E.MessageConstatnts.KEYS.DATA];if(e.data=n,e.setAction(n[E.MessageConstatnts.KEYS.ACTION]),n[E.ActionConstatnts.ACTION_KEYS.EXTRAS]){var s=n[E.ActionConstatnts.ACTION_KEYS.EXTRAS];if(s[E.ActionConstatnts.ACTION_KEYS.SCOPE]){var o=s[E.ActionConstatnts.ACTION_KEYS.SCOPE];o[E.ActionConstatnts.ACTION_KEYS.NEW]&&o[E.ActionConstatnts.ACTION_KEYS.OLD]&&(e.setOldScope(o[E.ActionConstatnts.ACTION_KEYS.OLD]),e.setNewScope(o[E.ActionConstatnts.ACTION_KEYS.NEW]))}}n[E.MessageConstatnts.KEYS.METADATA]&&e.setMetadata(n[E.MessageConstatnts.KEYS.METADATA]);var r=n[E.ActionConstatnts.ACTION_KEYS.ENTITIES];if(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY])if(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.USER){var i=new l.User(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(i,r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionBy=i,e.setSender(i)}else{var a=new u.Group("","","");Object.assign(a,r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionBy=a}if(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR])if(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.USER){i=new l.User(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][E.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(i,r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][E.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionFor=i}else{a=new u.Group("","","");Object.assign(a,r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][E.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionFor=a}if(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON])if(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.USER){i=new l.User(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(i,r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionOn=i}else if(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.GROUP){a=new u.Group("","","");Object.assign(a,r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionOn=a}else if(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.MESSAGE){var c=h.MessageController.trasformJSONMessge(r[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][E.ActionConstatnts.ACTION_KEYS.ENTITY]);e.actionOn=c}return e.setMessage(e.getActionMessage(e)),e},e.prototype.getOldScope=function(){return this.oldScope},e.prototype.getNewScope=function(){return this.newScope},e.prototype.setNewScope=function(t){this.newScope=t},e.prototype.setOldScope=function(t){this.oldScope=t},e.prototype.setRawData=function(t){this.rawData=t},e.prototype.getRawData=function(){return this.rawData},e.prototype.setMessage=function(t){this.message=t},e.prototype.getMessage=function(){return this.message},e.prototype.setAction=function(t){this.action=t},e.prototype.getAction=function(){return this.action},e.prototype.getSender=function(){try{return this.getSenderFromData()}catch(t){return this.sender}},e.prototype.setActionBy=function(t){this.actionBy=t},e.prototype.getActionBy=function(){return this.actionBy},e.prototype.setActionOn=function(t){this.actionOn=t},e.prototype.getActionOn=function(){return this.actionOn},e.prototype.setActionFor=function(t){this.actionFor=t},e.prototype.getActionFor=function(){return this.actionFor},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.setMetadata=function(t){this.metadata=t,this.data=r({},this.data,{metadata:t})},e.prototype.getActionMessage=function(t){var e="";switch(t.getType()){case E.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_USER:case E.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP:switch(t.getAction()){case E.ActionConstatnts.ACTION_KEYS.ACTION_CREATED:case E.ActionConstatnts.ACTION_KEYS.ACTION_UPDATED:case E.ActionConstatnts.ACTION_KEYS.ACTION_DELETED:}break;case E.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP_MEMBER:switch(t.getAction()){case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_JOINED:var n=t.getActionBy();e=a.format(E.ActionConstatnts.ActionMessages.ACTION_GROUP_JOINED_MESSAGE,n.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_LEFT:n=t.getActionBy();e=a.format(E.ActionConstatnts.ActionMessages.ACTION_GROUP_LEFT_MESSAGE,n.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_KICKED:n=t.getActionBy();var s=t.getActionOn();e=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_KICKED_MESSAGE,n.getName(),s.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_BANNED:n=t.getActionBy(),s=t.getActionOn();e=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_BANNED_MESSAGE,n.getName(),s.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_UNBANNED:n=t.getActionBy(),s=t.getActionOn();e=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_UNBANNED_MESSAGE,n.getName(),s.getName());break;case E.ActionConstatnts.ACTION_KEYS.ACTION_SCOPE_CHANGED:n=t.getActionBy(),s=t.getActionOn();var o=t.getNewScope();e=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_SCOPE_CHANGED,n.getName(),s.getName(),o);break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_ADDED:n=t.getActionBy(),s=t.getActionOn();e=a.format(E.ActionConstatnts.ActionMessages.ACTION_MEMBER_ADDED_TO_GROUP,n.getName(),s.getName());break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MESSAGE_EDITED:e=a.format(E.ActionConstatnts.ActionMessages.ACTION_MESSAGE_EDITED_MESSAGE,"");break;case E.ActionConstatnts.ACTION_KEYS.TYPE_MESSAGE_DELETED:e=a.format(E.ActionConstatnts.ActionMessages.ACTION_MESSAGE_DELETED_MESSAGE,"")}}return e},e.prototype.getSenderFromData=function(){var t=this.data[E.ActionConstatnts.ACTION_KEYS.ENTITIES];if(t[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY]&&t[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==E.ActionConstatnts.ACTION_ENTITY_TYPE.USER){var e=new l.User(t[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]);return Object.assign(e,t[E.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][E.ActionConstatnts.ACTION_KEYS.ENTITY]),e}},e.TYPE=E.MessageConstatnts.TYPE,e.RECEIVER_TYPE=E.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=E.MessageConstatnts.CATEGORY,e.ACTION_TYPE=E.ActionConstatnts.ACTION_TYPE,e}(i.BaseMessage);e.Action=c},function(t,e,n){"use strict";var s,r=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var o=n(12),a=n(6),c=n(0),u=n(1),l=n(5),E=function(o){function t(t,e,n,s){return u.isFalsy(s)?o.call(this,t,e,n,c.MessageCategory.CALL)||this:o.call(this,t,e,n,s)||this}return r(t,o),t.prototype.getCallInitiator=function(){return this.getCallInitiatedByFromData()},t.prototype.getCallReceiver=function(){return this.getCallReceivedByFromData()},t.prototype.setCallInitiator=function(t){this.callInitiator=t},t.prototype.setCallReceiver=function(t){this.callReceiver=t},t.prototype.getData=function(){return this.data},t.prototype.setData=function(t){this.data=t},t.prototype.getSessionId=function(){return this.sessionId},t.prototype.setSessionId=function(t){this.sessionId=t},t.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},t.prototype.getSender=function(){try{return this.getSenderFromData()}catch(t){return this.sender}},t.prototype.setMetadata=function(t){this.metadata=t,this.data=i({},this.data,{metadata:t})},t.prototype.getAction=function(){return this.action},t.prototype.setAction=function(t){this.action=t},t.prototype.getInitiatedAt=function(){return this.initiatedAt},t.prototype.setInitiatedAt=function(t){this.initiatedAt=t},t.prototype.getJoinedAt=function(){return this.joinedAt},t.prototype.setJoinedAt=function(t){this.joinedAt=t},t.prototype.setRawData=function(t){this.rawData=t},t.prototype.getRawData=function(){return this.rawData},t.prototype.setSender=function(t){this.sender=t},t.prototype.setReceiver=function(t){this.receiver=t},t.callFromJSON=function(t){try{var e=new this(t[c.MessageConstatnts.KEYS.RECEIVER],t[c.MessageConstatnts.KEYS.TYPE],t[c.MessageConstatnts.KEYS.RECEIVER_TYPE],c.MessageCategory.CALL),n=t[c.MessageConstatnts.KEYS.DATA];e.setAction(n[c.MessageConstatnts.KEYS.ACTION]),n[c.MessageConstatnts.KEYS.METADATA]&&e.setMetadata(n[c.MessageConstatnts.KEYS.METADATA]);var s=n[c.ActionConstatnts.ACTION_KEYS.ENTITIES];if(s[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY])s[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY];if(s[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON]){var o=s[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON];if(o[c.CallConstants.CALL_KEYS.CALL_ENTITY]){var r=o[c.CallConstants.CALL_KEYS.CALL_ENTITY];if(r[c.CallConstants.CALL_KEYS.CALL_SESSION_ID]&&(e.sessionId=r[c.CallConstants.CALL_KEYS.CALL_SESSION_ID]),r[c.CallConstants.CALL_KEYS.CALL_STATUS]&&(e.status=r[c.CallConstants.CALL_KEYS.CALL_STATUS]),r[c.CallConstants.CALL_KEYS.CALL_DATA]){var i=r[c.CallConstants.CALL_KEYS.CALL_DATA];if(i[c.CallConstants.CALL_KEYS.CALL_METADATA]&&(e.metadata=i[c.CallConstants.CALL_KEYS.CALL_METADATA]),i[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES])i[c.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES]}r[c.CallConstants.CALL_KEYS.CALL_INITIATED_AT]&&(e.initiatedAt=r[c.CallConstants.CALL_KEYS.CALL_INITIATED_AT]),r[c.CallConstants.CALL_KEYS.CALL_JOINED_AT]&&(e.joinedAt=r[c.CallConstants.CALL_KEYS.CALL_JOINED_AT]),r[c.CallConstants.CALL_KEYS.CALL_LEFT_AT]&&(e.joinedAt=r[c.CallConstants.CALL_KEYS.CALL_LEFT_AT])}}return e}catch(t){u.Logger.error("CallModel: callFromJSON",t)}},t.prototype.getSenderFromData=function(){try{var t=this.getData();if((t=t[c.ActionConstatnts.ACTION_KEYS.ENTITIES])[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.CallConstants.CALL_KEYS.CALL_ENTITY])return new l.User(t[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][c.CallConstants.CALL_KEYS.CALL_ENTITY])}catch(t){u.Logger.error("CallModel:getSenderFromData",t)}},t.prototype.getCallInitiatedByFromData=function(){try{var t=this.getData();if((t=t[c.ActionConstatnts.ACTION_KEYS.ENTITIES])[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.CallConstants.CALL_KEYS.CALL_DATA][c.ActionConstatnts.ACTION_KEYS.ENTITIES][c.CallConstants.CALL_KEYS.CALL_SENDER])return new l.User(t[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.CallConstants.CALL_KEYS.CALL_DATA][c.ActionConstatnts.ACTION_KEYS.ENTITIES][c.CallConstants.CALL_KEYS.CALL_SENDER][c.CallConstants.CALL_KEYS.CALL_ENTITY])}catch(t){u.Logger.error("CallModel:getCallInitiatedByFromData",t)}},t.prototype.getCallReceivedByFromData=function(){try{var t=this.getData();if((t=t[c.ActionConstatnts.ACTION_KEYS.ENTITIES])[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY]){if(t[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY_TYPE]==c.CallConstants.CALL_KEYS.CALL_ENTITY_USER)return new l.User(t[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY]);var e=new a.Group(t[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.GroupConstants.KEYS.GUID],t[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.GroupConstants.KEYS.NAME],t[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY][c.GroupConstants.KEYS.TYPE]);return Object.assign(e,t[c.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][c.CallConstants.CALL_KEYS.CALL_ENTITY])}}catch(t){u.Logger.error("CallModel:getCallReceivedByFromData",t)}},t.TYPE=c.MessageConstatnts.TYPE,t.RECEIVER_TYPE=c.MessageConstatnts.RECEIVER_TYPE,t.CATEGORY=c.MessageConstatnts.CATEGORY,t.ACTION_TYPE=c.ActionConstatnts.ACTION_TYPE,t}(o.BaseMessage);e.Call=E},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),o=n(13),a=n(1),c=n(3),u=n(27),l=n(2),s=n(20),E=n(9),r=function(){function r(){this.TAG="calling Log",this.callListner=void 0,this.CALL_NO_ANSWER_INTERVAL=45e3,this.view=void 0,this.scrollHight=0,this.scrollHight=0}return r.prototype.getCallListner=function(){return this.callListner},r.prototype.setCallListner=function(t){this.callListner=new s.UserCallListener(t)},r.getInstance=function(){try{return null!=this.callController&&null!=this.callController||(this.callController=new r),this.callController}catch(t){a.Logger.error("CallController: getInstance",t)}},r.prototype.getActiveCall=function(){try{return a.isFalsy(this.call)?null:this.call}catch(t){a.Logger.error("CallController: getActiveCall",t)}},r.prototype.initiateCall=function(n){var s=this;return new Promise(function(t,e){try{a.isFalsy(s.call)?null!=n&&null!=n?(s.call=n,s.joinCallMuc(n.getSessionId()),s.startCallTimer(),t(n)):e(new l.CometChatException(i.CALL_ERROR.ERROR_IN_CALLING)):e(new l.CometChatException(i.CALL_ERROR.CALL_ALREADY_INITIATED))}catch(t){e(new l.CometChatException(t))}})},r.prototype.onCallInitialized=function(){},r.prototype.joinCall=function(t){a.Logger.log(this.TAG,t)},r.prototype.cancelCall=function(){a.Logger.log(this.TAG,"calceling the call"),this.stopCallTimer()},r.prototype.rejectCall=function(){a.Logger.log(this.TAG,"rejectCall")},r.prototype.sendBusyResponse=function(){a.Logger.log(this.TAG,"sendBusyResponse")},r.prototype.endCall=function(t){try{this.endCallSession()}catch(t){a.Logger.error("CallController: endCall",t)}},r.prototype.onCallEnded=function(){var e=this;try{if(!a.isFalsy(this.call))if(this.call.getReceiverType()==i.CallConstants.RECEIVER_TYPE_GROUP)a.Logger.info(this.TAG,JSON.stringify(this.call)+"This call ended");else document.getElementsByName("frame").forEach(function(t){e.view.removeChild(t),e.view=void 0}),this.endCallSession()}catch(t){a.Logger.error("CallController:onCallEnded",t)}},r.prototype.unAnswerCall=function(){a.Logger.log(this.TAG,"unAnswerCall")},r.prototype.onCallStarted=function(n){var s=this;return new Promise(function(t,e){try{a.isFalsy(s.call)?null!=n&&null!=n?(s.call=n,s.joinCallMuc(n.getSessionId()),t(n)):e(new l.CometChatException(i.CALL_ERROR.ERROR_IN_CALLING)):e(new l.CometChatException(i.CALL_ERROR.CALL_ALREADY_INITIATED))}catch(t){e(new l.CometChatException(t))}})},r.prototype.endCallSession=function(){try{this.leaveCallMuc(this.call.getSessionId()),this.call=void 0,r.callController=void 0,this.timer&&this.stopCallTimer(),this.view=void 0}catch(t){a.Logger.error("CallController:EndCallSession",{e:t})}},r.prototype.joinCallMuc=function(e){var s=this;a.getAppSettings().then(function(t){o.XMPPConnectionHelper.getInstance().connection.muc.join(a.format(i.XMPP.muc_jid_string,c.CometChat.getAppId(),e,c.CometChat.getAppId(),"call."+t[i.APP_SETTINGS.KEYS.CHAT_HOST]),o.XMPPConnectionHelper.getInstance().connection.jid,null,function(e){try{var n=u.PresenceController.transformPresence(e);o.XMPPConnectionHelper.getInstance().getUsersVCard(n.getUid(),function(t){if(!a.isFalsy(t.getUid()))switch(t.setLastActiveAt(n.getLastActiveAt()),n.getStatus()){case i.PresenceConstatnts.STATUS.ONLINE:t.setStatus(i.PresenceConstatnts.STATUS.ONLINE);break;default:t.setStatus(i.PresenceConstatnts.STATUS.OFFLINE)}switch(u.PresenceController.transformMUCUserPresence(e).getStatus()){case i.PresenceConstatnts.STATUS.JOINED:c.CometChat.user.getUid().toLocaleLowerCase()!=t.getUid().toLocaleLowerCase()&&s.callListner&&(a.isFalsy(s.callListner._eventListener.onUserJoined)||s.callListner._eventListener.onUserJoined(t));break;case i.PresenceConstatnts.STATUS.LEFT:c.CometChat.user.getUid().toLocaleLowerCase()!=t.getUid().toLocaleLowerCase()&&s.callListner&&(a.isFalsy(s.callListner._eventListener.onUserLeft)||s.callListner._eventListener.onUserLeft(t))}})}catch(t){a.Logger.error("CallController: joinCallMuc",t)}return!0})})},r.prototype.leaveCallMuc=function(e){try{a.getAppSettings().then(function(t){o.XMPPConnectionHelper.getInstance().connection.muc.leave(a.format(i.XMPP.muc_jid_string,c.CometChat.getAppId(),e,c.CometChat.getAppId(),"call."+t[i.APP_SETTINGS.KEYS.CHAT_HOST]),o.XMPPConnectionHelper.getInstance().connection.jid)})}catch(t){a.Logger.error("CallController: leaveCallMuc",t)}},r.prototype.startCallTimer=function(){var e=this;try{this.timer=setTimeout(function(){c.CometChat.sendUnansweredResponse(e.call.getSessionId()).then(function(t){e.endCallSession()})},this.CALL_NO_ANSWER_INTERVAL)}catch(t){a.Logger.error("CallController: startCallTimer",t)}},r.prototype.stopCallTimer=function(){try{clearTimeout(this.timer)}catch(t){a.Logger.error("CallController: stopCallTimer",t)}},r.prototype.startCall=function(e,t,n){var s=this;try{if(null==this.view){this.timer&&this.stopCallTimer(),a.isFalsy(t)||this.setCallListner(t);var o=document.createElement("iframe");this.getCallUrl(this.call.getType()).then(function(t){if(o.src=t+"",o.name="frame",o.setAttribute("allow","camera,microphone"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),r.callScreen=o,e&&(s.view=e),c.CometChat.isNative)return s.view.props.prop1(n,t),void(s.view.props.onMessage=function(t){});e.appendChild(o),window.addEventListener("message",function(t){var e;try{e=JSON.parse(t.data)}catch(t){e=void 0}void 0!==e&&"hangup"==e.type&&s.call&&(a.Logger.info(s.TAG,s.callListner),s.callListner&&s.callListner._eventListener.onCallEnded(s.call),c.CometChat.endCall(s.call.getSessionId()).then(function(t){s.callListner&&s.callListner._eventListener.onCallEnded(t),a.Logger.info(s.TAG,{call:t})}).catch(function(t){a.Logger.info(s.TAG,"The Call Was Already Ended")}))})})}}catch(t){a.Logger.error("CallController: startCall",t)}},r.prototype.getCallUrl=function(s){var o=this,r=void 0;return new Promise(function(e,n){try{E.LocalStorage.getInstance().get(i.APP_SETTINGS.APP_SETTINGS).then(function(t){a.isFalsy(t)?a.getAppSettings().then(function(t){r="https://"+t[i.APP_SETTINGS.KEYS.WEBRTC_HOST],r=s==i.CallConstants.CALL_TYPE_AUDIO?r+"/"+o.call.getSessionId()+"#config.startWithVideoMuted=true&config.startWithAudioMuted=false":r+"/"+o.call.getSessionId()+"#config.startWithAudioMuted=false&config.startWithAudioMuted=false",e(r)}):(r="https://"+t[i.APP_SETTINGS.KEYS.WEBRTC_HOST],r=s==i.CallConstants.CALL_TYPE_AUDIO?r+"/"+o.call.getSessionId()+"#config.startWithVideoMuted=true&config.startWithAudioMuted=false":r+"/"+o.call.getSessionId()+"#config.startWithAudioMuted=false&config.startWithAudioMuted=false",e(r))})}catch(t){n(new l.CometChatException(t))}})},r.toggleAudio=function(){try{this.callScreen&&this.callScreen.contentWindow.postMessage({action:"audio"},"*")}catch(t){a.Logger.error("CallController: toggleAudio",t)}},r.toggleVideo=function(){try{this.callScreen&&this.callScreen.contentWindow.postMessage({action:"video"},"*")}catch(t){a.Logger.error("CallController: toggleVideo",t)}},r.leave=function(){try{this.callScreen&&this.callScreen.contentWindow.postMessage({action:"leave"},"*")}catch(t){a.Logger.error("CallController: leave",t)}},r.prototype.destroy=function(){try{a.isFalsy(this.call)||(this.call=void 0),a.isFalsy(this.timer)||(this.timer=void 0),a.isFalsy(this.view)||(this.view=void 0)}catch(t){a.Logger.error("CallController: destroy",t)}},r.callController=void 0,r}();e.CallController=r},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(r,i,a,c){return new(a||(a=Promise))(function(t,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,s)}o((c=c.apply(r,i||[])).next())})},a=this&&this.__generator||function(n,s){var o,r,i,t,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(i=2&e[0]?r.return:e[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,e[1])).done)return i;switch(r=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){a.label=e[1];break}if(6===e[0]&&a.label<i[1]){a.label=i[1],i=e;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(e);break}i[2]&&a.ops.pop(),a.trys.pop();continue}e=s.call(n,a)}catch(t){e=[6,t],r=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};e.__esModule=!0;var r=n(30),c=n(1),u=n(7),s=n(0),o=function(){function t(){}return t.executeInSync=function(o,r){var e=this;return new Promise(function(s,t){return i(e,void 0,void 0,function(){var e,n;return a(this,function(t){switch(t.label){case 0:return e=o,r?(n=setTimeout(function(){s(o)},this.SMALL_TIMEOUT),[4,r(o)]):[3,2];case 1:e=t.sent(),t.label=2;case 2:return clearTimeout(n),s(e),[2]}})})})},t.hookBeforeMessageSent=function(s){return i(this,void 0,void 0,function(){var e,n;return a(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<r.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!t.sent()[r.ExtensionManager.cometChatExtensionList[e].getExtensionId()])return[3,6];if(!r.ExtensionManager.cometChatExtensionList[e].beforeMessageSent)return[3,6];t.label=3;case 3:return t.trys.push([3,5,,6]),[4,this.executeInSync(s,r.ExtensionManager.cometChatExtensionList[e].beforeMessageSent)];case 4:return s=t.sent(),[3,6];case 5:return n=t.sent(),c.Logger.error("Logging error",n),[3,6];case 6:return e++,[3,1];case 7:return[2,s]}})})},t.hookAfterMessageSent=function(s){return i(this,void 0,void 0,function(){var e,n;return a(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<r.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!t.sent()[r.ExtensionManager.cometChatExtensionList[e].getExtensionId()])return[3,6];if(!r.ExtensionManager.cometChatExtensionList[e].afterMessageSent)return[3,6];t.label=3;case 3:return t.trys.push([3,5,,6]),[4,this.executeInSync(s,r.ExtensionManager.cometChatExtensionList[e].afterMessageSent)];case 4:return s=t.sent(),[3,6];case 5:return n=t.sent(),c.Logger.error("Logging error",n),[3,6];case 6:return e++,[3,1];case 7:return[2,s]}})})},t.hookOnInit=function(s,o){return i(this,void 0,void 0,function(){var n=this;return a(this,function(t){return r.ExtensionManager.cometChatExtensionList.map(function(e){return i(n,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.getExtensionList()];case 1:return t.sent()[e.getExtensionId()]?s&&o&&e.onInit?[4,e.onInit(s,o)]:[3,3]:[3,5];case 2:return t.sent(),[3,5];case 3:return s&&e.onInit?[4,e.onInit(s)]:[3,5];case 4:t.sent(),t.label=5;case 5:return[2]}})})}),[2]})})},t.hookOnMessageReceived=function(o){return i(this,void 0,void 0,function(){var e,n,s;return a(this,function(t){switch(t.label){case 0:e=u.MessageController.trasformJSONMessge(o),n=0,t.label=1;case 1:return n<r.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!t.sent()[r.ExtensionManager.cometChatExtensionList[n].getExtensionId()])return[3,6];if(!r.ExtensionManager.cometChatExtensionList[n].onMessageReceived)return[3,6];t.label=3;case 3:return t.trys.push([3,5,,6]),[4,this.executeInSync(e,r.ExtensionManager.cometChatExtensionList[n].onMessageReceived)];case 4:return o=t.sent(),[3,6];case 5:return s=t.sent(),c.Logger.error("Logging error",s),[3,6];case 6:return n++,[3,1];case 7:return[2,o]}})})},t.hookOnLogin=function(s){return i(this,void 0,void 0,function(){var n=this;return a(this,function(t){return r.ExtensionManager.cometChatExtensionList.map(function(e){return i(n,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.getExtensionList()];case 1:return t.sent()[e.getExtensionId()]&&(s&&e.onLogin)?[4,e.onLogin(s)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})}),[2]})})},t.executeInSyncBulk=function(o,r){var e=this;return new Promise(function(s,t){return i(e,void 0,void 0,function(){var e,n;return a(this,function(t){switch(t.label){case 0:return e=o,r?(n=setTimeout(function(){s(o)},this.BIG_TIMEOUT),[4,r(o)]):[3,2];case 1:e=t.sent(),t.label=2;case 2:return clearTimeout(n),s(e),[2]}})})})},t.hookOnMessageListIsFetched=function(s){return i(this,void 0,void 0,function(){var e,n;return a(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<r.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!t.sent()[r.ExtensionManager.cometChatExtensionList[e].getExtensionId()])return[3,6];if(!r.ExtensionManager.cometChatExtensionList[e].onMessageListFetched)return[3,6];t.label=3;case 3:return t.trys.push([3,5,,6]),[4,this.executeInSyncBulk(s,r.ExtensionManager.cometChatExtensionList[e].onMessageListFetched)];case 4:return s=t.sent(),[3,6];case 5:return n=t.sent(),c.Logger.error("Logging error",n),[3,6];case 6:return e++,[3,1];case 7:return[2,s]}})})},t.getExtensionList=function(){return i(this,void 0,void 0,function(){var e=this;return a(this,function(t){switch(t.label){case 0:return c.isFalsy(this.extentionList)?[4,c.getAppSettings()]:[3,2];case 1:t.sent()[s.APP_SETTINGS.KEYS.EXTENSION_LIST].map(function(t){e.extentionList[t.id]=t}),t.label=2;case 2:return[2,this.extentionList]}})})},t.SMALL_TIMEOUT=5e3,t.BIG_TIMEOUT=2e4,t.extentionList={},t}();e.ExtensionController=o},function(t,e,n){"use strict";e.__esModule=!0;var i=n(1),a=n(0),c=n(9),u=n(3),l=n(2),s=function(){function r(){this.baseUrl="https://apiclient-%s.cometchat.io/",this.apiVersion="v2.0",this.apiBaseUrl=this.baseUrl+this.apiVersion+"/",this.adminApiUrl="https://api-%s.cometchat.io/",this.adminApiVersion="v2.0",this.uriEndpoints={authToken:{endpoint:"users/{{uid}}/auth_tokens",method:"POST",data:{uid:"string|max:100"},isAdminApi:!0},appSettings:{endpoint:"settings",method:"GET"},login:{endpoint:"admin/users/auth",method:"POST",data:{uid:"string|max:100"}},logout:{endpoint:"admin/users/auth/{{authToken}}",method:"DELETE"},getMyDetails:{endpoint:"me",method:"GET"},updateMyDetails:{endpoint:"me",method:"PUT"},users:{endpoint:"users",method:"GET"},user:{endpoint:"users/{{uid}}",method:"GET"},blockUsers:{endpoint:"blockedusers",method:"POST"},blockedUsersList:{endpoint:"blockedusers",method:"GET"},unblockUsers:{endpoint:"blockedusers",method:"DELETE"},userLogout:{endpoint:"me",method:"DELETE"},createUser:{endpoint:"users",method:"POST",isAdminApi:!0},updateUser:{endpoint:"users/{{uid}}",method:"PUT",isAdminApi:!0},sendFriendRequests:{endpoint:"user/friends",method:"POST",data:{uids:"array<string|max:100>"}},getFriends:{endpoint:"user/friends",method:"GET"},unfriend:{endpoint:"user/friends/{{uid}}/{{gid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},acceptFriendRequest:{endpoint:"user/friends/{{uid}}/accept",method:"PUT",data:{uids:"array<string|max:100>"}},rejectFriendRequest:{endpoint:"user/friends/{{uid}}/reject",method:"DELETE",data:{uids:"array<string|max:100>"}},createGroup:{endpoint:"groups",method:"POST",data:{guid:"required|string|max:100",name:"required|string|max:100",type:"enum|public,protected,password",password:"filled|string|max:100"}},getGroups:{endpoint:"groups",method:"GET"},getGroup:{endpoint:"groups/{{guid}}",method:"GET"},updateGroup:{endpoint:"groups/{{guid}}",method:"PUT"},deleteGroup:{endpoint:"groups/{{guid}}",method:"DELETE"},addGroupMembers:{endpoint:"groups/{{guid}}/members",method:"POST",data:{uids:"array<string|max:100>"}},getGroupMembers:{endpoint:"groups/{{guid}}/members",method:"GET"},joinGroup:{endpoint:"groups/{{guid}}/members",method:"POST"},leaveGroup:{endpoint:"groups/{{guid}}/members",method:"DELETE"},kickGroupMembers:{endpoint:"groups/{{guid}}/members/{{uid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},changeScopeOfMember:{endpoint:"groups/{{guid}}/members/{{uid}}",method:"PUT",data:{uids:"array<string|max:100>"}},banGroupMember:{endpoint:"groups/{{guid}}/bannedusers/{{uid}}",method:"POST",data:{uids:"array<string|max:100>"}},unbanGroupMember:{endpoint:"groups/{{guid}}/bannedusers/{{uid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},addMemebersToGroup:{endpoint:"groups/{{guid}}/members",method:"PUT"},getBannedGroupMembers:{endpoint:"groups/{{guid}}/bannedusers",method:"GET"},promotemoteGroupMember:{endpoint:"groups/{{guid}}/promote",method:"PUT",data:{uids:"array<string|max:100>"}},demoteGroupMember:{endpoint:"groups/{{guid}}/demote",method:"DELETE",data:{uids:"array<string|max:100>"}},sendMessage:{endpoint:"messages",method:"POST",data:{sender:"array:string:max:100>",isGroupMember:"filled|boolean|bail",data:"required|json"}},getMessages:{endpoint:"messages",method:"GET"},getMessageDetails:{endpoint:"messages/{{messageId}}",method:"GET"},getUserMessages:{endpoint:"users/{{listId}}/messages",method:"GET"},getGroupMessages:{endpoint:"groups/{{listId}}/messages",method:"GET"},getMessage:{endpoint:"user/messages/{{muid}}",method:"GET"},updateMessage:{endpoint:"messages/{{messageId}}",method:"PUT"},deleteMessage:{endpoint:"messages/{{messageId}}",method:"DELETE"},createCallSession:{endpoint:"calls",method:"POST",data:{}},updateCallSession:{endpoint:"calls/{{sessionid}}",method:"put",data:{}},getConversations:{endpoint:"conversations",method:"GET"}}}return r.prototype.getEndpointData=function(o){return new Promise(function(s,e){try{c.LocalStorage.getInstance().get(a.APP_SETTINGS.APP_SETTINGS).then(function(t){if(i.isFalsy(t)){var e={};if((new r).uriEndpoints.hasOwnProperty(o))if((e=(new r).uriEndpoints[o]).hasOwnProperty("isAdminApi")){var n=i.format((new r).adminApiUrl,u.CometChat.appSettings.getRegion())+(new r).adminApiVersion+"/"+e.endpoint;e.endpoint=n}else{n=i.format((new r).baseUrl,u.CometChat.appSettings.getRegion())+(new r).apiVersion+"/"+e.endpoint;e.endpoint=n}s(e)}else{e={};if((new r).uriEndpoints.hasOwnProperty(o))if((e=(new r).uriEndpoints[o]).hasOwnProperty("isAdminApi"))e.endpoint="https://"+t[a.APP_SETTINGS.KEYS.ADMIN_API_HOST]+"/"+(new r).adminApiVersion+"/"+e.endpoint;else{n="https://"+t[a.APP_SETTINGS.KEYS.CLIENT_API_HOST]+"/"+(new r).apiVersion+"/"+e.endpoint;e.endpoint=n}s(e)}},function(t){var e;(new r).uriEndpoints.hasOwnProperty(o)&&((e=(new r).uriEndpoints[o]).hasOwnProperty(["isAdminApi"])?e.endpoint=i.format((new r).adminApiUrl,u.CometChat.appSettings.getRegion())+(new r).adminApiVersion+"/"+e.endpoint:e.endpoint=i.format((new r).baseUrl,u.CometChat.appSettings.getRegion())+(new r).apiVersion+"/"+e.endpoint),s(e)})}catch(t){e(new l.CometChatException(t))}})},r}();e.EndpointFactory=s},function(t,e,n){"use strict";e.__esModule=!0;var s=n(44),o=n(0),r=n(1),i=function(){function t(){}return t.transformPresence=function(t){return t.getAttribute("type")?new s.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),o.PresenceConstatnts.STATUS.OFFLINE,(new Date).getTime()):new s.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),o.PresenceConstatnts.STATUS.ONLINE,(new Date).getTime())},t.transformPresences=function(t){var e=[];return t.map(function(t){try{e.push(new s.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.STATUS),t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.LAST_ACTIVE_AT)))}catch(t){r.Logger.error("PresenceController:transformPresences",t)}}),e},t.transformMUCUserPresence=function(t){return t.getAttribute("type")?new s.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),o.PresenceConstatnts.STATUS.LEFT,(new Date).getTime()):new s.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),o.PresenceConstatnts.STATUS.JOINED,(new Date).getTime())},t.trandformMUCPresence=function(t){0<t.getElementsByTagName("x").length&&this.transformMUCUserPresence(t)},t}();e.PresenceController=i},function(t,e,n){"use strict";e.__esModule=!0;var s=function(){function t(t,e,n){this.receiverId=t,this.receiverType=e,this.metadata=n}return t.prototype.getReceiverType=function(){return this.receiverType},t.prototype.setReceiverType=function(t){this.receiverType=t},t.prototype.getReceiverId=function(){return this.receiverId},t.prototype.setReceiverId=function(t){this.receiverId=t},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t},t.prototype.getSender=function(){return this.sender},t.prototype.setSender=function(t){this.sender=t},t}();e.TypingIndicator=s},function(t,e,n){"use strict";e.__esModule=!0;var s=n(1),o=n(0),r=n(13),i=function(){function t(){}return t.addTypingStarted=function(t){this.TYPING_STARTED_MAP[t]=s.getCurrentTime()},t.removeTypingStarted=function(t){delete this.TYPING_STARTED_MAP[t]},t.getTypingStartedMap=function(t){if(t)return this.TYPING_STARTED_MAP[t]},t.addTypingEnded=function(t){this.TYPING_ENDED_MAP[t]=s.getCurrentTime()},t.removeTypingEnded=function(t){delete this.TYPING_ENDED_MAP[t]},t.getTypingEndedMap=function(t){if(t)return this.TYPING_ENDED_MAP[t]},t.addIncomingTypingStarted=function(t){this.INCOMING_TYPING_STARTED_MAP[t.getReceiverId()]={typingNotification:t,timestamp:s.getCurrentTime()}},t.removeIncomingTypingStarted=function(t){delete this.INCOMING_TYPING_STARTED_MAP[t.getReceiverId()]},t.clearTimer=function(){var n=this;new Promise(function(t,e){Object.keys(n.TYPING_STARTED_MAP).map(function(t){s.getCurrentTime()-n.TYPING_STARTED_MAP[t]>=1e3*o.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&delete n.TYPING_STARTED_MAP[t]})}),new Promise(function(t,e){Object.keys(n.TYPING_ENDED_MAP).map(function(t){s.getCurrentTime()-n.TYPING_ENDED_MAP[t]>=1e3*o.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&delete n.TYPING_ENDED_MAP[t]})}),new Promise(function(t,e){Object.keys(n.INCOMING_TYPING_STARTED_MAP).map(function(t){s.getCurrentTime()-n.INCOMING_TYPING_STARTED_MAP[t][o.TYPING_NOTIFICATION.KEYS.TIMESTAMP]>=1e3*o.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&(r.XMPPConnectionHelper.getInstance().publishTypinStatusNotification(n.INCOMING_TYPING_STARTED_MAP[t][o.TYPING_NOTIFICATION.KEYS.TYPING_NOTIFICATION],o.TYPING_NOTIFICATION.ACTIONS.ENDED),delete n.INCOMING_TYPING_STARTED_MAP[t])})})},t.TYPING_STARTED_MAP={},t.TYPING_ENDED_MAP={},t.INCOMING_TYPING_STARTED_MAP={},t}();e.TypingNotificationController=i},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(r,i,a,c){return new(a||(a=Promise))(function(t,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,s)}o((c=c.apply(r,i||[])).next())})},o=this&&this.__generator||function(n,s){var o,r,i,t,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(i=2&e[0]?r.return:e[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,e[1])).done)return i;switch(r=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){a.label=e[1];break}if(6===e[0]&&a.label<i[1]){a.label=i[1],i=e;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(e);break}i[2]&&a.ops.pop(),a.trys.pop();continue}e=s.call(n,a)}catch(t){e=[6,t],r=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};e.__esModule=!0;var r=n(3),i=function(){function n(){}return n.addCometChatExtension=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return n.cometChatExtensionList.push(e),r.CometChat.user?[4,e.onInit(r.CometChat.getAppId(),r.CometChat.user)]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,e.onInit(r.CometChat.getAppId())];case 3:t.sent(),t.label=4;case 4:return[2]}})})},n.cometChatExtensionList=[],n}();e.ExtensionManager=i},function(t,e,n){"use strict";e.__esModule=!0;var s=n(0),o=function(){function e(t){this.subscriptionType=e.SUBSCRIPTION_TYPE_NONE,this.roles=null,this.region=s.DEFAULT_VALUES.REGION_DEFAULT,this.subscriptionType=t.subscriptionType,this.roles=t.roles,this.region=t.region}return e.prototype.getSubscriptionType=function(){return this.subscriptionType},e.prototype.getRoles=function(){return this.roles},e.prototype.getRegion=function(){return this.region},e.SUBSCRIPTION_TYPE_NONE="NONE",e.SUBSCRIPTION_TYPE_ALL_USERS="ALL_USERS",e.SUBSCRIPTION_TYPE_ROLES="ROLES",e.SUBSCRIPTION_TYPE_FRIENDS="FRIENDS",e.REGION_EU=s.DEFAULT_VALUES.REGION_DEFAULT_EU,e.REGION_US=s.DEFAULT_VALUES.REGION_DEFAULT_US,e.REGION_IN=s.DEFAULT_VALUES.REGION_DEFAULT_IN,e.REGION_PRIVATE=s.DEFAULT_VALUES.REGION_DEFAULT_PRIVATE,e}();e.AppSettings=o;var r=function(){function t(){this.subscriptionType=o.SUBSCRIPTION_TYPE_NONE,this.roles=null,this.region=s.DEFAULT_VALUES.REGION_DEFAULT}return t.prototype.subscribePresenceForAllUsers=function(){return this.subscriptionType=o.SUBSCRIPTION_TYPE_ALL_USERS,this},t.prototype.subscribePresenceForRoles=function(t){return this.subscriptionType=o.SUBSCRIPTION_TYPE_ROLES,this.roles=t,this},t.prototype.subscribePresenceForFriends=function(){return this.subscriptionType=o.SUBSCRIPTION_TYPE_FRIENDS,this},t.prototype.setRegion=function(t){return void 0===t&&(t=s.DEFAULT_VALUES.REGION_DEFAULT),this.region=t,this},t.prototype.build=function(){return new o(this)},t}();e.AppSettingsBuilder=r},function(t,e,n){"use strict";e.__esModule=!0;var s=n(1),o=n(0),r=function(){function t(t){this.store=o.constants.DEFAULT_STORE,s.isFalsy(t)||(this.store=t);try{this.userStore=n(11).AsyncStorage}catch(t){s.Logger.error("UserStore: constructor",{e:t})}}return t.getInstance=function(){return null==t.UserStore&&(t.UserStore=new t),t.UserStore},t.prototype.set=function(t,e){return this.userStore.setItem(t,e)},t.prototype.remove=function(t){this.userStore.removeItem(t)},t.prototype.get=function(t){return this.userStore.getItem(t)},t.prototype.clearStore=function(){var o=this;return new Promise(function(n,e){try{var s=["user","app_settings"];o.userStore.getAllKeys().then(function(t){if(0<t.length)for(var e=0;e<t.length;e++)-1!==s.indexOf(t[e])&&o.userStore.removeItem(t[e]),e===t.length-1&&n(!0);else n(!0)},function(t){e(t)})}catch(t){e(t)}})},t.prototype.clear=function(t){},t.prototype.selectStore=function(t){this.store=t},t.prototype.storeUsers=function(t){var e=this;return t.map(function(t){e.set(t.getUid(),t)}),!0},t.prototype.storeUser=function(t){return this.set(t.getUid(),t),!0},t}();e.UserStore=r},function(t,e,n){"use strict";e.__esModule=!0;var s=n(0),o=function(){function t(t,e){this.joinedAt=0,this.isBanned=0,this.uid=t,e&&(this.scope=e)}return t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){this.name=t},t.prototype.getAvatar=function(){return this.avatar},t.prototype.setAvatar=function(t){this.avatar=t},t.prototype.getLastActiveAt=function(){return this.lastActiveAt},t.prototype.setLastActiveAt=function(t){this.lastActiveAt=t},t.prototype.getLink=function(){return this.link},t.prototype.setLink=function(t){this.link=t},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t},t.prototype.getRole=function(){return this.role},t.prototype.setRole=function(t){this.role=t},t.prototype.getStatus=function(){return this.status},t.prototype.setStatus=function(t){this.status=t},t.prototype.getStatusMessage=function(){return this.statusMessage},t.prototype.setStatusMessage=function(t){this.statusMessage=t},t.prototype.setGuid=function(t){this.guid=t},t.prototype.setUid=function(t){this.uid=t},t.prototype.setScope=function(t){this.scope=t},t.prototype.setJoinedAt=function(t){this.joinedAt=t},t.prototype.setIsBanned=function(t){this.isBanned=t},t.prototype.setUser=function(t){this.user=t},t.prototype.getGuid=function(){return this.guid},t.prototype.getUid=function(){return this.uid},t.prototype.getuser=function(){return this.user},t.prototype.getScope=function(){return this.scope},t.prototype.getJoinedAt=function(){return this.joinedAt},t.prototype.getIsBanned=function(){return this.isBanned},t.GroupMemberScope=s.GroupMemberScope,t}();e.GroupMember=o},function(t,e,n){"use strict";e.__esModule=!0;var i=n(35),a=n(1),s=function(){function t(){}return t.trasformJSONConversation=function(t,e,n,s,o){var r;try{r=new i.Conversation(t,e,n,s,o)}catch(t){a.Logger.error("ConversationController:transformJSONConversation",t)}return r},t}();e.ConversationController=s},function(t,e,n){"use strict";e.__esModule=!0;var r=n(7),i=n(0),a=n(8),c=n(16),s=function(){function t(t,e,n,s,o){this.conversationId=t,this.conversationType=e,void 0!==n&&void 0!==(this.lastMessage=n).id&&(this.lastMessage=r.MessageController.trasformJSONMessge(n)),this.conversationType==i.MessageConstatnts.RECEIVER_TYPE.USER?this.conversationWith=a.UsersController.trasformJSONUser(s):this.conversationWith=c.GroupsController.trasformJSONGroup(s),this.unreadMessageCount=void 0!==o?parseInt(o):0}return t.prototype.setConversationId=function(t){this.conversationId=t},t.prototype.setConversationType=function(t){this.conversationType=t},t.prototype.setLastMessage=function(t){this.lastMessage=t},t.prototype.setConversationWith=function(t){this.conversationWith=t},t.prototype.setUnreadMessageCount=function(t){this.unreadMessageCount=t},t.prototype.getConversationId=function(){return this.conversationId},t.prototype.getConversationType=function(){return this.conversationType},t.prototype.getLastMessage=function(){return this.lastMessage},t.prototype.getConversationWith=function(){return this.conversationWith},t.prototype.getUnreadMessageCount=function(){return this.unreadMessageCount},t}();e.Conversation=s},function(t,e,n){"use strict";e.__esModule=!0;var s=n(1),o=n(0),r=function(){function t(t){this.store=o.constants.DEFAULT_STORE,s.isFalsy(t)||(this.store=t);try{this.settingsStore=n(11).AsyncStorage}catch(t){s.Logger.error("MessageListnerEventMaping: constructor",{e:t})}}return t.getInstance=function(){return null==t.settingsStore&&(t.settingsStore=new t),t.settingsStore},t.prototype.set=function(t,e){return this.settingsStore.setItem(t,e)},t.prototype.remove=function(t){this.settingsStore.removeItem(t)},t.prototype.get=function(t){return this.settingsStore.getItem(t)},t.prototype.clearStore=function(){var s=this;return new Promise(function(e,n){s.settingsStore.getAllKeys().then(function(t){0<t.length&&s.settingsStore.clear(),e(!0)},function(t){n(t)})})},t.prototype.clear=function(t){},t.prototype.selectStore=function(t){this.store=t},t.settingsStore=null,t}();e.MessageListnerMaping=r},function(t,e){function r(t,e){for(var n in t)e[n]=t[n]}function n(t,e){var n=t.prototype;if(Object.create){var s=Object.create(e.prototype);n.__proto__=s}if(!(n instanceof e)){function o(){}o.prototype=e.prototype,r(n,o=new o),t.prototype=n=o}n.constructor!=t&&(n.constructor=t)}var _="http://www.w3.org/1999/xhtml",s={},S=s.ELEMENT_NODE=1,f=s.ATTRIBUTE_NODE=2,T=s.TEXT_NODE=3,m=s.CDATA_SECTION_NODE=4,A=s.ENTITY_REFERENCE_NODE=5,o=s.ENTITY_NODE=6,I=s.PROCESSING_INSTRUCTION_NODE=7,N=s.COMMENT_NODE=8,R=s.DOCUMENT_NODE=9,O=s.DOCUMENT_TYPE_NODE=10,y=s.DOCUMENT_FRAGMENT_NODE=11,i=s.NOTATION_NODE=12,a={},c={},u=(a.INDEX_SIZE_ERR=(c[1]="Index size error",1),a.DOMSTRING_SIZE_ERR=(c[2]="DOMString size error",2),a.HIERARCHY_REQUEST_ERR=(c[3]="Hierarchy request error",3)),l=(a.WRONG_DOCUMENT_ERR=(c[4]="Wrong document",4),a.INVALID_CHARACTER_ERR=(c[5]="Invalid character",5),a.NO_DATA_ALLOWED_ERR=(c[6]="No data allowed",6),a.NO_MODIFICATION_ALLOWED_ERR=(c[7]="No modification allowed",7),a.NOT_FOUND_ERR=(c[8]="Not found",8)),E=(a.NOT_SUPPORTED_ERR=(c[9]="Not supported",9),a.INUSE_ATTRIBUTE_ERR=(c[10]="Attribute in use",10));a.INVALID_STATE_ERR=(c[11]="Invalid state",11),a.SYNTAX_ERR=(c[12]="Syntax error",12),a.INVALID_MODIFICATION_ERR=(c[13]="Invalid modification",13),a.NAMESPACE_ERR=(c[14]="Invalid namespace",14),a.INVALID_ACCESS_ERR=(c[15]="Invalid access",15);function h(t,e){if(e instanceof Error)var n=e;else n=this,Error.call(this,c[t]),this.message=c[t],Error.captureStackTrace&&Error.captureStackTrace(this,h);return n.code=t,e&&(this.message=this.message+": "+e),n}function p(){}function d(t,e){this._node=t,this._refresh=e,C(this)}function C(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var n=t._refresh(t._node);nt(t,"length",n.length),r(n,t),t._inc=e}}function g(){}function M(t,e){for(var n=t.length;n--;)if(t[n]===e)return n}function P(t,e,n,s){if(s?e[M(e,s)]=n:e[e.length++]=n,t){var o=(n.ownerElement=t).ownerDocument;o&&(s&&b(o,t,s),i=t,a=n,(r=o)&&r._inc++,"http://www.w3.org/2000/xmlns/"==a.namespaceURI&&(i._nsMap[a.prefix?a.localName:""]=a.value))}var r,i,a}function v(t,e,n){var s=M(e,n);if(!(0<=s))throw h(l,new Error(t.tagName+"@"+n));for(var o=e.length-1;s<o;)e[s]=e[++s];if(e.length=o,t){var r=t.ownerDocument;r&&(b(r,t,n),n.ownerElement=null)}}function L(t){if(this._features={},t)for(var e in t)this._features=t[e]}function U(){}function D(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function w(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(w(t,e))return!0}while(t=t.nextSibling)}function Y(){}function b(t,e,n,s){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete e._nsMap[n.prefix?n.localName:""]}function G(t,e,n){if(t&&t._inc){t._inc++;var s=e.childNodes;if(n)s[s.length++]=n;else{for(var o=e.firstChild,r=0;o;)o=(s[r++]=o).nextSibling;s.length=r}}}function x(t,e){var n=e.previousSibling,s=e.nextSibling;return n?n.nextSibling=s:t.firstChild=s,s?s.previousSibling=n:t.lastChild=n,G(t.ownerDocument,t),e}function B(t,e,n){var s=e.parentNode;if(s&&s.removeChild(e),e.nodeType===y){var o=e.firstChild;if(null==o)return e;var r=e.lastChild}else o=r=e;var i=n?n.previousSibling:t.lastChild;for(o.previousSibling=i,r.nextSibling=n,i?i.nextSibling=o:t.firstChild=o,null==n?t.lastChild=r:n.previousSibling=r;o.parentNode=t,o!==r&&(o=o.nextSibling););return G(t.ownerDocument||t,t),e.nodeType==y&&(e.firstChild=e.lastChild=null),e}function F(){this._nsMap={}}function K(){}function H(){}function k(){}function J(){}function V(){}function X(){}function j(){}function q(){}function W(){}function $(){}function Q(){}function z(){}function Z(t,e){var n=[],s=9==this.nodeType?this.documentElement:this,o=s.prefix,r=s.namespaceURI;if(r&&null==o&&null==(o=s.lookupPrefix(r)))var i=[{namespace:r,prefix:null}];return et(this,n,t,e,i),n.join("")}function tt(t,e,n){var s=t.prefix||"",o=t.namespaceURI;if(!s&&!o)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===o||"http://www.w3.org/2000/xmlns/"==o)return!1;for(var r=n.length;r--;){var i=n[r];if(i.prefix==s)return i.namespace!=o}return!0}function et(t,e,n,s,o){if(s){if(!(t=s(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case S:o||(o=[]);o.length;var r=t.attributes,i=r.length,a=t.firstChild,c=t.tagName;n=_===t.namespaceURI||n,e.push("<",c);for(var u=0;u<i;u++){"xmlns"==(l=r.item(u)).prefix?o.push({prefix:l.localName,namespace:l.value}):"xmlns"==l.nodeName&&o.push({prefix:"",namespace:l.value})}for(u=0;u<i;u++){var l;if(tt(l=r.item(u),0,o)){var E=l.prefix||"",h=l.namespaceURI,p=E?" xmlns:"+E:" xmlns";e.push(p,'="',h,'"'),o.push({prefix:E,namespace:h})}et(l,e,n,s,o)}if(tt(t,0,o)){E=t.prefix||"",h=t.namespaceURI,p=E?" xmlns:"+E:" xmlns";e.push(p,'="',h,'"'),o.push({prefix:E,namespace:h})}if(a||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(c)){if(e.push(">"),n&&/^script$/i.test(c))for(;a;)a.data?e.push(a.data):et(a,e,n,s,o),a=a.nextSibling;else for(;a;)et(a,e,n,s,o),a=a.nextSibling;e.push("</",c,">")}else e.push("/>");return;case R:case y:for(a=t.firstChild;a;)et(a,e,n,s,o),a=a.nextSibling;return;case f:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,D),'"');case T:return e.push(t.data.replace(/[<&]/g,D));case m:return e.push("<![CDATA[",t.data,"]]>");case N:return e.push("\x3c!--",t.data,"--\x3e");case O:var d=t.publicId,C=t.systemId;if(e.push("<!DOCTYPE ",t.name),d)e.push(' PUBLIC "',d),C&&"."!=C&&e.push('" "',C),e.push('">');else if(C&&"."!=C)e.push(' SYSTEM "',C,'">');else{var g=t.internalSubset;g&&e.push(" [",g,"]"),e.push(">")}return;case I:return e.push("<?",t.target," ",t.data,"?>");case A:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function nt(t,e,n){t[e]=n}h.prototype=Error.prototype,r(a,h),p.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var n=[],s=0;s<this.length;s++)et(this[s],n,t,e);return n.join("")}},d.prototype.item=function(t){return C(this),this[t]},n(d,p),g.prototype={length:0,item:p.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var n=this[e];if(n.nodeName==t)return n}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new h(E);var n=this.getNamedItem(t.nodeName);return P(this._ownerElement,this,t,n),n},setNamedItemNS:function(t){var e,n=t.ownerElement;if(n&&n!=this._ownerElement)throw new h(E);return e=this.getNamedItemNS(t.namespaceURI,t.localName),P(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return v(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var n=this.getNamedItemNS(t,e);return v(this._ownerElement,this,n),n},getNamedItemNS:function(t,e){for(var n=this.length;n--;){var s=this[n];if(s.localName==e&&s.namespaceURI==t)return s}return null}},L.prototype={hasFeature:function(t,e){var n=this._features[t.toLowerCase()];return!(!n||e&&!(e in n))},createDocument:function(t,e,n){var s=new Y;if(s.implementation=this,s.childNodes=new p,(s.doctype=n)&&s.appendChild(n),e){var o=s.createElementNS(t,e);s.appendChild(o)}return s},createDocumentType:function(t,e,n){var s=new X;return s.name=t,s.nodeName=t,s.publicId=e,s.systemId=n,s}},U.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return B(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return x(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function t(e,n,s){var o=new n.constructor;for(var r in n){var i=n[r];"object"!=typeof i&&i!=o[r]&&(o[r]=i)}n.childNodes&&(o.childNodes=new p);o.ownerDocument=e;switch(o.nodeType){case S:var a=n.attributes,c=o.attributes=new g,u=a.length;c._ownerElement=o;for(var l=0;l<u;l++)o.setAttributeNode(t(e,a.item(l),!0));break;case f:s=!0}if(s)for(var E=n.firstChild;E;)o.appendChild(t(e,E,s)),E=E.nextSibling;return o}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==T&&t.nodeType==T?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return 0<this.attributes.length},lookupPrefix:function(t){for(var e=this;e;){var n=e._nsMap;if(n)for(var s in n)if(n[s]==t)return s;e=e.nodeType==f?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var n=e._nsMap;if(n&&t in n)return n[t];e=e.nodeType==f?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},r(s,U),r(s,U.prototype),Y.prototype={nodeName:"#document",nodeType:R,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType!=y)return null==this.documentElement&&t.nodeType==S&&(this.documentElement=t),B(this,t,e),t.ownerDocument=this,t;for(var n=t.firstChild;n;){var s=n.nextSibling;this.insertBefore(n,e),n=s}return t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),x(this,t)},importNode:function(t,e){return function t(e,n,s){var o;switch(n.nodeType){case S:(o=n.cloneNode(!1)).ownerDocument=e;case y:break;case f:s=!0}o||(o=n.cloneNode(!1));o.ownerDocument=e;o.parentNode=null;if(s)for(var r=n.firstChild;r;)o.appendChild(t(e,r,s)),r=r.nextSibling;return o}(this,t,e)},getElementById:function(e){var n=null;return w(this.documentElement,function(t){if(t.nodeType==S&&t.getAttribute("id")==e)return n=t,!0}),n},createElement:function(t){var e=new F;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new p,(e.attributes=new g)._ownerElement=e},createDocumentFragment:function(){var t=new $;return t.ownerDocument=this,t.childNodes=new p,t},createTextNode:function(t){var e=new k;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new J;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new V;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var n=new Q;return n.ownerDocument=this,n.tagName=n.target=t,n.nodeValue=n.data=e,n},createAttribute:function(t){var e=new K;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new W;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var n=new F,s=e.split(":"),o=n.attributes=new g;return n.childNodes=new p,n.ownerDocument=this,n.nodeName=e,n.tagName=e,n.namespaceURI=t,2==s.length?(n.prefix=s[0],n.localName=s[1]):n.localName=e,o._ownerElement=n},createAttributeNS:function(t,e){var n=new K,s=e.split(":");return n.ownerDocument=this,n.nodeName=e,n.name=e,n.namespaceURI=t,n.specified=!0,2==s.length?(n.prefix=s[0],n.localName=s[1]):n.localName=e,n}},n(Y,U),Y.prototype.getElementsByTagName=(F.prototype={nodeType:S,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var n=this.ownerDocument.createAttribute(t);n.value=n.nodeValue=""+e,this.setAttributeNode(n)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===y?this.insertBefore(t,null):function(t,e){var n=e.parentNode;if(n){var s=t.lastChild;n.removeChild(e),s=t.lastChild}return s=t.lastChild,e.parentNode=t,e.previousSibling=s,e.nextSibling=null,s?s.nextSibling=e:t.firstChild=e,t.lastChild=e,G(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);n&&this.removeAttributeNode(n)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);return n&&n.value||""},setAttributeNS:function(t,e,n){var s=this.ownerDocument.createAttributeNS(t,e);s.value=s.nodeValue=""+n,this.setAttributeNode(s)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(s){return new d(this,function(e){var n=[];return w(e,function(t){t===e||t.nodeType!=S||"*"!==s&&t.tagName!=s||n.push(t)}),n})},getElementsByTagNameNS:function(s,o){return new d(this,function(e){var n=[];return w(e,function(t){t===e||t.nodeType!==S||"*"!==s&&t.namespaceURI!==s||"*"!==o&&t.localName!=o||n.push(t)}),n})}}).getElementsByTagName,Y.prototype.getElementsByTagNameNS=F.prototype.getElementsByTagNameNS,n(F,U),K.prototype.nodeType=f,n(K,U),H.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(c[u])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,n){n=this.data.substring(0,t)+n+this.data.substring(t+e),this.nodeValue=this.data=n,this.length=n.length}},n(H,U),k.prototype={nodeName:"#text",nodeType:T,splitText:function(t){var e=this.data,n=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var s=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},n(k,H),J.prototype={nodeName:"#comment",nodeType:N},n(J,H),V.prototype={nodeName:"#cdata-section",nodeType:m},n(V,H),X.prototype.nodeType=O,n(X,U),j.prototype.nodeType=i,n(j,U),q.prototype.nodeType=o,n(q,U),W.prototype.nodeType=A,n(W,U),$.prototype.nodeName="#document-fragment",$.prototype.nodeType=y,n($,U),Q.prototype.nodeType=I,n(Q,U),z.prototype.serializeToString=function(t,e,n){return Z.call(t,e,n)},U.prototype.toString=Z;try{if(Object.defineProperty){Object.defineProperty(d.prototype,"length",{get:function(){return C(this),this.$$length}}),Object.defineProperty(U.prototype,"textContent",{get:function(){return function t(e){switch(e.nodeType){case S:case y:var n=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&n.push(t(e)),e=e.nextSibling;return n.join("");default:return e.nodeValue}}(this)},set:function(t){switch(this.nodeType){case S:case y:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),nt=function(t,e,n){t["$$"+e]=n}}}catch(t){}e.DOMImplementation=L,e.XMLSerializer=z},function(t,e,n){"use strict";e.__esModule=!0;var s=n(3);e.init=function(t){return s.CometChat.getInstance(t)},e.CometChat=s.CometChat},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";e.__esModule=!0;var s=n(26),i=n(2);e.getEndPoint=function(t,r){void 0===t&&(t=""),void 0===r&&(r={});var e=new s.EndpointFactory;return new Promise(function(s,o){try{e.getEndpointData(t).then(function(t){var e=t;if(e){for(var n in r)e.endpoint=e.endpoint.replace("{{"+n+"}}",r[n]);s(e)}else o({error:"Unknown endPoint name."})})}catch(t){o(new i.CometChatException(t))}})}},function(t,d,e){"use strict";var n=this&&this.__awaiter||function(r,i,a,c){return new(a||(a=Promise))(function(t,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,s)}o((c=c.apply(r,i||[])).next())})},C=this&&this.__generator||function(n,s){var o,r,i,t,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(i=2&e[0]?r.return:e[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,e[1])).done)return i;switch(r=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){a.label=e[1];break}if(6===e[0]&&a.label<i[1]){a.label=i[1],i=e;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(e);break}i[2]&&a.ops.pop(),a.trys.pop();continue}e=s.call(n,a)}catch(t){e=[6,t],r=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};d.__esModule=!0;var s=e(14),g=e(10),_=e(0),o=e(1);d.$iq=s.$iq,d.$build=s.$build,d.$msg=s.$msg,d.$pres=s.$pres,d.Strophe=s.Strophe,d.NS=s.Strophe.NS,d.Status=s.Strophe.Status,window.Strophe=d.Strophe,window.$iq=d.$iq,window.$msg=d.$msg,d.Strophe.addConnectionPlugin("chatstates",{init:function(t){this._connection=t,d.Strophe.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates")},statusChanged:function(t){},addActive:function(t){return t.c("active",{xmlns:d.Strophe.NS.CHATSTATES}).up()},_notificationReceived:function(t){var e=t.getElementsByTagName("composing"),n=t.getElementsByTagName("paused");t.getAttribute("from");return 0<e.length&&JSON.stringify(unescape(g.parseHTML(t.getElementsByTagName("body")[0]))),n.length,!0},sendActive:function(t,e,n){this._sendNotification(t,e,"active",n)},sendComposing:function(t,e,n){this._sendNotification(t,e,"composing",n)},sendPaused:function(t,e,n){this._sendNotification(t,e,"paused",n)},sendInactive:function(t,e){this._sendNotification(t,e,"inactive")},sendGone:function(t,e){this._sendNotification(t,e,"gone")},_sendNotification:function(t,e,n,s){e||(e="chat"),o.isFalsy(s)?this._connection.send(d.$msg({to:t,from:this._connection.jid,type:e}).c(n,{xmlns:d.Strophe.NS.CHATSTATES})):this._connection.send(d.$msg({to:t,from:this._connection.jid,type:e}).c("body",JSON.stringify(s)).up().c(n,{xmlns:d.Strophe.NS.CHATSTATES}))}}),d.Strophe.addConnectionPlugin("receipts",{_conn:null,_msgQueue:{},_retries:{},_resendCount:10,_resendTime:9e3,init:function(t){this._conn=t,d.Strophe.addNamespace("RECEIPTS","urn:xmpp:receipts")},statusChanged:function(t){if(t===d.Strophe.Status.CONNECTED||t===d.Strophe.Status.ATTACHED){this._conn.addHandler(this._onRequestReceived.bind(this),d.Strophe.NS.RECEIPTS,"message");var e=this;setTimeout(function(){e.resendQueue()},5e3)}},sendMessage:function(t){var e=this._conn.getUniqaueId();t.tree().setAttribute("id",e);var n=d.Strophe.xmlElement("request",{xmlns:d.Strophe.NS.RECEIPTS});return t.tree().appendChild(n),this._msgQueue[e]=t,this._retries[e]=0,this._conn.send(t),this.resendMessage(e),e},resendMessage:function(t){var e=this;setTimeout(function(){if(e._msgQueue[t]){if(!e._conn.connected)return void e.resendMessage(t);if(e._retries[t]++,e._retries[t]>e._resendCount)return;e._msgQueue[t].tree().setAttribute("from",e._conn.jid),e._conn.send(e._msgQueue[t]),e.resendMessage(t)}},this._resendTime)},addReceiptHandler:function(e,t,n,s){var o=this;this._conn.addHandler(function(t){return o._processReceipt(t),e(t)},d.Strophe.NS.RECEIPTS,"message",t,null,n,s)},_processReceipt:function(p,t){return void 0===t&&(t=0),n(this,void 0,void 0,function(){var e,n,s,o,r,i,a,c,u,l,E,h;return C(this,function(t){e=p.getAttribute(_.DELIVERY_RECEIPTS.ID),n=d.Strophe.getBareJidFromJid(p.getAttribute(_.MessageConstatnts.XMPP_KEYS.FROM)),s=g.getUidFromJid(n),o=_.MessageConstatnts.XMPP_KEYS.TYPE_USER,r=_.MessageConstatnts.RECEIVER_TYPE.USER,i=p.getElementsByTagName("request"),a=p.getElementsByTagName("received");try{c=p.getElementsByTagName("body")[0].innerHTML}catch(t){u=c=void 0}return void 0!==c&&(u=JSON.parse(c).receiverType),p.getAttribute(_.MessageConstatnts.XMPP_KEYS.TYPE)==_.MessageConstatnts.XMPP_KEYS.TYPE_GROUP||void 0!==u&&u==_.MessageConstatnts.RECEIVER_TYPE.GROUP?(r=_.MessageConstatnts.RECEIVER_TYPE.GROUP,n=g.getGroupJidFullGroupJid(p.getAttribute(_.MessageConstatnts.XMPP_KEYS.FROM)),o=_.MessageConstatnts.XMPP_KEYS.TYPE_GROUP,0<n.trim().length&&0<i.length&&(l=d.$msg({to:n,type:o,from:this._conn.jid,id:this._conn.getUniqueId()}),E=d.Strophe.xmlElement("delivered",{type:r,receiverId:s,xmlns:d.Strophe.NS.RECEIPTS,id:e}),l.tree().appendChild(E),this._conn.send(l))):0<i.length&&(l=d.$msg({to:n,type:o,from:this._conn.jid,id:this._conn.getUniqueId()}),E=d.Strophe.xmlElement("delivered",{type:r,receiverId:s,xmlns:d.Strophe.NS.RECEIPTS,id:e}),l.tree().appendChild(E),this._conn.send(l)),0<a.length&&(h=a[0].getAttribute(_.DELIVERY_RECEIPTS.ID))&&(delete this._msgQueue[h],delete this._retries[h]),[2]})})},resendQueue:function(){if(this._conn.connected)for(var t in this._msgQueue)this._msgQueue.hasOwnProperty(t)&&this._conn.send(this._msgQueue[t]);else{var e=this;setTimeout(function(){e.resendQueue()},5e3)}},getUnreceivedMsgs:function(){var t=[];for(var e in this._msgQueue)this._msgQueue.hasOwnProperty(e)&&t.push(this._msgQueue[e]);return t},clearMessages:function(){this._msgQueue={}}})},function(t,e,n){"use strict";e.__esModule=!0;var s=function(){function t(){this.RECEIPT_TYPE={READ_RECEIPT:"read",DELIVERY_RECEIPT:"delivery"},this.receiptType=this.RECEIPT_TYPE.DELIVERY_RECEIPT}return t.prototype.getReceiverType=function(){return this.receiverType},t.prototype.setReceiverType=function(t){this.receiverType=t},t.prototype.getSender=function(){return this.sender},t.prototype.setSender=function(t){this.sender=t},t.prototype.getReceiver=function(){return this.receiver},t.prototype.setReceiver=function(t){this.receiver=t},t.prototype.getTimestamp=function(){return this.timestamp},t.prototype.setTimestamp=function(t){this.timestamp=t},t.prototype.setReadAt=function(t){this.readAt=t},t.prototype.getReadAt=function(){return this.readAt},t.prototype.setDeliveredAt=function(t){this.deliveredAt=t},t.prototype.getDeliveredAt=function(){return this.deliveredAt},t.prototype.getMessageId=function(){return this.messageId},t.prototype.setMessageId=function(t){this.messageId=t},t.prototype.getReceiptType=function(){return this.receiptType},t.prototype.setReceiptType=function(t){void 0===t&&(t=this.RECEIPT_TYPE.DELIVERY_RECEIPT),this.receiptType=t},t}();e.MessageReceipt=s},function(t,e,n){"use strict";e.__esModule=!0;var s=n(0),o=function(){function e(t){t.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.EXTENSION)&&(this.fileEextension=t[s.ATTACHMENTS_CONSTANTS.KEYS.EXTENSION]),t.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.MIME_TYPE)&&(this.fileMimeType=t[s.ATTACHMENTS_CONSTANTS.KEYS.MIME_TYPE]),t.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.NAME)&&(this.fileName=t[s.ATTACHMENTS_CONSTANTS.KEYS.NAME]),t.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.SIZE)&&(this.fileSize=t[s.ATTACHMENTS_CONSTANTS.KEYS.SIZE]),t.hasOwnProperty(s.ATTACHMENTS_CONSTANTS.KEYS.URL)&&(this.fileUrl=t[s.ATTACHMENTS_CONSTANTS.KEYS.URL])}return e.prototype.createFileFromJSON=function(t){return new e(t)},e.prototype.toJSON=function(t){return JSON.stringify(t)},e.prototype.getFileExtension=function(){return this.fileEextension},e.prototype.setFileExtension=function(t){this.fileEextension=t},e.prototype.getFileMimeType=function(){return this.fileMimeType},e.prototype.setFileMimeType=function(t){this.fileMimeType=t},e.prototype.getFileName=function(){return this.fileName},e.prototype.setFileName=function(t){this.fileName=t},e.prototype.getFileSize=function(){return this.fileSize},e.prototype.setFileSize=function(t){this.fileSize=t},e.prototype.getFileUrl=function(){return this.fileUrl},e.prototype.setFileUrl=function(t){this.fileUrl=t},e}();e.Attachment=o},function(t,e,n){"use strict";e.__esModule=!0;var o=n(1),r=n(10),s=function(){function t(t,e,n,s){o.isFalsy(t)||(this.jid=t,this.uid=r.getUidFromJid(t),o.isFalsy(s)||(this.priority=s),o.isFalsy(e)||(this.status=e),o.isFalsy(n)||(this.lastActiveAt=n))}return t.prototype.getUid=function(){return this.uid},t.prototype.setUid=function(t){this.uid=t},t.prototype.getJid=function(){return this.jid},t.prototype.setJid=function(t){this.jid=t},t.prototype.getPriority=function(){return this.priority},t.prototype.setPriority=function(t){this.priority=t},t.prototype.getStatus=function(){return this.status},t.prototype.setStatus=function(t){this.status=t},t.prototype.getLastActiveAt=function(){return this.lastActiveAt},t.prototype.setLastActiveAt=function(t){this.lastActiveAt=t},t.prototype.getStatusMessage=function(){return this.statusMessage},t.prototype.setStatusMessage=function(t){this.statusMessage=t},t}();e.UserPresence=s},function(t,e,n){!function(h){"use strict";var n,u,a={}.hasOwnProperty,o=function(t,e){return function(){return t.apply(e,arguments)}};h.Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(t){return this._connection=t,this._muc_handler=null,h.Strophe.addNamespace("MUC_OWNER",h.Strophe.NS.MUC+"#owner"),h.Strophe.addNamespace("MUC_ADMIN",h.Strophe.NS.MUC+"#admin"),h.Strophe.addNamespace("MUC_USER",h.Strophe.NS.MUC+"#user"),h.Strophe.addNamespace("MUC_ROOMCONF",h.Strophe.NS.MUC+"#roomconfig"),h.Strophe.addNamespace("MUC_REGISTER","jabber:iq:register")},join:function(l,t,e,n,s,o,r,i){var a,c,E;return c=this.test_append_nick(l,t),a=h.$pres({from:this._connection.jid,to:c}).c("x",{xmlns:h.Strophe.NS.MUC}),null!=r&&(a=a.c("history",r).up()),null!=o&&a.cnode(h.Strophe.xmlElement("password",[],o)),null!=i&&a.up().cnode(i),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler((E=this,function(t){var e,n,s,o,r,i,a,c,u;if(!(e=t.getAttribute("from")))return!0;if(i=e.split("/")[0],!E.rooms[i])return!0;if(l=E.rooms[i],n={},"message"===t.nodeName)n=l._message_handlers;else if("presence"===t.nodeName&&0<(u=t.getElementsByTagName("x")).length)for(s=0,r=u.length;s<r;s++)if(a=u[s],(c=a.getAttribute("xmlns"))&&c.match(h.Strophe.NS.MUC)){n=l._presence_handlers;break}for(o in n)(0,n[o])(t,l)||delete n[o];return!0}))),this.rooms.hasOwnProperty(l)||(this.rooms[l]=new u(this,l,t,o),n&&this.rooms[l].addHandler("presence",n),e&&this.rooms[l].addHandler("message",e),s&&this.rooms[l].addHandler("roster",s),this.roomNames.push(l)),this._connection.send(a)},leave:function(t,e,n,s){var o,r,i,a;return o=this.roomNames.indexOf(t),delete this.rooms[t],0<=o&&(this.roomNames.splice(o,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),a=this.test_append_nick(t,e),i=this._connection.getUniqueId(),r=h.$pres({type:"unavailable",id:i,from:this._connection.jid,to:a}),null!=s&&r.c("status",s),null!=n&&this._connection.addHandler(n,null,"presence",null,i),this._connection.send(r),i},message:function(t,e,n,s,o,r){var i,a,c;return c=this.test_append_nick(t,e),o=o||(null!=e?"chat":"groupchat"),r=r||this._connection.getUniqueId(),(i=h.$msg({to:c,from:this._connection.jid,type:o,id:r}).c("body").t(n)).up(),null!=s&&(i.c("html",{xmlns:h.Strophe.NS.XHTML_IM}).c("body",{xmlns:h.Strophe.NS.XHTML}).h(s),0===i.node.childNodes.length?(a=i.node.parentNode,i.up().up(),i.node.removeChild(a)):i.up().up()),i.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(i),r},groupchat:function(t,e,n,s){return this.message(t,null,e,n,void 0,s)},invite:function(t,e,n){var s,o;return o=this._connection.getUniqueId(),s=h.$msg({from:this._connection.jid,to:t,id:o}).c("x",{xmlns:h.Strophe.NS.MUC_USER}).c("invite",{to:e}),null!=n&&s.c("reason",n),this._connection.send(s),o},multipleInvites:function(t,e,n){var s,o,r,i,a;for(i=this._connection.getUniqueId(),o=h.$msg({from:this._connection.jid,to:t,id:i}).c("x",{xmlns:h.Strophe.NS.MUC_USER}),s=0,r=e.length;s<r;s++)a=e[s],o.c("invite",{to:a}),null!=n&&(o.c("reason",n),o.up()),o.up();return this._connection.send(o),i},directInvite:function(t,e,n,s){var o,r,i;return i=this._connection.getUniqueId(),o={xmlns:"jabber:x:conference",jid:t},null!=n&&(o.reason=n),null!=s&&(o.password=s),r=h.$msg({from:this._connection.jid,to:e,id:i}).c("x",o),this._connection.send(r),i},queryOccupants:function(t,e,n){var s,o;return s={xmlns:h.Strophe.NS.DISCO_ITEMS},o=h.$iq({from:this._connection.jid,to:t,type:"get"}).c("query",s),this._connection.sendIQ(o,e,n)},configure:function(t,e,n){var s,o;return s=h.$iq({to:t,type:"get"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}),o=s.tree(),this._connection.sendIQ(o,e,n)},cancelConfigure:function(t){var e,n;return e=h.$iq({to:t,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),n=e.tree(),this._connection.sendIQ(n)},saveConfiguration:function(t,e,n,s){var o,r,i,a,c;if(i=h.$iq({to:t,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}),void 0!==h.Strophe.x&&void 0!==h.Strophe.x.Form&&e instanceof h.Strophe.x.Form)e.type="submit",i.cnode(e.toXML());else for(i.c("x",{xmlns:"jabber:x:data",type:"submit"}),r=0,a=e.length;r<a;r++)o=e[r],i.cnode(o).up();return c=i.tree(),this._connection.sendIQ(c,n,s)},createInstantRoom:function(t,e,n){var s;return s=h.$iq({to:t,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(s.tree(),e,n)},createConfiguredRoom:function(t,e,n,s){var o,r,i;for(o in(r=h.$iq({to:t,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"})).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),e)a.call(e,o)&&(i=e[o],r.c("field",{var:o}).c("value").t(i).up().up());return this._connection.sendIQ(r.tree(),n,s)},setTopic:function(t,e){var n;return n=h.$msg({to:t,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e),this._connection.send(n.tree())},_modifyPrivilege:function(t,e,n,s,o){var r;return r=h.$iq({to:t,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_ADMIN}).cnode(e.node),null!=n&&r.c("reason",n),this._connection.sendIQ(r.tree(),s,o)},modifyRole:function(t,e,n,s,o,r){var i;return i=h.$build("item",{nick:e,role:n}),this._modifyPrivilege(t,i,s,o,r)},kick:function(t,e,n,s,o){return this.modifyRole(t,e,"none",n,s,o)},voice:function(t,e,n,s,o){return this.modifyRole(t,e,"participant",n,s,o)},mute:function(t,e,n,s,o){return this.modifyRole(t,e,"visitor",n,s,o)},op:function(t,e,n,s,o){return this.modifyRole(t,e,"moderator",n,s,o)},deop:function(t,e,n,s,o){return this.modifyRole(t,e,"participant",n,s,o)},modifyAffiliation:function(t,e,n,s,o,r){var i;return i=h.$build("item",{jid:e,affiliation:n}),this._modifyPrivilege(t,i,s,o,r)},ban:function(t,e,n,s,o){return this.modifyAffiliation(t,e,"outcast",n,s,o)},member:function(t,e,n,s,o){return this.modifyAffiliation(t,e,"member",n,s,o)},revoke:function(t,e,n,s,o){return this.modifyAffiliation(t,e,"none",n,s,o)},owner:function(t,e,n,s,o){return this.modifyAffiliation(t,e,"owner",n,s,o)},admin:function(t,e,n,s,o){return this.modifyAffiliation(t,e,"admin",n,s,o)},changeNick:function(t,e){var n,s;return s=this.test_append_nick(t,e),n=h.$pres({from:this._connection.jid,to:s,id:this._connection.getUniqueId()}),this._connection.send(n.tree())},setStatus:function(t,e,n,s){var o,r;return r=this.test_append_nick(t,e),o=h.$pres({from:this._connection.jid,to:r}),null!=n&&o.c("show",n).up(),null!=s&&o.c("status",s),this._connection.send(o.tree())},registrationRequest:function(t,a,e){var n;return n=h.$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:h.Strophe.NS.MUC_REGISTER}),this._connection.sendIQ(n,function(t){var e,n,s,o,r,i;for((n=t.getElementsByTagName("field")).length,o={required:[],optional:[]},r=0,i=n.length;r<i;r++)e=n[r],s={var:e.getAttribute("var"),label:e.getAttribute("label"),type:e.getAttribute("type")},0<e.getElementsByTagName("required").length?o.required.push(s):o.optional.push(s);return a(o)},e)},submitRegistrationForm:function(t,e,n,s){var o,r,i;for(r in(o=h.$iq({to:t,type:"set"}).c("query",{xmlns:h.Strophe.NS.MUC_REGISTER})).c("x",{xmlns:"jabber:x:data",type:"submit"}),o.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up(),e)i=e[r],o.c("field",{var:r}).c("value").t(i).up().up();return this._connection.sendIQ(o,n,s)},listRooms:function(t,e,n){var s;return s=h.$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:h.Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(s,e,n)},test_append_nick:function(t,e){var n,s;return s=h.Strophe.escapeNode(h.Strophe.getNodeFromJid(t)),n=h.Strophe.getDomainFromJid(t),s+"@"+n+(null!=e?"/"+e:"")}}),u=function(){function i(t,e,n,s){this.client=t,this.name=e,this.nick=n,this.password=s,this._roomRosterHandler=o(this._roomRosterHandler,this),this._addOccupant=o(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,this.client.muc&&(this.client=this.client.muc),this.name=h.Strophe.getBareJidFromJid(this.name),this.addHandler("presence",this._roomRosterHandler)}return i.prototype.join=function(t,e,n){return this.client.join(this.name,this.nick,t,e,n,this.password)},i.prototype.leave=function(t,e){return this.client.leave(this.name,this.nick,t,e),delete this.client.rooms[this.name]},i.prototype.message=function(t,e,n,s){return this.client.message(this.name,t,e,n,s)},i.prototype.groupchat=function(t,e){return this.client.groupchat(this.name,t,e)},i.prototype.invite=function(t,e){return this.client.invite(this.name,t,e)},i.prototype.multipleInvites=function(t,e){return this.client.invite(this.name,t,e)},i.prototype.directInvite=function(t,e){return this.client.directInvite(this.name,t,e,this.password)},i.prototype.configure=function(t){return this.client.configure(this.name,t)},i.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},i.prototype.saveConfiguration=function(t){return this.client.saveConfiguration(this.name,t)},i.prototype.queryOccupants=function(t,e){return this.client.queryOccupants(this.name,t,e)},i.prototype.setTopic=function(t){return this.client.setTopic(this.name,t)},i.prototype.modifyRole=function(t,e,n,s,o){return this.client.modifyRole(this.name,t,e,n,s,o)},i.prototype.kick=function(t,e,n,s){return this.client.kick(this.name,t,e,n,s)},i.prototype.voice=function(t,e,n,s){return this.client.voice(this.name,t,e,n,s)},i.prototype.mute=function(t,e,n,s){return this.client.mute(this.name,t,e,n,s)},i.prototype.op=function(t,e,n,s){return this.client.op(this.name,t,e,n,s)},i.prototype.deop=function(t,e,n,s){return this.client.deop(this.name,t,e,n,s)},i.prototype.modifyAffiliation=function(t,e,n,s,o){return this.client.modifyAffiliation(this.name,t,e,n,s,o)},i.prototype.ban=function(t,e,n,s){return this.client.ban(this.name,t,e,n,s)},i.prototype.member=function(t,e,n,s){return this.client.member(this.name,t,e,n,s)},i.prototype.revoke=function(t,e,n,s){return this.client.revoke(this.name,t,e,n,s)},i.prototype.owner=function(t,e,n,s){return this.client.owner(this.name,t,e,n,s)},i.prototype.admin=function(t,e,n,s){return this.client.admin(this.name,t,e,n,s)},i.prototype.changeNick=function(t){return this.nick=t,this.client.changeNick(this.name,nick)},i.prototype.setStatus=function(t,e){return this.client.setStatus(this.name,this.nick,t,e)},i.prototype.addHandler=function(t,e){var n;switch(n=this._handler_ids++,t){case"presence":this._presence_handlers[n]=e;break;case"message":this._message_handlers[n]=e;break;case"roster":this._roster_handlers[n]=e;break;default:return this._handler_ids--,null}return n},i.prototype.removeHandler=function(t){return delete this._presence_handlers[t],delete this._message_handlers[t],delete this._roster_handlers[t]},i.prototype._addOccupant=function(t){var e;return e=new n(t,this),this.roster[e.nick]=e},i.prototype._roomRosterHandler=function(t){var e,n,s,o,r;switch(e=i._parsePresence(t),o=e.nick,s=e.newnick||null,e.type){case"error":return!0;case"unavailable":s&&(e.nick=s,this.roster[o]&&this.roster[s]&&(this.roster[o].update(this.roster[s]),this.roster[s]=this.roster[o]),this.roster[o]&&!this.roster[s]&&(this.roster[s]=this.roster[o].update(e))),delete this.roster[o];break;default:this.roster[o]?this.roster[o].update(e):this._addOccupant(e)}for(n in r=this._roster_handlers)(0,r[n])(this.roster,this)||delete this._roster_handlers[n];return!0},i._parsePresence=function(t){var e,n,s,o,r,i,a,c,u,l;for((s={}).nick=h.Strophe.getResourceFromJid(t.getAttribute("from")),s.type=t.getAttribute("type"),s.states=[],c=t.childNodes,o=0,i=c.length;o<i;o++)switch((e=c[o]).nodeName){case"error":s.errorcode=e.getAttribute("code"),s.error=null!=(u=e.childNodes[0])?u.nodeName:void 0;break;case"status":s.status=e.textContent||null;break;case"show":s.show=e.textContent||null;break;case"x":if(e.getAttribute("xmlns")===h.Strophe.NS.MUC_USER)for(l=e.childNodes,r=0,a=l.length;r<a;r++)switch((n=l[r]).nodeName){case"item":s.affiliation=n.getAttribute("affiliation"),s.role=n.getAttribute("role"),s.jid=n.getAttribute("jid"),s.newnick=n.getAttribute("nick");break;case"status":n.getAttribute("code")&&s.states.push(n.getAttribute("code"))}}return s},i}(),function(){function t(t){this.parse=o(this.parse,this),null!=t&&this.parse(t)}t.prototype.parse=function(t){var e,n,s,o,r,i,a,c,u,l,E,h,p;for(h=t.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],r=0,u=h.length;r<u;r++)switch(s=h[r],n=s.attributes,s.nodeName){case"identity":for(i={},a=0,l=n.length;a<l;a++)e=n[a],i[e.name]=e.textContent;this.identities.push(i);break;case"feature":this.features.push(s.getAttribute("var"));break;case"x":if("FORM_TYPE"===!s.childNodes[0].getAttribute("var")||"hidden"===!s.childNodes[0].getAttribute("type"))break;for(p=s.childNodes,c=0,E=p.length;c<E;c++)(o=p[c]).attributes.type||this.x.push({var:o.getAttribute("var"),label:o.getAttribute("label")||"",value:o.firstChild.textContent||""})}return{identities:this.identities,features:this.features,x:this.x}}}(),n=function(){function t(t,e){this.room=e,this.update=o(this.update,this),this.admin=o(this.admin,this),this.owner=o(this.owner,this),this.revoke=o(this.revoke,this),this.member=o(this.member,this),this.ban=o(this.ban,this),this.modifyAffiliation=o(this.modifyAffiliation,this),this.deop=o(this.deop,this),this.op=o(this.op,this),this.mute=o(this.mute,this),this.voice=o(this.voice,this),this.kick=o(this.kick,this),this.modifyRole=o(this.modifyRole,this),this.update(t)}return t.prototype.modifyRole=function(t,e,n,s){return this.room.modifyRole(this.nick,t,e,n,s)},t.prototype.kick=function(t,e,n){return this.room.kick(this.nick,t,e,n)},t.prototype.voice=function(t,e,n){return this.room.voice(this.nick,t,e,n)},t.prototype.mute=function(t,e,n){return this.room.mute(this.nick,t,e,n)},t.prototype.op=function(t,e,n){return this.room.op(this.nick,t,e,n)},t.prototype.deop=function(t,e,n){return this.room.deop(this.nick,t,e,n)},t.prototype.modifyAffiliation=function(t,e,n,s){return this.room.modifyAffiliation(this.jid,t,e,n,s)},t.prototype.ban=function(t,e,n){return this.room.ban(this.jid,t,e,n)},t.prototype.member=function(t,e,n){return this.room.member(this.jid,t,e,n)},t.prototype.revoke=function(t,e,n){return this.room.revoke(this.jid,t,e,n)},t.prototype.owner=function(t,e,n){return this.room.owner(this.jid,t,e,n)},t.prototype.admin=function(t,e,n){return this.room.admin(this.jid,t,e,n)},t.prototype.update=function(t){return this.nick=t.nick||null,this.affiliation=t.affiliation||null,this.role=t.role||null,this.jid=t.jid||null,this.status=t.status||null,this.show=t.show||null,this},t}()}(n(14))},function(t,e,n){var s,o;s=[n(14)],void 0===(o=function(t){var o,r,i;return o=t.Strophe,t.$build,r=t.$iq,t.$msg,t.$pres,i=function(t,e,n){var s=r(e?{type:t,to:e}:{type:t});return s.c("vCard",{xmlns:o.NS.VCARD}),n&&s.cnode(n),s},o.addConnectionPlugin("vcard",{_connection:null,init:function(t){return this._connection=t,o.addNamespace("VCARD","vcard-temp")},get:function(t,e,n){var s=i("get",e);return this._connection.sendIQ(s,t,n)},set:function(t,e,n,s){var o=i("set",n,e);return this._connection.sendIQ(o,t,s)}}),t}.apply(e,s))||(t.exports=o)},function(t,e,n){var s,o;s=[n(14)],void 0===(o=function(t){var i,a;return i=t.Strophe,t.$build,a=t.$iq,t.$msg,t.$pres,i.addConnectionPlugin("ping",{_c:null,init:function(t){this._c=t,i.addNamespace("PING","urn:xmpp:ping")},ping:function(t,e,n,s){var o=this._c.getUniqueId("ping"),r=a({type:"get",to:t,id:o}).c("ping",{xmlns:i.NS.PING});this._c.sendIQ(r,e,n,s)},pong:function(t){var e=t.getAttribute("from"),n=t.getAttribute("id"),s=a({type:"result",to:e,id:n});this._c.sendIQ(s)},addPingHandler:function(t){return this._c.addHandler(t,i.NS.PING,"iq","get")}}),t}.apply(e,s))||(t.exports=o)},function(t,e,n){"use strict";e.__esModule=!0;var s=n(5),o=n(0),r=n(10),i=function(){function t(){}return t.transformVCard=function(t){var e={};return e[o.UserConstants.NAME]=unescape(r.parseHTML(t.getElementsByTagName(o.UserConstants.NAME)[0])),e[o.UserConstants.UID]=unescape(r.parseHTML(t.getElementsByTagName(o.UserConstants.UID)[0])),e[o.UserConstants.AVATAR]=unescape(r.parseHTML(t.getElementsByTagName(o.UserConstants.AVATAR)[0])),e[o.UserConstants.LINK]=unescape(r.parseHTML(t.getElementsByTagName(o.UserConstants.LINK)[0])),e[o.UserConstants.STATUS]=unescape(r.parseHTML(t.getElementsByTagName(o.UserConstants.STATUS)[0])),e[o.UserConstants.LAST_ACTIVE_AT]=unescape(r.parseHTML(t.getElementsByTagName(o.UserConstants.LAST_ACTIVE_AT)[0])),e[o.UserConstants.ROLE]=unescape(r.parseHTML(t.getElementsByTagName(o.UserConstants.ROLE)[0])),e[o.UserConstants.USER_NAME]=unescape(r.parseHTML(t.getElementsByTagName(o.UserConstants.USER_NAME)[0])),new s.User(e)},t}();e.VCardController=i},function(t,e,n){"use strict";e.__esModule=!0;var s=n(1),o=n(0),r=n(2),i=function(){function t(t){this.store=o.constants.DEFAULT_STORE,s.isFalsy(t)||(this.store=t);try{this.keyStore=n(11).AsyncStorage}catch(t){s.Logger.error("KeyStore: constructor",{e:t})}}return t.getInstance=function(){return null==t.KeyStore&&(t.KeyStore=new t),t.KeyStore},t.prototype.set=function(t,e){return this.keyStore.setItem(t,e)},t.prototype.remove=function(t){this.keyStore.removeItem(t)},t.prototype.get=function(t){var s=this;return new Promise(function(n,e){try{s.keyStore.getItem(t).then(function(e){try{n(JSON.parse(e))}catch(t){n(e)}},function(t){e(t)})}catch(t){e(new r.CometChatException(t))}})},t.prototype.clearStore=function(){var o=this;return new Promise(function(n,e){try{var s=["user","app_settings"];o.keyStore.getAllKeys().then(function(t){if(0<t.length)for(var e=0;e<t.length;e++)-1!==s.indexOf(t[e])&&o.keyStore.removeItem(t[e]),e===t.length-1&&n(!0);else n(!0)},function(t){e(t)})}catch(t){e(t)}})},t}();e.KeyStore=i},function(t,e,n){"use strict";e.__esModule=!0;var o=n(4),s=n(1),r=n(2),i=n(16),a=n(0),c=function(){function t(t){this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.hasJoined=0,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},s.isFalsy(t)||(s.isFalsy(t.limit)||(this.limit=t.limit),s.isFalsy(t.searchKeyword)||(this.searchKeyword=t.searchKeyword),s.isFalsy(t.hasJoined)||(this.hasJoined=1))}return t.prototype.validateGroupBuilder=function(){if(void 0===this.limit)return new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.COMPULSORY),"SET_LIMIT","SET_LIMIT","setLimit() method")));if(isNaN(this.limit))return new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","group limit")));if(this.limit>a.DEFAULT_VALUES.GROUPS_MAX_LIMIT)return new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT","group limit",a.DEFAULT_VALUES.GROUPS_MAX_LIMIT)));if(this.limit<a.DEFAULT_VALUES.ZERO)return new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","group limit")));if(void 0!==this.searchKeyword){if(typeof this.searchKeyword!==a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword")));if(s.isFalsy(this.searchKeyword.trim()))return new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword")));this.searchKeyword=this.searchKeyword.trim()}},t.prototype.fetchPrevious=function(){var s=this;return new Promise(function(e,n){try{0==s.next_page&&e([]);var t=s.validateGroupBuilder();return t instanceof r.CometChatException?void n(t):o.makeApiCall("groups",{},s.getPreData()).then(function(t){if(t.meta&&(s.total_pages=t.meta.pagination.total_pages),0<t.data.length){s.pagination=t.meta.pagination;var n=[];t.data.map(function(t,e){n.push(i.GroupsController.trasformJSONGroup(t))}),e(n)}e([])},function(t){n(new r.CometChatException(t.error))})}catch(t){n(new r.CometChatException(t))}})},t.prototype.fetchNext=function(){var s=this;return new Promise(function(e,n){try{var t=s.validateGroupBuilder();if(t instanceof r.CometChatException)return void n(t);o.makeApiCall("getGroups",{},s.getNextData()).then(function(t){if(t.meta&&(s.total_pages=t.meta.pagination.total_pages),0<t.data.length){s.pagination=t.meta.pagination;var n=[];t.data.map(function(t,e){n.push(i.GroupsController.trasformJSONGroup(t))}),e(n)}e([])},function(t){n(new r.CometChatException(t.error))})}catch(t){n(new r.CometChatException(t))}})},t.prototype.getNextData=function(){var t={};if(t.per_page=this.limit,s.isFalsy(this.searchKeyword)||(t.searchKey=this.searchKeyword),s.isFalsy(this.hasJoined)||(t.hasJoined=1),1==this.current_page)t.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return t.page=this.next_page,t;t.page=this.next_page++}return t},t.prototype.getPreData=function(){var t={};return t.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(t.page=--this.next_page),t},t.MAX_LIMIT=100,t.DEFAULT_LIMIT=30,t}();e.GroupsRequest=c;var u=function(){function t(){}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setSearchKeyword=function(t){return this.searchKeyword=t,this},t.prototype.joinedOnly=function(t){return this.hasJoined=t,this},t.prototype.build=function(){return new c(this)},t}();e.GroupsRequestBuilder=u},function(t,e,n){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var r=n(4),i=n(1),a=n(9),c=n(2),u=n(52),l=n(0),E=function(){function t(t){this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.isOutCastReq=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},this.store=a.LocalStorage.getInstance(),i.isFalsy(t)||(this.limit=t.limit,this.guid=t.guid,i.isFalsy(t.searchKeyword)||(this.searchKeyword=t.searchKeyword),t instanceof p&&(this.isOutCastReq=t.isOutCastReq))}return t.prototype.validateGroupMembersBuilder=function(){if(void 0===this.limit)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.COMPULSORY),"SET_LIMIT","SET_LIMIT","setLimit() method")));if(isNaN(this.limit))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","group member limit")));if(this.limit>l.DEFAULT_VALUES.USERS_MAX_LIMIT)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT","group member limit",l.DEFAULT_VALUES.USERS_MAX_LIMIT)));if(this.limit<l.DEFAULT_VALUES.ZERO)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","group member limit")));if(void 0!==this.searchKeyword){if(typeof this.searchKeyword!==l.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword")));if(i.isFalsy(this.searchKeyword.trim()))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword")));this.searchKeyword=this.searchKeyword.trim()}if(void 0!==this.guid){if(typeof this.guid!==l.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","guid")));if(i.isFalsy(this.guid))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(l.GENERAL_ERROR.INVALID),"GUID","GUID","guid")))}},t.prototype.fetchPrevious=function(){var s=this;return new Promise(function(n,e){try{0==s.next_page&&n([]);var t=s.validateGroupMembersBuilder();return t instanceof c.CometChatException?void e(t):r.makeApiCall(s.isOutCastReq?"getBannedGroupMembers":"getGroupMembers",{guid:s.guid},s.getPreData()).then(function(t){if(t.meta&&(s.total_pages=t.meta.pagination.total_pages),0<t.data.length){s.pagination=t.meta.pagination;var e=[];t.data.map(function(t){t.guid=s.guid,e.push(u.GroupMembersController.trasformJSONGroupMember(t))}),n(e)}n([])},function(t){e(new c.CometChatException(t.error))})}catch(t){e(new c.CometChatException(t))}})},t.prototype.fetchNext=function(){var s=this;return new Promise(function(n,e){try{var t=s.validateGroupMembersBuilder();if(t instanceof c.CometChatException)return void e(t);r.makeApiCall(s.isOutCastReq?"getBannedGroupMembers":"getGroupMembers",{guid:s.guid},s.getNextData()).then(function(t){if(t.meta&&(s.total_pages=t.meta.pagination.total_pages),0<t.data.length){s.pagination=t.meta.pagination;var e=[];t.data.map(function(t){t.guid=s.guid,e.push(u.GroupMembersController.trasformJSONGroupMember(t))}),n(e)}else n([])},function(t){e(new c.CometChatException(t.error))})}catch(t){e(new c.CometChatException(t))}})},t.prototype.getNextData=function(){var t={};if(t.per_page=this.limit,i.isFalsy(this.searchKeyword)||(t.searchKey=this.searchKeyword),1==this.current_page)t.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return t.page=this.next_page,t;t.page=this.next_page++}return t},t.prototype.getPreData=function(){var t={};return t.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(t.page=--this.next_page),t},t.MAX_LIMIT=2,t.DEFAULT_LIMIT=1,t}();e.GroupMembersRequest=E;var h=function(){function t(t){this.guid=t}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setSearchKeyword=function(t){return this.searchKeyword=t,this},t.prototype.build=function(){return new E(this)},t}(),p=function(n){function t(t){var e=n.call(this,t)||this;return e.isOutCastReq=!0,e}return o(t,n),t.prototype.build=function(){return new E(this)},t}(e.GroupMembersRequestBuilder=h);e.GroupOutCastMembersRequestBuilder=p},function(t,e,n){"use strict";e.__esModule=!0;var s=n(33),o=n(0),r=n(1),i=function(){function t(){}return t.trasformJSONGroupMember=function(e){var t;try{return t=new s.GroupMember(e[o.GroupMemersConstans.KEYS.UID]),Object.assign(t,e),t}catch(t){return r.Logger.error("GroupMembersController:trasformJSONGroupMember",{e:t,groupMember:e}),e}},t}();e.GroupMembersController=i},function(t,e,n){"use strict";e.__esModule=!0;var r=n(4),i=n(1),a=n(8),c=n(2),s=n(32),u=n(0),l=n(3),o=function(){function o(t){this.next_page=1,this.current_page=1,this.total_pages=-1,this.hideBlockedUsers=!1,this.friendsOnly=!1,this.fetchingInProgress=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},o.userStore=s.UserStore.getInstance(),i.isFalsy(t)||(this.limit=t.limit,i.isFalsy(t.searchKeyword)||(this.searchKeyword=t.searchKeyword),i.isFalsy(t.status)||(t.status==o.USER_STATUS.ONLINE?this.status=u.PresenceConstatnts.STATUS.AVAILABLE:this.status=t.status),i.isFalsy(t.shouldHideBlockedUsers)||(this.hideBlockedUsers=t.shouldHideBlockedUsers),i.isFalsy(t.showFriendsOnly)||(this.friendsOnly=t.showFriendsOnly),i.isFalsy(t.role)||(this.role=t.role))}return o.prototype.validateUserBuilder=function(){if(void 0===this.limit)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.COMPULSORY),"SET_LIMIT","SET_LIMIT","setLimit() method")));if(isNaN(this.limit))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","user limit")));if(this.limit>u.DEFAULT_VALUES.USERS_MAX_LIMIT)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT","user limit",u.DEFAULT_VALUES.USERS_MAX_LIMIT)));if(this.limit<u.DEFAULT_VALUES.ZERO)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","user limit")));if(void 0!==this.searchKeyword){if(typeof this.searchKeyword!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword")));if(i.isFalsy(this.searchKeyword.trim()))return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword")));this.searchKeyword=this.searchKeyword.trim()}if(this.status){if(typeof this.status!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.MUST_BE_A_STRING),"SET_STATUS","SET_STATUS","status")));if("available"!=this.status.toLowerCase()&&"offline"!=this.status.toLowerCase())return new c.CometChatException(u.UserErrors.INVALID_STATUS)}if(void 0!==this.hideBlockedUsers){if(typeof this.hideBlockedUsers!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.MUST_BE_A_BOOLEAN),"HIDE_BLOCKED_USERS","HIDE_BLOCKED_USERS","hideBlockedUsers")));1==this.hideBlockedUsers?this.hideBlockedUsers=!0:this.hideBlockedUsers=!1}if(void 0!==this.friendsOnly){if(typeof this.friendsOnly!==u.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return new c.CometChatException(JSON.parse(i.format(JSON.stringify(u.GENERAL_ERROR.MUST_BE_A_BOOLEAN),"FRIENDS_ONLY","FRIENDS_ONLY","friendsOnly")));1==this.friendsOnly?this.friendsOnly=!0:this.friendsOnly=!1}},o.prototype.fetchPrevious=function(){var s=this;return this.fetchingInProgress=!0,new Promise(function(e,n){try{0==s.next_page&&(e([]),s.fetchingInProgress=!1);var t=s.validateUserBuilder();if(t instanceof c.CometChatException)return void n(t);if(!s.fetchingInProgress)return r.makeApiCall("users",{},s.getPreData()).then(function(t){if(t.meta&&(s.total_pages=t.meta.pagination.total_pages),0<t.data.length){s.pagination=t.meta.pagination;var n=[];t.data.map(function(t,e){n.push(a.UsersController.trasformJSONUser(t))}),o.userStore.storeUsers(n),e(n),s.fetchingInProgress=!1}e([]),s.fetchingInProgress=!1},function(t){n(new c.CometChatException(t.error)),s.fetchingInProgress=!1});e([])}catch(t){s.fetchingInProgress=!1,n(new c.CometChatException(t))}})},o.prototype.fetchNext=function(){var o=this;return new Promise(function(s,e){try{if(o.fetchingInProgress)o.fetchingInProgress=!1,s([]);else{o.fetchingInProgress=!0;var t=o.validateUserBuilder();if(t instanceof c.CometChatException)return void e(t);r.makeApiCall("users",{},o.getNextData()).then(function(t){if(t.meta&&(o.total_pages=t.meta.pagination.total_pages),0<t.data.length){o.pagination=t.meta.pagination;var e=[],n=[];t.data.map(function(t){e.push(a.UsersController.trasformJSONUser(t)),n.push(i.format(u.XMPP.username_string,l.CometChat.getAppId(),t[u.UserConstants.UID]))}),s(e)}else s([]);o.fetchingInProgress=!1},function(t){o.fetchingInProgress=!1,e(new c.CometChatException(t.error))})}}catch(t){o.fetchingInProgress=!1,e(new c.CometChatException(t))}})},o.prototype.getNextData=function(){var t={};if(t.per_page=this.limit,i.isFalsy(this.searchKeyword)||(t.searchKey=this.searchKeyword),i.isFalsy(this.status)||(t.status=this.status),i.isFalsy(this.hideBlockedUsers)||(t.hideBlockedUsers=1),i.isFalsy(this.role)||(t.role=this.role),i.isFalsy(this.friendsOnly)||(t.friendsOnly=1),1==this.current_page)t.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return t.page=this.next_page,t;t.page=this.next_page++}return t},o.prototype.getPreData=function(){var t={};return t.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(t.page=--this.next_page),t},o.USER_STATUS={ONLINE:u.PresenceConstatnts.STATUS.ONLINE,OFFLINE:u.PresenceConstatnts.STATUS.OFFLINE},o}();e.UsersRequest=o;var E=function(){function t(){this.shouldHideBlockedUsers=!1}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setStatus=function(t){return this.status=t,this},t.prototype.setSearchKeyword=function(t){return this.searchKeyword=t,this},t.prototype.hideBlockedUsers=function(t){return this.shouldHideBlockedUsers=t,this},t.prototype.setRole=function(t){return this.role=t,this},t.prototype.friendsOnly=function(t){return this.showFriendsOnly=t,this},t.prototype.build=function(){return new o(this)},t}();e.UsersRequestBuilder=E},function(t,e,n){"use strict";e.__esModule=!0;var o=n(4),s=n(1),r=n(2),i=n(34),a=n(0),c=function(){function t(t){this.limit=100,this.next_page=1,this.current_page=1,this.total_pages=-1,this.fetchingInProgress=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},s.isFalsy(t)||(this.limit=t.limit,s.isFalsy(t.conversationType)||(this.conversationType=t.conversationType))}return t.prototype.validateConversationBuilder=function(){return void 0===this.limit?new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.COMPULSORY),"SET_LIMIT","SET_LIMIT","setLimit() method"))):isNaN(this.limit)?new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","conversation limit"))):this.limit>a.DEFAULT_VALUES.CONVERSATION_MAX_LIMIT?new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT","conversation limit",a.DEFAULT_VALUES.CONVERSATION_MAX_LIMIT))):this.limit<a.DEFAULT_VALUES.ZERO?new r.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","conversation limit"))):void 0},t.prototype.fetchNext=function(){var s=this;return new Promise(function(n,e){try{if(s.fetchingInProgress)s.fetchingInProgress=!1,n([]);else{s.fetchingInProgress=!0;var t=s.validateConversationBuilder();if(t instanceof r.CometChatException)return void e(t);o.makeApiCall("getConversations",{},s.getNextData()).then(function(t){if(t.meta&&(s.total_pages=t.meta.pagination.total_pages),0<t.data.length){s.pagination=t.meta.pagination;var e=[];t.data.map(function(t){e.push(i.ConversationController.trasformJSONConversation(t.conversationId,t.conversationType,t.lastMessage,t.conversationWith,t.unreadMessageCount))}),n(e)}else n([]);s.fetchingInProgress=!1},function(t){s.fetchingInProgress=!1,e(new r.CometChatException(t.error))})}}catch(t){s.fetchingInProgress=!1,e(new r.CometChatException(t))}})},t.prototype.getNextData=function(){var t={};if(t.per_page=this.limit,s.isFalsy(this.conversationType)||(t.conversationType=this.conversationType),1==this.current_page)t.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return t.page=this.next_page,t;t.page=this.next_page++}return t},t}();e.ConversationsRequest=c;var u=function(){function t(){}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setConversationType=function(t){return this.conversationType=t,this},t.prototype.build=function(){return new c(this)},t}();e.ConversationsRequestBuilder=u},function(t,e,n){"use strict";e.__esModule=!0;var s=function(){function t(t){this.sessionID=t.sessionID,this.defaultLayout=t.defaultLayout,this.ShowEndCallButton=t.ShowEndCallButton,this.ShowSwitchCameraButton=t.ShowSwitchCameraButton,this.ShowMuteAudioButton=t.ShowMuteAudioButton,this.ShowPauseVideoButton=t.ShowPauseVideoButton,this.ShowAudioModeButton=t.ShowAudioModeButton,this.isAudioOnly=t.isAudioOnly,this.listener=t.listener}return t.prototype.getSessionId=function(){return this.sessionID},t.prototype.isDefaultLayout=function(){return!!this.defaultLayout},t.prototype.isEndCallButtonDisable=function(){return!this.ShowEndCallButton},t.prototype.isSwitchCameraButtonDisable=function(){return!this.ShowSwitchCameraButton},t.prototype.isMuteAudioButtonDisable=function(){return!this.ShowMuteAudioButton},t.prototype.isPauseVideoButtonDisable=function(){return!this.ShowPauseVideoButton},t.prototype.isAudioModeButtonDisable=function(){return!this.ShowAudioModeButton},t.prototype.isAudioOnlyCall=function(){return!!this.isAudioOnly},t.prototype.getCallEventListener=function(){return this.listener},t}();e.CallSettings=s;var o=function(){function t(){this.defaultLayout=!0,this.ShowEndCallButton=!0,this.ShowSwitchCameraButton=!0,this.ShowMuteAudioButton=!0,this.ShowPauseVideoButton=!0,this.ShowAudioModeButton=!0,this.isAudioOnly=!1}return t.prototype.setSessionID=function(t){return this.sessionID=t,this},t.prototype.enableDefaultLayout=function(t){return this.defaultLayout=t,this},t.prototype.showEndCallButton=function(t){return this.ShowEndCallButton=t,this},t.prototype.showSwitchCameraButton=function(t){return this.ShowSwitchCameraButton=t,this},t.prototype.showMuteAudioButton=function(t){return this.ShowMuteAudioButton=t,this},t.prototype.showPauseVideoButton=function(t){return this.ShowPauseVideoButton=t,this},t.prototype.showAudioModeButton=function(t){return this.ShowAudioModeButton=t,this},t.prototype.setIsAudioOnlyCall=function(t){return this.isAudioOnly=t,this},t.prototype.setCallEventListener=function(t){return this.listener=t,this},t.prototype.build=function(){return new s(this)},t}();e.CallSettingsBuilder=o},function(t,e,n){"use strict";var s=this&&this.__awaiter||function(r,i,a,c){return new(a||(a=Promise))(function(t,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,s)}o((c=c.apply(r,i||[])).next())})},a=this&&this.__generator||function(n,s){var o,r,i,t,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(i=2&e[0]?r.return:e[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,e[1])).done)return i;switch(r=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,r=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){a.label=e[1];break}if(6===e[0]&&a.label<i[1]){a.label=i[1],i=e;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(e);break}i[2]&&a.ops.pop(),a.trys.pop();continue}e=s.call(n,a)}catch(t){e=[6,t],r=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};e.__esModule=!0;var p=n(2),d=n(4),C=n(7),g=n(1),o=n(21),_=n(0),c=n(15),S=n(3),f=n(13),T=n(10),m=n(36),u=n(25),r=function(){function t(t){this.limit=_.DEFAULT_VALUES.MSGS_LIMIT,this.timestamp=0,this.id=_.DEFAULT_VALUES.DEFAULT_MSG_ID,this.messageStore=o.MessagesStore.getInstance(),this.endpointName="getUserMessages",this.listId="",this.totalPages=0,this.unread=!1,this.inProgress=!1,this.hideMessagesFromBlockedUsers=!1,this.updatedAt=0,this.onlyUpdates=0,this.paginationMeta={},this.limit=t.limit,this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,this.uid=t.uid,this.uid&&(this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.UID]=this.uid),this.guid=t.guid,this.timestamp=t.timestamp,this.timestamp&&(this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.SENT_AT]=this.timestamp),this.id=t.id,this.id!=_.DEFAULT_VALUES.DEFAULT_MSG_ID&&(this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.ID]=this.id),this.hideMessagesFromBlockedUsers=t.HideMessagesFromBlockedUsers,this.hideMessagesFromBlockedUsers&&(this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.HIDE_MESSAGES_FROM_BLOCKED_USER]=this.hideMessagesFromBlockedUsers),this.unread=t.unread,this.unread&&(this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.UNREAD]=this.unread),t.searchKey&&(this.searchKey=t.searchKey,this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.SEARCH_KEY]=this.searchKey),t.onlyUpdate&&(this.onlyUpdates=t.onlyUpdate,this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.ONLY_UPDATES]=this.onlyUpdates),t.updatedAt&&(this.updatedAt=t.updatedAt,this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.UPDATED_AT]=this.updatedAt),t.category&&(this.category=t.category,this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.CATEGORY]=this.category),t.type&&(this.type=t.type,this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.TYPE]=this.type)}return t.prototype.fetchNext=function(){var t=this;return new Promise(function(r,i){return s(t,void 0,void 0,function(){var e,n,s,o;return a(this,function(t){switch(t.label){case 0:if(t.trys.push([0,6,,7]),this.inProgress)return this.inProgress=!1,i(new p.CometChatException(c.MESSAGES_REQUEST_ERRORS.REQUEST_IN_PROGRESS_ERROR)),[2];if(this.inProgress=!0,this.onlyUpdates){if(0==this.updatedAt)return this.inProgress=!1,i(new p.CometChatException(c.MESSAGES_REQUEST_ERRORS.NOT_ENOUGH_PARAMS)),[2]}else if(0==this.timestamp&&0==this.id&&0==this.updatedAt)return this.inProgress=!1,i(new p.CometChatException(c.MESSAGES_REQUEST_ERRORS.NOT_ENOUGH_PARAMS)),[2];this.affix=_.MessageConstatnts.PAGINATION.AFFIX.APPEND,this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,this.currentMethod=_.MessageConstatnts.PAGINATION.AFFIX.APPEND,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,this.makeAPICall()];case 2:return e=t.sent(),[4,u.ExtensionController.hookOnMessageListIsFetched(e)];case 3:return n=t.sent(),r(n),this.inProgress=!1,[3,5];case 4:return s=t.sent(),this.inProgress=!1,i(new p.CometChatException(s)),[3,5];case 5:return[3,7];case 6:return o=t.sent(),this.inProgress=!1,i(new p.CometChatException(o)),[3,7];case 7:return[2]}})})})},t.prototype.fetchPrevious=function(){var t=this;return new Promise(function(r,i){return s(t,void 0,void 0,function(){var e,n,s,o;return a(this,function(t){switch(t.label){case 0:if(t.trys.push([0,6,,7]),this.inProgress)return i(new p.CometChatException(c.MESSAGES_REQUEST_ERRORS.REQUEST_IN_PROGRESS_ERROR)),this.inProgress=!1,[2];if(this.inProgress=!0,this.onlyUpdates&&0==this.updatedAt)return this.inProgress=!1,i(new p.CometChatException(c.MESSAGES_REQUEST_ERRORS.NOT_ENOUGH_PARAMS)),[2];this.affix=_.MessageConstatnts.PAGINATION.AFFIX.PREPEND,this.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,this.currentMethod=_.MessageConstatnts.PAGINATION.AFFIX.PREPEND,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,this.makeAPICall()];case 2:return e=t.sent(),[4,u.ExtensionController.hookOnMessageListIsFetched(e)];case 3:return n=t.sent(),r(n),this.inProgress=!1,[3,5];case 4:return s=t.sent(),this.inProgress=!1,i(new p.CometChatException(s)),[3,5];case 5:return[3,7];case 6:return o=t.sent(),this.inProgress=!1,i(new p.CometChatException(o)),[3,7];case 7:return[2]}})})})},t.prototype.makeAPICall=function(){var h=this;return new Promise(function(a,e){try{var t=h.uid;if(void 0!==t){if(typeof t!==_.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_STRING),"UID","UID","uid"))));if(g.isFalsy(t.trim()))return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.INVALID),"UID","UID","uid"))));h.uid=t.trim()}var n=h.guid;if(void 0!==n){if(typeof n!==_.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_STRING),"GUID","GUID","guid"))));if(g.isFalsy(n.trim()))return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.INVALID),"GUID","GUID","guid"))));h.guid=n.trim()}var s=h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.PER_PAGE];if(void 0===s)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.COMPULSORY),"SET_LIMIT","SET_LIMIT","setLimit() method"))));if(isNaN(s))return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","message limit"))));if(s>_.DEFAULT_VALUES.MSGS_MAX_LIMIT)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT","message limit",_.DEFAULT_VALUES.MSGS_MAX_LIMIT))));if(s<_.DEFAULT_VALUES.ZERO)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","message limit"))));var o=h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.SEARCH_KEY];if(void 0!==o){if(typeof o!==_.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword"))));if(g.isFalsy(o.trim()))return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword"))));h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.SEARCH_KEY]=o.trim()}var c=h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.ID];if(void 0!==c){if(isNaN(c))return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_NUMBER),"MESSAGE_ID","MESSAGE_ID","messsage id"))));if(c<_.DEFAULT_VALUES.ZERO)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.INVALID),"MESSAGE_ID","MESSAGE_ID","messsage id"))))}var r=h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.SENT_AT];if(void 0!==r){if(isNaN(r))return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_NUMBER),"TIMESTAMP","TIMESTAMP","timestamp"))));if(r<_.DEFAULT_VALUES.ZERO)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.INVALID),"TIMESTAMP","TIMESTAMP","timestamp"))))}var i=h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.HIDE_MESSAGES_FROM_BLOCKED_USER];if(void 0!==i){if(typeof i!==_.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_BOOLEAN),"HIDE_MESSAGES_FROM_BLOCKED_USERS","HIDE_MESSAGES_FROM_BLOCKED_USERS","Hide Messages From Blocked Users"))));h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.HIDE_MESSAGES_FROM_BLOCKED_USER]=1==i?1:0}var u=h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.UNREAD];if(void 0!==u){if(typeof u!==_.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.BOOLEAN)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_BOOLEAN),"UNREAD","UNREAD","unread"))));h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.UNREAD]=1==u?1:0}var l=h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.CATEGORY];if(void 0!==l){if(typeof l!==_.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_STRING),"SET_CATEGORY","SET_CATEGORY","category"))));if(g.isFalsy(l.trim()))return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.INVALID),"SET_CATEGORY","SET_CATEGORY","category"))));h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.CATEGORY]=l.trim()}var E=h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.TYPE];if(void 0!==E){if(typeof E!==_.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.MUST_BE_A_STRING),"SET_TYPE","SET_TYPE","type"))));if(g.isFalsy(E.trim()))return void e(new p.CometChatException(JSON.parse(g.format(JSON.stringify(_.GENERAL_ERROR.INVALID),"SET_TYPE","SET_TYPE","type"))));h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.TYPE]=E.trim()}if(h.createEndpoint(),h.totalPages)if(1!=h.totalPages);else if(h.lastAffix==h.affix)return void a([]);d.makeApiCall(h.endpointName,{listId:h.listId},h.paginationMeta).then(function(t){var n=[];if(t[_.ResponseConstants.RESPONSE_KEYS.KEY_META][_.ResponseConstants.RESPONSE_KEYS.KEY_CURSOR].hasOwnProperty(_.MessageConstatnts.PAGINATION.KEYS.ID)&&0==h.id&&(h.id=t.meta.cursor[_.MessageConstatnts.PAGINATION.KEYS.ID]),t[_.ResponseConstants.RESPONSE_KEYS.KEY_META][_.ResponseConstants.RESPONSE_KEYS.KEY_CURSOR].hasOwnProperty(_.MessageConstatnts.PAGINATION.KEYS.SENT_AT)&&0==h.timestamp&&(h.timestamp=t.meta.cursor[_.MessageConstatnts.PAGINATION.KEYS.SENT_AT]),t.meta.pagination.hasOwnProperty("total_pages")&&(h.totalPages=t.meta.pagination.total_pages),t.meta.cursor.hasOwnProperty("affix")&&(h.lastAffix=t.meta.cursor.affix),t.data[0]){0<h.id&&(h.id=t.data[0].id),0<h.timestamp&&(h.timestamp=t.data[0].sentAt);var u=t.data[t.data.length-1];if(u.sender.toLowerCase()!=T.getUidFromJid(f.XMPPConnectionHelper.getInstance().connection.jid).toLowerCase()&&(void 0!==h.guid||void 0!==h.uid)&&void 0!==u){var s=u.receiverType;if(s==_.MessageConstatnts.RECEIVER_TYPE.USER){var o=u.receiver,r=u.id,e=u.sender;T.getJidFromUid(e).then(function(t){var e=$msg({to:t,from:f.XMPPConnectionHelper.getInstance().connection.jid,id:f.XMPPConnectionHelper.getInstance().connection.getUniqueId(),type:_.MessageConstatnts.XMPP_KEYS.TYPE_USER}),n=Strophe.xmlElement("delivered",{type:s,receiverId:o,xmlns:"urn:xmpp:receipts",id:"["+S.CometChat.getAppId()+"]"+r});e.tree().appendChild(n),f.XMPPConnectionHelper.getInstance().connection.send(e)})}else{var i=u.receiver;c=u.id,T.getGroupJidFromGUID(i).then(function(t){var e=$msg({to:t,from:f.XMPPConnectionHelper.getInstance().connection.jid,id:f.XMPPConnectionHelper.getInstance().connection.getUniqueId(),type:_.MessageConstatnts.XMPP_KEYS.TYPE_GROUP}),n=Strophe.xmlElement("delivered",{type:s,receiverId:i,xmlns:"urn:xmpp:receipts",id:"["+S.CometChat.getAppId()+"]"+c});e.tree().appendChild(n),f.XMPPConnectionHelper.getInstance().connection.send(e)})}}t.data.map(function(e){if(e.sender.toLowerCase()!=T.getUidFromJid(f.XMPPConnectionHelper.getInstance().connection.jid).toLowerCase()&&(void 0===h.guid&&void 0===h.uid))if(e.receiverType==_.MessageConstatnts.RECEIVER_TYPE.USER){if(g.isFalsy(e.deliveredAt)){var s=u.receiver,o=u.id,t=u.sender,r=_.MessageConstatnts.XMPP_KEYS.TYPE_USER;T.getJidFromUid(t).then(function(t){var e=$msg({to:t,from:f.XMPPConnectionHelper.getInstance().connection.jid,id:f.XMPPConnectionHelper.getInstance().connection.getUniqueId(),type:r}),n=Strophe.xmlElement("delivered",{type:r,receiverId:s,xmlns:"urn:xmpp:receipts",id:"["+S.CometChat.getAppId()+"]"+o});e.tree().appendChild(n),f.XMPPConnectionHelper.getInstance().connection.send(e)})}}else if(g.isFalsy(e.myReceipt)){var i=e.receiver,a=u.id,c=_.MessageConstatnts.XMPP_KEYS.TYPE_GROUP;T.getGroupJidFromGUID(i).then(function(t){var e=$msg({to:t,from:f.XMPPConnectionHelper.getInstance().connection.jid,id:f.XMPPConnectionHelper.getInstance().connection.getUniqueId(),type:c}),n=Strophe.xmlElement("delivered",{type:c,receiverId:i,xmlns:"urn:xmpp:receipts",id:"["+S.CometChat.getAppId()+"]"+a});e.tree().appendChild(n),f.XMPPConnectionHelper.getInstance().connection.send(e)})}m.MessageListnerMaping.getInstance().get("all").then(function(t){e.id>t&&m.MessageListnerMaping.getInstance().set("all",e.id)},function(t){m.MessageListnerMaping.getInstance().set("all",e.id)}),h.affix==_.MessageConstatnts.PAGINATION.AFFIX.APPEND?(h.id<e.id&&0<h.id&&(h.id=e.id),h.timestamp<e.sentAt&&0<h.timestamp&&(h.timestamp=e.sentAt),h.updatedAt<e.updatedAt&&0<h.updatedAt&&(h.updatedAt=e.updatedAt)):(h.id>e.id&&(h.id=e.id),h.timestamp>e.sentAt&&(h.timestamp=e.sentAt),h.updatedAt>e.updatedAt&&(h.updatedAt=e.updatedAt)),h.id&&(h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.ID]=h.id),h.timestamp&&(h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.SENT_AT]=h.timestamp),h.updatedAt&&(h.paginationMeta[_.MessageConstatnts.PAGINATION.KEYS.UPDATED_AT]=h.updatedAt),n.push(C.MessageController.trasformJSONMessge(e))})}else n=[];a(n)},function(t){e(new p.CometChatException(t.error))})}catch(t){e(new p.CometChatException(t))}})},t.prototype.createEndpoint=function(){(g.isFalsy(this.guid)||g.isFalsy(this.uid))&&g.isFalsy(this.guid)?(g.isFalsy(this.uid)?this.endpointName="getMessages":this.endpointName="getUserMessages",this.listId=this.uid):(this.endpointName="getGroupMessages",this.listId=this.guid)},t.prototype.makeData=function(){var t={};t[_.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,t[_.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,(g.isFalsy(this.guid)||g.isFalsy(this.uid))&&g.isFalsy(this.guid)&&g.isFalsy(this.uid)},t.prototype.getFilteredPreviousDataByReceiverId=function(e){return s(this,void 0,void 0,function(){var n,s=this;return a(this,function(t){switch(t.label){case 0:switch(n=[],e){case"user":return[3,1];case"group":return[3,3];case"both":return[3,5]}return[3,7];case 1:return[4,o.MessagesStore.getInstance().get(this.uid).then(function(e){Object.keys(e).filter(function(t){return parseInt(t)>s.id}).map(function(t){n=n.concat([e[t]])})})];case 2:return t.sent(),[3,9];case 3:return[4,o.MessagesStore.getInstance().get(this.guid).then(function(e){Object.keys(e).filter(function(t){return parseInt(t)>s.id}).map(function(t){n=n.concat([e[t]])})})];case 4:t.sent(),t.label=5;case 5:return[4,o.MessagesStore.getInstance().get(this.guid).then(function(e){Object.keys(e).filter(function(t){return parseInt(t)>s.id}).filter(function(t){return e[t].sender.uid==s.uid}).map(function(t){n=n.concat([e[t]])})})];case 6:return t.sent(),[3,9];case 7:return[4,o.MessagesStore.getInstance().getAllMessages().then(function(e){Object.keys(e).filter(function(t){return parseInt(t)>s.id}).map(function(t){n=n.concat([e[t]])})})];case 8:return t.sent(),[3,9];case 9:return[2,n]}})})},t.prototype.getFilteredNextDataByReceiverId=function(e){return s(this,void 0,void 0,function(){var n,s=this;return a(this,function(t){switch(t.label){case 0:switch(n=[],e){case"user":return[3,1];case"group":return[3,3];case"both":return[3,5]}return[3,7];case 1:return[4,o.MessagesStore.getInstance().get(this.uid).then(function(e){Object.keys(e).filter(function(t){return parseInt(t)>s.id}).map(function(t){n=n.concat([e[t]])})})];case 2:return t.sent(),[3,9];case 3:return[4,o.MessagesStore.getInstance().get(this.guid).then(function(e){Object.keys(e).filter(function(t){return parseInt(t)>s.id}).map(function(t){n=n.concat([e[t]])})})];case 4:t.sent(),t.label=5;case 5:return[4,o.MessagesStore.getInstance().get(this.guid).then(function(e){Object.keys(e).filter(function(t){return parseInt(t)>s.id}).filter(function(t){return e[t].sender.uid==s.uid}).map(function(t){n=n.concat([e[t]])})})];case 6:return t.sent(),[3,9];case 7:return[4,o.MessagesStore.getInstance().getAllMessages().then(function(e){Object.keys(e).filter(function(t){return parseInt(t)>s.id}).map(function(t){n=n.concat([e[t]])})})];case 8:return t.sent(),[3,9];case 9:return[2,n]}})})},t}();e.DefaultMessagesRequest=r;var i=function(){function t(){this.maxLimit=_.DEFAULT_VALUES.MSGS_MAX_LIMIT,this.timestamp=0,this.id=_.DEFAULT_VALUES.DEFAULT_MSG_ID,this.unread=!1,this.HideMessagesFromBlockedUsers=!1,this.onlyUpdate=0}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setGUID=function(t){return this.guid=t,this},t.prototype.setUID=function(t){return this.uid=t,this},t.prototype.setTimestamp=function(t){return void 0===t&&(t=g.getCurrentTime()),this.timestamp=t,this},t.prototype.setMessageId=function(t){return void 0===t&&(t=_.DEFAULT_VALUES.DEFAULT_MSG_ID),this.id=t,this},t.prototype.setUnread=function(t){return void 0===t&&(t=!1),this.unread=t,this},t.prototype.hideMessagesFromBlockedUsers=function(t){return void 0===t&&(t=!1),this.HideMessagesFromBlockedUsers=t,this},t.prototype.setSearchKeyword=function(t){return this.searchKey=t,this},t.prototype.setUpdatedAfter=function(t){return this.updatedAt=t,this},t.prototype.updatesOnly=function(t){return t&&(this.onlyUpdate=1),this},t.prototype.setCategory=function(t){return this.category=t,this},t.prototype.setType=function(t){return this.type=t,this},t.prototype.build=function(){return new r(this)},t}();e.DefaultMessagesRequestBuilder=i},function(t,e,n){"use strict";e.__esModule=!0;var s=function(t){};e.CometChatExtension=s},function(t,e,n){"use strict";e.__esModule=!0;var o=n(4),s=n(1),r=n(8),i=n(2),a=n(0),c=function(){function t(t){this.next_page=1,this.current_page=1,this.total_pages=-1,this.fetchingInProgress=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},s.isFalsy(t)||(this.limit=t.limit,s.isFalsy(t.searchKeyword)||(this.searchKeyword=t.searchKeyword),s.isFalsy(t.direction)||(this.direction=t.direction))}return t.prototype.validateBlockedUsersBuilder=function(){if(void 0===this.limit)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.COMPULSORY),"SET_LIMIT","SET_LIMIT","setLimit() method")));if(isNaN(this.limit))return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_NUMBER),"SET_LIMIT","SET_LIMIT","user limit")));if(this.limit>a.DEFAULT_VALUES.USERS_MAX_LIMIT)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.LIMIT_EXCEEDED),"SET_LIMIT","SET_LIMIT","user limit",a.DEFAULT_VALUES.USERS_MAX_LIMIT)));if(this.limit<a.DEFAULT_VALUES.ZERO)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_POSITIVE_NUMBER),"SET_LIMIT","SET_LIMIT","user limit")));if(void 0!==this.searchKeyword){if(typeof this.searchKeyword!==a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_STRING),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword")));if(s.isFalsy(this.searchKeyword.trim()))return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.INVALID),"SET_SEARCH_KEYWORD","SET_SEARCH_KEYWORD","search keyword")));this.searchKeyword=this.searchKeyword.trim()}if(void 0!==this.direction){if(typeof this.direction!==a.COMMON_UTILITY_CONSTANTS.TYPE_CONSTANTS.STRING)return new i.CometChatException(JSON.parse(s.format(JSON.stringify(a.GENERAL_ERROR.MUST_BE_A_STRING),"SET_DIRECTION","SET_DIRECTION","set direction")));if(this.direction!=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.BOTH&&this.direction!=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.BLOCKED_BY_ME&&this.direction!=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.HAS_BLOCKED_ME)return new i.CometChatException(a.UserErrors.INVALID_DIRECTION)}},t.prototype.fetchPrevious=function(){var s=this;return this.fetchingInProgress=!0,new Promise(function(e,n){try{0==s.next_page&&(e([]),s.fetchingInProgress=!1);var t=s.validateBlockedUsersBuilder();if(t instanceof i.CometChatException)return void n(t);if(!s.fetchingInProgress)return o.makeApiCall("blockedUsersList",{},s.getPreData()).then(function(t){if(t.meta&&(s.total_pages=t.meta.pagination.total_pages),0<t.data.length){s.pagination=t.meta.pagination;var n=[];t.data.map(function(t,e){n.push(r.UsersController.trasformJSONUser(t))}),e(n),s.fetchingInProgress=!1}e([]),s.fetchingInProgress=!1},function(t){n(new i.CometChatException(t.error)),s.fetchingInProgress=!1});e([])}catch(t){s.fetchingInProgress=!1,n(new i.CometChatException(t))}})},t.prototype.fetchNext=function(){var s=this;return new Promise(function(n,e){try{if(s.fetchingInProgress)s.fetchingInProgress=!1,n([]);else{s.fetchingInProgress=!0;var t=s.validateBlockedUsersBuilder();if(t instanceof i.CometChatException)return void e(t);o.makeApiCall("blockedUsersList",{},s.getNextData()).then(function(t){if(t.meta&&(s.total_pages=t.meta.pagination.total_pages),0<t.data.length){s.pagination=t.meta.pagination;var e=[];t.data.map(function(t){e.push(r.UsersController.trasformJSONUser(t))}),n(e)}else n([]);s.fetchingInProgress=!1},function(t){s.fetchingInProgress=!1,e(new i.CometChatException(t.error))})}}catch(t){s.fetchingInProgress=!1,e(new i.CometChatException(t))}})},t.prototype.getNextData=function(){var t={};if(t.per_page=this.limit,s.isFalsy(this.direction)||(t.direction=this.direction),s.isFalsy(this.searchKeyword)||(t.searchKey=this.searchKeyword),1==this.current_page)t.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return t.page=this.next_page,t;t.page=this.next_page++}return t},t.prototype.getPreData=function(){var t={};return t.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(t.page=--this.next_page),t},t.MAX_LIMIT=2,t.DEFAULT_LIMIT=1,t.directions=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS,t}();e.BlockedUsersRequest=c;var u=function(){function t(){}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setSearchKeyword=function(t){return this.searchKeyword=t,this},t.prototype.setDirection=function(t){return this.direction=t,this},t.prototype.blockedByMe=function(){return this.direction=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.BLOCKED_BY_ME,this},t.prototype.hasBlockedMe=function(){return this.direction=a.BlockedUsersConstants.REQUEST_KEYS.DIRECTIONS.HAS_BLOCKED_ME,this},t.prototype.build=function(){return new c(this)},t}();e.BlockedUsersRequestBuilder=u},function(t,e,n){"use strict";e.__esModule=!0;var E=n(7),h=n(0),p=n(8),d=n(16),C=n(34),s=n(3),o=n(2),r=n(1),i=function(){function t(){}return t.processMessage=function(t){try{return E.MessageController.trasformJSONMessge(t)}catch(t){r.Logger.error("CometChatHelper: processMessage",t)}},t.getConversationFromMessage=function(l){return new Promise(function(c,u){try{s.CometChat.getLoggedinUser().then(function(t){if(null!==t){var e=E.MessageController.trasformJSONMessge(l),n=e.receiverType,s=e.conversationId,o=void 0,r=E.MessageController.trasformJSONMessge(l);if(n==h.MessageConstatnts.RECEIVER_TYPE.USER){var i=p.UsersController.trasformJSONUser(e[h.MessageConstatnts.KEYS.SENDER]);o=i.getUid()==t.getUid()?p.UsersController.trasformJSONUser(e[h.MessageConstatnts.KEYS.RECEIVER]):i}else o=d.GroupsController.trasformJSONGroup(e[h.MessageConstatnts.KEYS.RECEIVER]);var a=C.ConversationController.trasformJSONConversation(s,n,r,o,0);c(a)}else u(h.UserErrors.USER_NOT_LOGGED_IN)},function(t){u(new o.CometChatException(t.error))})}catch(t){u(new o.CometChatException(t))}})},t}();e.CometChatHelper=i},function(t,e,n){var i=n(61),a=n(62);t.exports=function(t,e,n){var s=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var r=0;r<16;++r)e[s+r]=o[r];return e||a(o)}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var s=new Uint8Array(16);t.exports=function(){return n(s),s}}else{var o=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),o[e]=t>>>((3&e)<<3)&255;return o}}},function(t,e){for(var o=[],n=0;n<256;++n)o[n]=(n+256).toString(16).substr(1);t.exports=function(t,e){var n=e||0,s=o;return[s[t[n++]],s[t[n++]],s[t[n++]],s[t[n++]],"-",s[t[n++]],s[t[n++]],"-",s[t[n++]],s[t[n++]],"-",s[t[n++]],s[t[n++]],"-",s[t[n++]],s[t[n++]],s[t[n++]],s[t[n++]],s[t[n++]],s[t[n++]]].join("")}},function(t,e,n){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var c,u,l,E,h,r=n(64),p=n(3),i=n(65),d=n(66),C=n(67),g=n(0),_=n(24),S=!1,f=!1,T=!1,a=function(a){function t(t){var e=a.call(this,t)||this;c=t.callsettings,t.onEndCall;var n=p.CometChat.getActiveCall(),s=p.CometChat.user;if(u=p.CometChat.appSettings.getRegion().toLowerCase(),n){var o=n.getCallInitiator();if(l=new d.RTCUser(s.getUid(),s.getName(),s.getAvatar()),h=new d.RTCUser(o.getUid(),o.getName(),o.getAvatar()),n.getReceiverType()===g.CallConstants.RECEIVER_TYPE_GROUP){var r=n.getCallReceiver();E=new C.RTCReceiver(r.getGuid(),r.getName(),r.getIcon())}else{var i=n.getReceiver();E=new C.RTCReceiver(i.getUid(),i.getName(),i.getAvatar())}S=o.getUid()===s.getUid(),T=n.getReceiverType()===g.CallConstants.RECEIVER_TYPE_GROUP&&(S=!0),f=n.getType()===g.CallConstants.CALL_TYPE_AUDIO}else l=new d.RTCUser(s.getUid(),s.getName(),s.getAvatar()),f=c.isAudioOnlyCall(),T=!0;return c.getCallEventListener()&&_.CallController.getInstance().setCallListner(c.getCallEventListener()),e}return o(t,a),t.prototype.render=function(){return r.createElement(i.default,{sessionId:c.getSessionId(),isInitiator:S,enableDefaultLayout:c.isDefaultLayout(),isAudioOnly:f,onEndCall:function(){},onCallEndButtonPressed:function(){_.CallController.getInstance().leaveCallMuc(c.getSessionId()),setTimeout(function(){p.CometChat.endCall(c.getSessionId())},1e3)},hideAudioMuteButton:c.isMuteAudioButtonDisable(),hideEndCallButton:c.isEndCallButtonDisable(),hidePauseVideoButton:c.isPauseVideoButtonDisable(),hideVideoSwitchButton:c.isSwitchCameraButtonDisable(),hideAudioModeButton:c.isAudioModeButtonDisable(),RTCUser:l,RTCReceiver:E,RTCInitiator:h,isConfrence:T,REGION:u})},t.switchCamera=function(){i.default.switchCameraSource()},t.endCall=function(){_.CallController.getInstance().leaveCallMuc(c.getSessionId()),setTimeout(function(){p.CometChat.endCall(c.getSessionId())},1e3),i.default.endCallSession()},t.muteAudio=function(t){t?i.default.muteAudio():i.default.unMuteAudio()},t.pauseVideo=function(t){t?i.default.pauseVideo():i.default.unPauseVideo()},t.setAudioMode=function(t){t.toLocaleLowerCase()===g.CallConstants.AUDIO_MODE_SPEAKER?i.default.setAudioModeToSpeaker():i.default.setAudioModeToEarPiece()},t.AUDIO_MODE_SPEAKER=g.CallConstants.AUDIO_MODE_SPEAKER,t.AUDIO_MODE_EARPIECE=g.CallConstants.AUDIO_MODE_EARPIECE,t}(r.Component);e.CallingComponent=a},function(t,e){t.exports=n},function(t,e){t.exports=o},function(t,e,n){"use strict";e.__esModule=!0;var s=function(t,e,n){this.uid=t,this.avatar=n,this.name=e};e.RTCUser=s},function(t,e,n){"use strict";e.__esModule=!0;var s=function(t,e,n){this.uid=t,this.avatar=n,this.name=e};e.RTCReceiver=s},function(t,e,n){function s(t){this.options=t||{locator:{}}}function u(){this.cdata=!1}function l(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function E(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function o(t,e,n){return"string"==typeof t?t.substr(e,n):t.length>=e+n||e?new java.lang.String(t,e,n)+"":t}function h(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}s.prototype.parseFromString=function(t,e){var n=this.options,s=new p,o=n.domBuilder||new u,r=n.errorHandler,i=n.locator,a=n.xmlns||{},c={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return i&&o.setDocumentLocator(i),s.errorHandler=function(s,t,o){if(!s){if(t instanceof u)return t;s=t}var r={},i=s instanceof Function;function e(e){var n=s[e];!n&&i&&(n=2==s.length?function(t){s(e,t)}:s),r[e]=n&&function(t){n("[xmldom "+e+"]\t"+t+E(o))}||function(){}}return o=o||{},e("warning"),e("error"),e("fatalError"),r}(r,o,i),s.domBuilder=n.domBuilder||o,/\/x?html?$/.test(e)&&(c.nbsp="",c.copy="",a[""]="http://www.w3.org/1999/xhtml"),a.xml=a.xml||"http://www.w3.org/XML/1998/namespace",t?s.parse(t,a,c):s.errorHandler.error("invalid doc source"),o.doc},u.prototype={startDocument:function(){this.doc=(new r).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,n,s){var o=this.doc,r=o.createElementNS(t,n||e),i=s.length;h(this,r),this.currentElement=r,this.locator&&l(this.locator,r);for(var a=0;a<i;a++){t=s.getURI(a);var c=s.getValue(a),u=(n=s.getQName(a),o.createAttributeNS(t,n));this.locator&&l(s.getLocator(a),u),u.value=u.nodeValue=c,r.setAttributeNode(u)}},endElement:function(t,e,n){var s=this.currentElement;s.tagName;this.currentElement=s.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var n=this.doc.createProcessingInstruction(t,e);this.locator&&l(this.locator,n),h(this,n)},ignorableWhitespace:function(t,e,n){},characters:function(t,e,n){if(t=o.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(t);else s=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(t)&&this.doc.appendChild(s),this.locator&&l(this.locator,s)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,n){t=o.apply(this,arguments);var s=this.doc.createComment(t);this.locator&&l(this.locator,s),h(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,n){var s=this.doc.implementation;if(s&&s.createDocumentType){var o=s.createDocumentType(t,e,n);this.locator&&l(this.locator,o),h(this,o)}},warning:function(t){},error:function(t){},fatalError:function(t){throw t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){u.prototype[t]=function(){return null}});var p=n(69).XMLReader,r=e.DOMImplementation=n(37).DOMImplementation;e.XMLSerializer=n(37).XMLSerializer,e.DOMParser=s},function(t,e){var n=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,s=new RegExp("[\\-\\.0-9"+n.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),o=new RegExp("^"+n.source+s.source+"*(?::"+n.source+s.source+"*)?$"),E=0,h=1,p=2,d=3,C=4,g=5,_=6,S=7;function r(){}function L(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function U(t,e,n,s,o,r){for(var i,a=++e,c=E;;){var u=t.charAt(a);switch(u){case"=":if(c===h)i=t.slice(e,a),c=d;else{if(c!==p)throw new Error("attribute equal must after attrName");c=d}break;case"'":case'"':if(c===d||c===h){if(c===h&&(r.warning('attribute value must after "="'),i=t.slice(e,a)),e=a+1,!(0<(a=t.indexOf(u,e))))throw new Error("attribute value no end '"+u+"' match");l=t.slice(e,a).replace(/&#?\w+;/g,o),n.add(i,l,e-1),c=g}else{if(c!=C)throw new Error('attribute value must after "="');l=t.slice(e,a).replace(/&#?\w+;/g,o),n.add(i,l,e),r.warning('attribute "'+i+'" missed start quot('+u+")!!"),e=a+1,c=g}break;case"/":switch(c){case E:n.setTagName(t.slice(e,a));case g:case _:case S:c=S,n.closed=!0;case C:case h:case p:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return r.error("unexpected end of input"),c==E&&n.setTagName(t.slice(e,a)),a;case">":switch(c){case E:n.setTagName(t.slice(e,a));case g:case _:case S:break;case C:case h:"/"===(l=t.slice(e,a)).slice(-1)&&(n.closed=!0,l=l.slice(0,-1));case p:c===p&&(l=i),c==C?(r.warning('attribute "'+l+'" missed quot(")!!'),n.add(i,l.replace(/&#?\w+;/g,o),e)):("http://www.w3.org/1999/xhtml"===s[""]&&l.match(/^(?:disabled|checked|selected)$/i)||r.warning('attribute "'+l+'" missed value!! "'+l+'" instead!!'),n.add(l,l,e));break;case d:throw new Error("attribute value missed!!")}return a;case"":u=" ";default:if(u<=" ")switch(c){case E:n.setTagName(t.slice(e,a)),c=_;break;case h:i=t.slice(e,a),c=p;break;case C:var l=t.slice(e,a).replace(/&#?\w+;/g,o);r.warning('attribute "'+l+'" missed quot(")!!'),n.add(i,l,e);case g:c=_}else switch(c){case p:n.tagName;"http://www.w3.org/1999/xhtml"===s[""]&&i.match(/^(?:disabled|checked|selected)$/i)||r.warning('attribute "'+i+'" missed value!! "'+i+'" instead2!!'),n.add(i,i,e),e=a,c=h;break;case g:r.warning('attribute space is required"'+i+'"!!');case _:c=h,e=a;break;case d:c=C,e=a;break;case S:throw new Error("elements closed character '/' and '>' must be connected to")}}a++}}function D(t,e,n){for(var s=t.tagName,o=null,r=t.length;r--;){var i=t[r],a=i.qName,c=i.value;if(0<(h=a.indexOf(":")))var u=i.prefix=a.slice(0,h),l=a.slice(h+1),E="xmlns"===u&&l;else u=null,E="xmlns"===(l=a)&&"";i.localName=l,!1!==E&&(null==o&&(o={},f(n,n={})),n[E]=o[E]=c,i.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(E,c))}for(r=t.length;r--;){(u=(i=t[r]).prefix)&&("xml"===u&&(i.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(i.uri=n[u||""]))}var h=s.indexOf(":");l=t.localName=0<h?(u=t.prefix=s.slice(0,h),s.slice(h+1)):(u=null,s);var p=t.uri=n[u||""];if(e.startElement(p,l,s,t),!t.closed)return t.currentNSMap=n,t.localNSMap=o,!0;if(e.endElement(p,l,s),o)for(u in o)e.endPrefixMapping(u)}function w(t,e,n,s,o){if(/^(?:script|textarea)$/i.test(n)){var r=t.indexOf("</"+n+">",e),i=t.substring(e+1,r);if(/[&<]/.test(i))return/^script$/i.test(n)||(i=i.replace(/&#?\w+;/g,s)),o.characters(i,0,i.length),r}return e+1}function Y(t,e,n,s){var o=s[n];return null==o&&((o=t.lastIndexOf("</"+n+">"))<e&&(o=t.lastIndexOf("</"+n)),s[n]=o),o<e}function f(t,e){for(var n in t)e[n]=t[n]}function b(t,e,n,s){switch(t.charAt(e+2)){case"-":return"-"!==t.charAt(e+3)?-1:e<(o=t.indexOf("--\x3e",e+4))?(n.comment(t,e+4,o-e-4),o+3):(s.error("Unclosed comment"),-1);default:if("CDATA["==t.substr(e+3,6)){var o=t.indexOf("]]>",e+9);return n.startCDATA(),n.characters(t,e+9,o-e-9),n.endCDATA(),o+3}var r=function(t,e){var n,s=[],o=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;o.lastIndex=e,o.exec(t);for(;n=o.exec(t);)if(s.push(n),n[1])return s}(t,e),i=r.length;if(1<i&&/!doctype/i.test(r[0][0])){var a=r[1][0],c=3<i&&/^public$/i.test(r[2][0])&&r[3][0],u=4<i&&r[4][0],l=r[i-1];return n.startDTD(a,c&&c.replace(/^(['"])(.*?)\1$/,"$2"),u&&u.replace(/^(['"])(.*?)\1$/,"$2")),n.endDTD(),l.index+l[0].length}}return-1}function G(t,e,n){var s=t.indexOf("?>",e);if(s){var o=t.substring(e,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(o){o[0].length;return n.processingInstruction(o[1],o[2]),s+2}return-1}return-1}function x(t){}function i(t,e){return t.__proto__=e,t}r.prototype={parse:function(t,e,n){var s=this.domBuilder;s.startDocument(),f(e,e={}),function(n,t,s,o,r){function i(t){var e=t.slice(1,-1);return e in s?s[e]:"#"===e.charAt(0)?function(t){{if(65535<t){var e=55296+((t-=65536)>>10),n=56320+(1023&t);return String.fromCharCode(e,n)}return String.fromCharCode(t)}}(parseInt(e.substr(1).replace("x","0x"))):(r.error("entity not found:"+t),t)}function e(t){if(d<t){var e=n.substring(d,t).replace(/&#?\w+;/g,i);E&&a(d),o.characters(e,0,t-d),d=t}}function a(t,e){for(;u<=t&&(e=l.exec(n));)c=e.index,u=c+e[0].length,E.lineNumber++;E.columnNumber=t-c+1}var c=0,u=0,l=/.*(?:\r\n?|\n)|.*$/g,E=o.locator,h=[{currentNSMap:t}],p={},d=0;for(;;){try{var C=n.indexOf("<",d);if(C<0){if(!n.substr(d).match(/^\s*$/)){var g=o.doc,_=g.createTextNode(n.substr(d));g.appendChild(_),o.currentElement=_}return}switch(d<C&&e(C),n.charAt(C+1)){case"/":var S=n.indexOf(">",C+3),f=n.substring(C+2,S),T=h.pop();S<0?(f=n.substring(C+2).replace(/[\s<].*/,""),r.error("end tag name: "+f+" is not complete:"+T.tagName),S=C+1+f.length):f.match(/\s</)&&(f=f.replace(/[\s<].*/,""),r.error("end tag name: "+f+" maybe not complete"),S=C+1+f.length);var m=T.localNSMap,A=T.tagName==f,I=A||T.tagName&&T.tagName.toLowerCase()==f.toLowerCase();if(I){if(o.endElement(T.uri,T.localName,f),m)for(var N in m)o.endPrefixMapping(N);A||r.fatalError("end tag name: "+f+" is not match the current start tagName:"+T.tagName)}else h.push(T);S++;break;case"?":E&&a(C),S=G(n,C,o);break;case"!":E&&a(C),S=b(n,C,o,r);break;default:E&&a(C);var R=new x,O=h[h.length-1].currentNSMap,S=U(n,C,R,O,i,r),y=R.length;if(!R.closed&&Y(n,S,R.tagName,p)&&(R.closed=!0,s.nbsp||r.warning("unclosed xml attribute")),E&&y){for(var M=L(E,{}),P=0;P<y;P++){var v=R[P];a(v.offset),v.locator=L(E,{})}o.locator=M,D(R,o,O)&&h.push(R),o.locator=E}else D(R,o,O)&&h.push(R);"http://www.w3.org/1999/xhtml"!==R.uri||R.closed?S++:S=w(n,S,R.tagName,i,o)}}catch(t){r.error("element parse error: "+t),S=-1}d<S?d=S:e(Math.max(C,d)+1)}}(t,e,n,s,this.errorHandler),s.endDocument()}},x.prototype={setTagName:function(t){if(!o.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,n){if(!o.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:n}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},i({},i.prototype)instanceof i||(i=function(t,e){function n(){}for(e in n.prototype=e,n=new n,t)n[e]=t[e];return n}),e.XMLReader=r}])});